---
title: Keyhac
description: Keyhac „Çí‰Ωø„Å£„Å¶„Ç≠„Éº„Ç´„Çπ„Çø„Éû„Ç§„Ç∫„ÇÑ„ÇØ„É™„ÉÉ„Éó„Éú„Éº„ÉâÊã°Âºµ„ÇíË°å„ÅÜÊñπÊ≥ï„ÇíËß£Ë™¨„Åó„Åæ„Åô
keywords:
  - Keyhac
pagination_next: null
pagination_prev: null
image: https://og-image-mebiusbox.vercel.app/api/og?title=Keyhac&subtitle=Keyhac%20%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%82%AD%E3%83%BC%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA%E3%82%84%E3%82%AF%E3%83%AA%E3%83%83%E3%83%97%E3%83%9C%E3%83%BC%E3%83%89%E6%8B%A1%E5%BC%B5%E3%82%92%E8%A1%8C%E3%81%86%E6%96%B9%E6%B3%95%E3%82%92%E8%A7%A3%E8%AA%AC%E3%81%97%E3%81%BE%E3%81%99&date=2023%2F01%2F01
last_update:
  date: 2023-01-20
  author: mebiusbox
---

import Bookmark from '@site/src/components/Markdown/WebBookmark.tsx'

## Keyhac „Å®„ÅØ

Keyhac „Å®„ÅØ„ÄÅPython „Çí‰Ωø„Å£„Å¶„Ç≠„Éº„Ç´„Çπ„Çø„Éû„Ç§„Ç∫„ÅåË°å„Åà„Çã„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Åß„ÅôÔºé

https://sites.google.com/site/craftware/keyhac-ja

<Bookmark name="craftware - Keyhac" url="https://sites.google.com/site/craftware/keyhac-ja" description="Keyhac - Python„Å´„Çà„ÇãÊüîËªü„Å™„Ç≠„Éº„Ç´„Çπ„Çø„Éû„Ç§„Ç∫„ÉÑ„Éº„É´" />

ÂÆöÂûãÊñáÂÖ•Âäõ„Çí„Çπ„Éã„Éö„ÉÉ„Éà„ÅÆ„Çà„ÅÜ„Å´ÂÖ•Âäõ„Åß„Åç„Çã„ÉÑ„Éº„É´„Å®„Åó„Å¶„ÄÅ [aText](https://www.trankynam.com/atext/) „Çí‰Ωø„Å£„Å¶„ÅÑ„Åæ„ÅôÔºéÁÑ°Êñô„Åß„ÇÇÂçòÁ¥î„Å™ÂÆöÂûãÊñá„ÅØÂÖ•Âäõ„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„Åå„ÄÅ„Éï„É´Ê©üËÉΩ„Çí‰Ωø„ÅÜ„Åü„ÇÅ„Å´„ÅØPro„Éê„Éº„Ç∏„Éß„É≥„Å´„Åó„Å™„Åë„Çå„Å∞„Å™„Çâ„Åö„ÄÅÊúâÊñô„Åß„ÅôÔºé„Åù„Çì„Å™„Å´È†ªÁπÅ„Å´Âà©Áî®„Åô„Çã„Çè„Åë„Åß„ÇÇ„Å™„ÅÑ„Åß„Åô„Åó„ÄÅ„Å®„Çä„ÅÇ„Åà„Åö‰ªñ„ÅÆÊñπÊ≥ï„Åß„Åß„Åç„Å™„ÅÑ„Åã„Å®Êé¢„Åó„Å¶„ÅÑ„Åü„Å®„Åì„Çç„ÄÅKeyhac„Å´„Åü„Å©„ÇäÁùÄ„Åç„Åæ„Åó„ÅüÔºé

Keyhac „ÅÆ„ÅÑ„ÅÑ„Å®„Åì„Çç„ÅØ Python „Åß„Ç´„Çπ„Çø„Éû„Ç§„Ç∫„Åß„Åç„Çã„Å®„Åì„Çç„Å´„ÅÇ„Çä„Åæ„ÅôÔºé‰ª•Ââç„ÅØ [Charu3](http://keijiweb.com/software.html) „Çí‰Ωø„Å£„Å¶„ÅÑ„Åæ„Åó„ÅüÔºé„Éû„ÇØ„É≠„ÅØÁî®ÊÑè„Åï„Çå„Å¶„ÅÑ„Åü„Çä„Éó„É©„Ç∞„Ç§„É≥„ÇÇ„ÅÇ„Çã„ÅÆ„Åß„ÄÅ„ÅÇ„ÇãÁ®ãÂ∫¶„Ç´„Çπ„Çø„Éû„Ç§„Ç∫„Åå„Åß„Åç„Çã„ÅÆ„Åß„Åô„Åå„ÄÅ„ÇÑ„ÅØ„ÇäÈôêÁïå„Åå„ÅÇ„Çä„Åæ„ÅôÔºéPython „Åå‰Ωø„Åà„Çã„Å™„Çâ„ÄÅ„ÉÜ„Ç≠„Çπ„ÉàÂá¶ÁêÜ‰ª•Â§ñ„ÅÆ„Åì„Å®„ÇÇ„ÅÑ„Çç„ÅÑ„Çç„Åß„Åç„Çã„ÅÆ„ÅßÊ±éÁî®ÊÄß„ÅØÈ´ò„ÅÑ„Åß„ÅôÔºé


## Keyhac„ÅÆË®≠ÂÆö

Keyhac„ÅÆË®≠ÂÆöÊñπÊ≥ï„ÇíËß£Ë™¨„Åó„Åæ„ÅôÔºéÁí∞Â¢É„ÅØ Windows „Åß„ÅôÔºé
„Åæ„Åö„ÄÅKeyhac„ÇíËµ∑Âãï„Åô„Çã„Å®„Ç∑„Çπ„ÉÜ„É†„Éà„É¨„Ç§„Å´Â∏∏Èßê„Åó„Åæ„ÅôÔºé„Ç∑„Çπ„ÉÜ„É†„Éà„É¨„Ç§„Åã„ÇâKeyhac„Ç¢„Ç§„Ç≥„É≥„ÇíÂè≥„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„ÄÅ`Ë®≠ÂÆö„ÅÆÁ∑®ÈõÜ`„ÇíÈÅ∏Êäû„Åô„Çã„Å®„ÄÅË®≠ÂÆö„Éï„Ç°„Ç§„É´(`config.py`)„Åå„Ç®„Éá„Ç£„Çø„ÅßÈñã„Åã„Çå„Åæ„ÅôÔºé„Åì„ÅÆË®≠ÂÆö„Éï„Ç°„Ç§„É´„ÇíÁ∑®ÈõÜ„Åó„Å¶„ÄÅ„Ç∑„Çπ„ÉÜ„É†„Éà„É¨„Ç§„Åã„ÇâÂè≥„ÇØ„É™„ÉÉ„ÇØ„ÄÅ`Ë®≠ÂÆö„ÅÆ„É™„É≠„Éº„Éâ`„ÅßÂèçÊò†„Åï„Çå„Åæ„ÅôÔºé

### „Ç≥„É≥„ÇΩ„Éº„É´ÁîªÈù¢

Ë®≠ÂÆö„Éï„Ç°„Ç§„É´„Å´ÂïèÈ°å„Åå„ÅÇ„Å£„Åü„Çä„ÄÅÂÆüË°å„Åó„Åü„Å®„Åç„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„ÅüÂ†¥Âêà„ÅØ„Ç≥„É≥„ÇΩ„Éº„É´ÁîªÈù¢„ÅåË°®Á§∫„Åï„Çå„Åæ„ÅôÔºéË®≠ÂÆö„Éï„Ç°„Ç§„É´„Åã„Çâ `print` „Åô„Çã„Å®„ÄÅ„Åì„ÅÆ„Ç≥„É≥„ÇΩ„Éº„É´ÁîªÈù¢„ÅåË°®Á§∫„Åï„Çå„Åæ„ÅôÔºéÁîªÈù¢„ÅåË°®Á§∫„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÄÅ„Ç∑„Çπ„ÉÜ„É†„Éà„É¨„Ç§„ÅÆKeyhac„Ç¢„Ç§„Ç≥„É≥„Çí„ÉÄ„Éñ„É´„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Å®Ë°®Á§∫„Åï„Çå„Åæ„ÅôÔºé„Ç≥„É≥„ÇΩ„Éº„É´ÁîªÈù¢„Çí„ÇØ„É™„Ç¢„Åó„Åü„ÅÑÂ†¥Âêà„ÄÅ„Ç∑„Çπ„ÉÜ„É†„Éà„É¨„Ç§„Åã„ÇâKeyhac„Ç¢„Ç§„Ç≥„É≥„ÇíÂè≥„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶`Á´ØÊú´„ÅÆ„ÇØ„É™„Ç¢`„ÇíÈÅ∏Êäû„Åó„Åæ„ÅôÔºé„Åæ„Åü„ÄÅ`ÂÜÖÈÉ®„É≠„Ç∞„ÇíON`„ÇíÈÅ∏Êäû„Åô„Çã„Å®„ÄÅ„É≠„Ç∞ÊÉÖÂ†±„Åå„Ç≥„É≥„ÇΩ„Éº„É´ÁîªÈù¢„Å´Âá∫Âäõ„Åï„Çå„Åæ„ÅôÔºéÁÑ°Âäπ„Å´„Åó„Åü„ÅÑ„Å®„Åç„ÅØ`ÂÜÖÈÉ®„É≠„Ç∞„ÇíOFF`„ÇíÈÅ∏Êäû„Åó„Åæ„ÅôÔºé


### configureÈñ¢Êï∞

Keyhac„ÇíËµ∑Âãï„Åô„Çã„Å®„ÄÅË®≠ÂÆö„Éï„Ç°„Ç§„É´(`config.py`)„Å´„ÅÇ„Çã`configure`Èñ¢Êï∞„ÅåÂëº„Å∞„Çå„Åæ„ÅôÔºé„Åì„Åì„Å´Âá¶ÁêÜ„ÇíË®òËø∞„Åó„Å¶„Åç„Åæ„ÅôÔºé


### „Ç®„Éá„Ç£„Çø„ÅÆË®≠ÂÆö

Ë®≠ÂÆö„Éï„Ç°„Ç§„É´„ÅÆÁ∑®ÈõÜ„Å´‰Ωø„ÅÜ„Ç®„Éá„Ç£„Çø„ÇíË®≠ÂÆö„Åó„Åæ„ÅôÔºéVisual Studio Code„ÅØÈñã„ÅèÂ†¥Âêà„ÅØÊ¨°„ÅÆ„Çà„ÅÜ„Å´„Åó„Åæ„ÅôÔºé

```py
keymap.editor = "code"
```


### „Éï„Ç©„É≥„Éà„ÅÆË®≠ÂÆö

„Ç≥„É≥„ÇΩ„Éº„É´„Å™„Å©„ÅÆ„Ç¶„Ç£„É≥„Éâ„Ç¶„Å´Ë°®Á§∫„Åï„Çå„Çã„ÉÜ„Ç≠„Çπ„Éà„ÅÆ„Éï„Ç©„É≥„Éà„ÇíÊåáÂÆö„Åó„Åæ„ÅôÔºéÂ•Ω„Åç„Å™„Éï„Ç©„É≥„Éà„ÇíÊåáÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºé„Éï„Ç©„É≥„Éà„ÇíÊåáÂÆö„Åô„Çã„Å®„ÄÅËµ∑Âãï„Å´Â∞ë„ÅóÊôÇÈñì„Åå„Åã„Åã„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„ÅôÔºé

```py
keymap.setFont("Iosevka", 16)
```

### „ÉÜ„Éº„Éû„ÅÆË®≠ÂÆö

Ê®ôÊ∫ñ„Åß„ÅØ `white` „Å® `black` „ÅåÁî®ÊÑè„Åï„Çå„Å¶„ÅÑ„Åæ„ÅôÔºé

```py
keymap.setTheme("black")
```


### „Ç≠„Éº„ÅÆÂÜçÁôªÈå≤

Keyhac„Åß„ÅØ„Ç≠„Éº„ÇíÂà•„ÅÆ„Ç≠„Éº„Å´Ââ≤„ÇäÂΩì„Å¶„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„ÅôÔºé„Åù„Çå„Å´„ÅØ`keymap.replaceKey`„É°„ÇΩ„ÉÉ„Éâ„Çí‰Ωø„ÅÑ„Åæ„ÅôÔºéÁßÅ„ÅÆÂ†¥Âêà„ÄÅ`ÁÑ°Â§âÊèõ`„Ç≠„Éº„Å®`Â§âÊèõ„Ç≠„Éº`„ÇíÈÅ©ÂΩì„Å™Â†¥ÊâÄ„Å´ÂÜçÂâ≤„ÇäÂΩì„Å¶„Åó„ÄÅ„É¶„Éº„Ç∂„Éº‰øÆÈ£æ„Ç≠„Éº„Å®„Åó„Å¶„Åù„Çå„Çâ„ÇíÁôªÈå≤„Åó„Åæ„ÅôÔºé„É¶„Éº„Ç∂„Éº‰øÆÈ£æ„Ç≠„Éº„ÅÆÁôªÈå≤„ÅØ `keymap.defineModifier`„É°„ÇΩ„ÉÉ„Éâ„Çí‰Ωø„ÅÑ„Åæ„ÅôÔºé

```py
# Key replacement
keymap.replaceKey("(29)", 235)  # ÁÑ°Â§âÊèõ
keymap.replaceKey("(28)", 236)  # Â§âÊèõ

# User modifier key definition
keymap.defineModifier(235, "User0")
keymap.defineModifier(236, "User1")
```


### „Ç∞„É≠„Éº„Éê„É´„Ç≠„Éº„Éû„ÉÉ„Éó

Keyhac„Åß„ÅØ„Ç¶„Ç£„É≥„Éâ„Ç¶„Åî„Å®„Å´„Ç≠„Éº„Ç´„Çπ„Çø„Éû„Ç§„Ç∫„ÇíË°å„ÅÜ„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„Åó„ÄÅ„Åô„Åπ„Å¶„ÅÆ„Ç¶„Ç£„É≥„Éâ„Ç¶„Å´ÂØæ„Åó„Å¶„Ç≠„Éº„Ç´„Çπ„Çø„Éû„Ç§„Ç∫„Åß„Åç„Åæ„ÅôÔºéÂæåËÄÖ„ÅÆÂ†¥Âêà„ÄÅ`keymap.defineWindowKeymap`„É°„ÇΩ„ÉÉ„Éâ„ÅßÂèñÂæó„Åó„Åü„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÅßË®≠ÂÆö„Åó„Åæ„ÅôÔºé

```py
# Global keymap which affects any windows
keymap_global = keymap.defineWindowKeymap()
```

‰æã„Åà„Å∞„ÄÅ`Shift`„Ç≠„Éº„Å®`Z`„Ç≠„Éº„ÇíÂêåÊôÇ„Å´Êäº„Åó„Åü„Å®„Åç„ÅÆÂá¶ÁêÜ„ÇíË®≠ÂÆö„Åó„Åü„ÅÑÂ†¥Âêà„ÄÅÊ¨°„ÅÆ„Çà„ÅÜ„Å´„Å™„Çä„Åæ„ÅôÔºé

```py
keymap_global["S-Z"] = closure
```

„Ç≠„Éº„Å´ÂØæÂøú„Åó„Åü„ÇØ„É≠„Éº„Ç∏„É£„ÇíÊåáÂÆö„Åó„Åæ„ÅôÔºéKeyhac„ÅØ„Ç≠„Éº„ÅåÊäº„Åï„Çå„Åü„Å®„Åç„Å´ÂØæÂøú„Åó„Åü„ÇØ„É≠„Éº„Ç∏„É£„ÇíÂëº„Å≥Âá∫„Åó„Åæ„ÅôÔºé

ÊåáÂÆö„Åß„Åç„Çã„Ç≠„Éº„ÇÑ„É¢„Éá„Ç£„Éï„Ç°„Ç§„Ç¢„Å´„Å§„ÅÑ„Å¶„ÅØ[„Éâ„Ç≠„É•„É°„É≥„Éà](https://crftwr.github.io/keyhac/mac/doc/ja/)„ÇíÂèÇÁÖß„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºé


### ÂàùÊúü„ÅÆË®≠ÂÆö

Keyhac„Åß„ÅØÊ®ôÊ∫ñ„Åß„ÅÑ„Åè„Å§„ÅãË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„ÅôÔºé„Åæ„Åö„ÅØÂÖ®ÈÉ®Ê∂à„Åô„Åã„ÄÅ„Ç≥„É°„É≥„Éà„Ç¢„Ç¶„Éà„Åó„Å¶„Åä„Åç„Åæ„Åó„Çá„ÅÜÔºé


### Keyhac„É¢„Ç∏„É•„Éº„É´

`pyauto`„Å®`keyhac`„ÅØKeyhac„Å´Áî®ÊÑè„Åï„Çå„Åü„É¢„Ç∏„É•„Éº„É´„Åß„ÅôÔºé`pyauto`„ÅØ‰Ωé„É¨„Éô„É´OSÊ©üËÉΩ„Åß„ÄÅ`keyhac`„ÅØ„Åù„Çå‰ª•Â§ñ„ÅÆ„ÇÇ„ÅÆ„Åß„ÅôÔºé‰æã„Åà„Å∞„ÄÅ„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„ÇíÊìç‰Ωú„Åô„ÇãÂ†¥Âêà„ÄÅ`keyhac` „ÅÆ `setClipboardText`, `getClipboardText` „Çí‰Ωø„ÅÑ„Åæ„ÅôÔºé

```py
from keyhac import setClipboardText, getClipboardText
```

Èù¢ÂÄí„Å™„Çâ„ÄÅ‰∏ÄÊã¨„Åß„Ç§„É≥„Éù„Éº„Éà„Åó„Å¶„ÇÇÊßã„ÅÑ„Åæ„Åõ„ÇìÔºé

```py
from keyhac import *
```

„Åì„Çå„Çâ„ÅÆ„É¢„Ç∏„É•„Éº„É´„Å´„Å§„ÅÑ„Å¶„ÄÅË©≥„Åó„Åè„ÅØ„Éâ„Ç≠„É•„É°„É≥„Éà„ÇíÂèÇÁÖß„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºé

Keyhac„Çí‰Ωø„Å£„Å¶ emacs „É©„Ç§„ÇØ„Å™„Ç≠„ÉºÊìç‰Ωú„ÇíÂÆüÁèæ„Åó„Å¶„ÅÑ„ÇãÊñπ„Åå„ÅÑ„Åæ„ÅôÔºéË®≠ÂÆö„Éï„Ç°„Ç§„É´„ÇÇÂèÇËÄÉ„Å´„Å™„Çã„Å®ÊÄù„ÅÑ„Åæ„ÅôÔºé

https://github.com/smzht/fakeymacs


## ÂÆüË£Ö„Åó„ÅüÊ©üËÉΩ„ÅÆÁ¥π‰ªã

„Åù„Çå„Åß„ÅØ„ÄÅÊ¨°„Åã„ÇâÂÖ∑‰ΩìÁöÑ„Å™Ë®≠ÂÆö„Çí„Åó„Å¶„ÅÑ„Åç„Åæ„ÅôÔºé„Å®„ÅÑ„Å£„Å¶„ÇÇ„ÄÅ„ÅÇ„Åæ„Çä‰Ωø„ÅÑ„Åì„Å™„Åó„Å¶„ÅÑ„ÇãË®≥„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÅÆ„ÅßÊÇ™„Åó„Åã„Çâ„ÅöÔºé
„Éò„É´„Éë„ÉºÈñ¢Êï∞„ÅØ„ÄÅ„Åù„Çå„Åû„ÇåÂàùÂá∫„Åó„ÅüÂ†¥ÊâÄ„Å´ÊòéË®ò„Åó„Å¶„ÅÑ„Åæ„ÅôÔºé


### „Ç´„Éº„ÇΩ„É´„Çí„Çπ„ÇØ„É™„Éº„É≥‰∏≠Â§Æ„Å´ÁßªÂãï„Åô„Çã

`Shift`„Ç≠„Éº„Å®`Âè≥Ctrl`„Ç≠„Éº„ÇíÊäº„Åó„Åü„Å®„Åç„Å´ÂÆüË°å„Åó„Åæ„ÅôÔºé

```py
def set_cursor_pos(x, y):
    keymap.beginInput()
    keymap.input_seq.append(pyauto.MouseMove(x, y))
    keymap.endInput()

def cursor_to_center():
    wnd = keymap.getTopLevelWindow()
    wnd_left, wnd_top, wnd_right, wnd_bottom = wnd.getRect()
    to_x = int((wnd_left + wnd_right) / 2)
    to_y = int((wnd_bottom + wnd_top) / 2)
    set_cursor_pos(to_x, to_y)

keymap_global["S-RCtrl"] = cursor_to_center
```


### „Ç¶„Ç£„É≥„Éâ„Ç¶„Çí„Çπ„ÇØ„É™„Éº„É≥‰∏≠Â§Æ„Å´ÁßªÂãï„Åô„Çã

Â∑¶Âè≥„ÅÆ`Ctrl`„Ç≠„Éº„ÇíÊäº„Åó„Åü„Å®„Åç„Å´ÂÆüË°å„Åó„Åæ„ÅôÔºé

```py
def delay(sec=0.05):
    time.sleep(sec)

def get_monitor_areas():
    monitors = pyauto.Window.getMonitorInfo()
    main_monitor_first = sorted(monitors, key=lambda x: x[2], reverse=True)
    non_taskbar_areas = list(map(lambda x: x[1], main_monitor_first))
    return non_taskbar_areas
    
def set_window_rect(rect):
    wnd = keymap.getTopLevelWindow()
    if list(wnd.getRect()) == rect:
        wnd.maximize()
    else:
        if wnd.isMaximized():
            wnd.restore()
            delay()
        wnd.setRect(rect)

def window_to_center():
    wnd = keymap.getTopLevelWindow()
    if wnd.isMaximized():
        return None
    wnd_left, wnd_top, wnd_right, wnd_bottom = wnd.getRect()
    width = wnd_right - wnd_left
    height = wnd_bottom - wnd_top
    mntr_left, mntr_top, mntr_right, mntr_bottom = get_monitor_areas()[0]
    center_h = (mntr_right - mntr_left) / 2
    center_v = (mntr_bottom - mntr_top) / 2
    lx = int(center_h - width / 2)
    ly = int(center_v - height / 2)
    to_rect = (lx, ly, lx + width, ly + height)
    set_window_rect(to_rect)

keymap_global["C-RCtrl"] = window_to_center
```

„ÇÇ„Åó„ÄÅ„Ç¶„Ç£„É≥„Éâ„Ç¶„ÇíÊúÄÂ§ßÂåñ„Åó„Å¶„ÅÑ„ÅüÂ†¥Âêà„ÄÅÂÖà„Å´ÈÄöÂ∏∏„ÅÆ„Ç¶„Ç£„É≥„Éâ„Ç¶„Å´Êàª„ÅôÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„ÅôÔºé„Åù„ÅÆÂ†¥Âêà„ÄÅÊ¨°„ÅÆ„Çà„ÅÜ„Å´„Åó„Åæ„ÅôÔºé

```py
def window_to_center_force():
    wnd = keymap.getTopLevelWindow()
    if wnd.isMaximized():
        wnd.restore()
        delay()
    window_to_center()
```


### „Ç¶„Ç£„É≥„Éâ„Ç¶„Çí„Ç´„Éº„ÇΩ„É´‰ΩçÁΩÆ„Å´ÁßªÂãï„Åô„Çã

`ÁÑ°Â§âÊèõ`„Ç≠„Éº„Å®`Âè≥Ctrl`„Ç≠„Éº„ÇíÊäº„Åó„Åü„Å®„Åç„Å´ÂÆüË°å„Åó„Åæ„ÅôÔºé

```py
def window_to_cursor():
    wnd = keymap.getTopLevelWindow()
    if wnd.isMaximized():
        return None
    wnd_left, wnd_top, wnd_right, wnd_bottom = wnd.getRect()
    width = wnd_right - wnd_left
    height = wnd_bottom - wnd_top
    x, y = pyauto.Input.getCursorPos()
    to_rect = (x, y, x + width, y + height)
    set_window_rect(to_rect)

keymap_global["U0-RCtrl"] = window_to_cursor
```


### „Ç¶„Ç£„É≥„Éâ„Ç¶„ÇíÂàá„ÇäÊõø„Åà„Çã

`Alt+Tab`„ÇÑ`Win+Tab`„ÅÆ„Çà„ÅÜ„Å™Ê©üËÉΩ„Åß„ÅôÔºéKeyhac„Åß„ÅØ„É™„Çπ„Éà„ÇíË°®Á§∫„Åô„Çã„Ç¶„Ç£„É≥„Éâ„Ç¶Ê©üËÉΩ„Åå„ÅÇ„Çä„Åæ„Åô„ÅÆ„Åß„ÄÅ„Åù„Å°„Çâ„Çí‰Ωø„ÅÑ„Åæ„ÅôÔºé‰ªäÂõû„ÅØ„ÄÅ`ÁÑ°Â§âÊèõ`„Ç≠„Éº„Å®`„Çπ„Éö„Éº„Çπ`„Ç≠„Éº„ÇíÊäº„Åó„Åü„Å®„Åç„Å´ÂÆüË°å„Åó„Åæ„ÅôÔºé

```py {47} showLineNumbers
# import re
# from keyhac import cblister_FixedPhrase
debug_mode = False # „Éá„Éê„ÉÉ„Ç∞Âá∫Âäõ„ÇíÊúâÂäπ„Å´„Åô„ÇãÂ†¥Âêà„ÅØ True „Å´„Åô„Çã
def dbg(text):
    if debug_mode:
        print("dbg: " + text)

def truncate(string, length, ellipsis="..."):
    return string[:length] + (ellipsis if string[length:] else "")

def truncate_cjk(string, length, ellipsis="..."):
    # http://www.unicode.org/reports/tr11/
    count = 0
    text = ""
    for c in string:
        if unicodedata.east_asian_width(c) in "FWA":
            count += 2
        else:
            count += 1

        if count > length:
            text += ellipsis
            break
        text += c
    return text
    
def switch_windows():
    dbg(">>>>> switch_windows <<<<<")

    def popWindowList():
        # If the list window is already opened, just close it
        if keymap.isListWindowOpened():
            keymap.cancelListWindow()
            return

        def getWindowList(wnd, arg):
            if not wnd.isVisible():
                return True
            # if not wnd.getOwner():
            #     return True
            if wnd.getText() == "":
                return True
            dbg(wnd.getProcessName())
            dbg("  " + wnd.getClassName())
            dbg("    " + wnd.getText())
            if re.match(
                r"(keyhac|SystemSettings|ApplicationFrameHost|TextInputHost|explorer|onenoteim)\.exe",
                wnd.getProcessName(),
            ):
                dbg("(pass)")
                return True
            # if re.match(r"chrome", wnd.getClassName()):
            #     window_list.append(wnd)
            window_list.append(wnd)
            return True

        window_list = []
        Window.enum(getWindowList, None)

        popup_list = [
            ("{:>20s} :: {}".format(truncate(i.getProcessName()[:-4], 17), truncate_cjk(i.getText(), 45)), i)
            for i in sorted(window_list, key=lambda x: x.getProcessName())
        ]

        if mysetting.debug:
            for i in popup_list:
                dbg(i[0])

        listers = [("Windows", cblister_FixedPhrase(popup_list))]
        item, mod = keymap.popListWindow(listers)
        if item:
            item[1].setForeground()

    # Because the blocking procedure cannot be executed in the key-hook,
    # delayed-execute the procedure by delayedCall().
    keymap.delayedCall(popWindowList, 0)

keymap_global["U0-Space"] = switch_windows
```

ÂÆüË°åÁµêÊûú„ÅØÊ¨°„ÅÆ„Çà„ÅÜ„Å´„Å™„Çä„Åæ„ÅôÔºé

![](../../static/img/post/keyhac-230127014527.png)

Ê≠£Ë¶èË°®Áèæ(Line:47)„Çí‰Ωø„Å£„Å¶Ë°®Á§∫„Åï„Çå„Çã„Ç¶„Ç£„É≥„Éâ„Ç¶„ÇíÂà∂Èôê„Åô„Çã„Åì„Å®„ÇÇ„Åß„Åç„Åæ„ÅôÔºé

:::info
„Å°„Å™„Åø„Å´„ÄÅ‰ª•Ââç„ÅØ[Tascher](http://frostmoon.sakura.ne.jp/Tascher/)„Å®„ÅÑ„ÅÜ„ÅÆ„Çí‰Ωø„Å£„Å¶„ÅÑ„Åü„ÅÆ„Åß„Åô„Åå„ÄÅKeyhac„Å´ÁΩÆ„ÅçÊèõ„Åà„Åæ„Åó„ÅüÔºé
:::

:::info
Keyhac„ÅÆ„Ç¶„Ç£„É≥„Éâ„Ç¶Ê©üËÉΩ„ÅØ„ÄÅÂÆü„ÅØË§áÊï∞„ÅÆ„É™„Çπ„Éà„ÇíÂÜÖÈÉ®„ÅßÊåÅ„Å§„Åì„Å®„Åå„Åß„Åç„Åæ„ÅôÔºé‰ª•‰∏ã„ÅÆ„Ç≥„Éº„Éâ„Å´„ÅÇ„Çã„Çà„ÅÜ„Å´„ÄÅ`listers`„Å´ÈÖçÂàó„ÇíË®≠ÂÆö„Åó„Å¶„ÅÑ„Åæ„ÅôÔºé

```py
listers = [("Windows", cblister_FixedPhrase(popup_list))]
```

Ë§áÊï∞ÊåáÂÆö„Åó„ÅüÂ†¥Âêà„ÄÅ„Ç≠„Éº„Éú„Éº„Éâ„ÅÆÂ∑¶Âè≥„Ç≠„Éº„ÅßÂàá„ÇäÊõø„Åà„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„ÅôÔºé
:::


### „Éñ„É©„Ç¶„Ç∂(Chrome)„ÇíÂàá„ÇäÊõø„Åà„Çã

Chrome„Ç¶„Ç£„É≥„Éâ„Ç¶„ÇíÊ¨°„ÄÖ„Å´Âàá„ÇäÊõø„Åà„ÇãÊ©üËÉΩ„Åß„ÅôÔºé`ÁÑ°Â§âÊèõ`„Ç≠„Éº„Å®`F7`„Ç≠„Éº„Å´Ââ≤„ÇäÂΩì„Å¶„Å¶„ÅÑ„Åæ„ÅôÔºé

```py
# import time
# from keyhac import Window
chrome_history = []
def next_chrome_window():
    dbg(">>>>> next_chrome_window <<<<<")

    def getWindowList(wnd, arg):
        if not wnd.isVisible():
            return True
        # if not wnd.getOwner():
        #     return True
        if wnd.getText() == "":
            return True
        # dbg(wnd.getProcessName())
        if re.match(r"chrome", wnd.getProcessName()):
            window_list.append(wnd)
        # if re.match(r"chrome", wnd.getClassName()):
        #     window_list.append(wnd)
        # window_list.append(wnd)
        return True

    now = time.time_ns() / 1_000_000  # ms
    history = sorted(chrome_history, key=lambda x: x[1], reverse=True)
    if len(history) > 0:
        dbg("{}".format(now - history[0][1]))
        if now - history[0][1] > 5_000:  # 5s
            dbg("clear chrome history")
            chrome_history = []
            history = []

    if debug:
        for entry in history:
            dbg(f"{entry[0]}, {entry[1]}")

    next_window = (None, -1)
    window_list = []
    Window.enum(getWindowList, None)
    current_wnd_text = keymap.getTopLevelWindow().getText()
    dbg(f"[current] {current_wnd_text}")
    for wnd in window_list:
        text = wnd.getText()
        if current_wnd_text == text:
            continue
        idx = [i for i, e in enumerate(history) if e[0] == text]
        if len(idx) > 0:
            if next_window[1] < idx[0]:
                dbg(f"found in history: {text}({idx[0]})")
                next_window = (wnd, idx[0])
        else:
            dbg(f"not found in history: {text}")
            next_window = (wnd, len(history))
            break

    if next_window[0]:
        dbg("[next] " + next_window[0].getText())
        chrome_history.append((next_window[0].getText(), now))
        next_window[0].setForeground()
        
keymap_global["U0-F7"] = next_chrome_window
```


### „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÇíÂÆüË°å„Åô„Çã

`keymap.ShellExecuteCommand`„É°„ÇΩ„ÉÉ„Éâ„Çí‰Ωø„ÅÑ„Åæ„ÅôÔºé

```py
keymap.ShellExecuteCommand(verb, file, param, directory, swmode);
```

ÁßÅ„ÅØÊ¨°„ÅÆ„Çà„ÅÜ„Å™„Éò„É´„Éë„ÉºÈñ¢Êï∞„ÇíÂÆöÁæ©„Åó„Å¶‰Ωø„Å£„Å¶„ÅÑ„Åæ„ÅôÔºé

```py
def shell(s, arg=None):
    return keymap.ShellExecuteCommand(None, s, arg, None)

def shell_mini(s, arg=None):
    return keymap.ShellExecuteCommand(None, s, arg, None, "minimized")
```

‰æã„Åà„Å∞„ÄÅChrome„ÅßÁâπÂÆö„ÅÆURL„ÇíÈñã„Åç„Åü„ÅÑÂ†¥Âêà„ÅØÊ¨°„ÅÆ„Çà„ÅÜ„Å´„Åó„Åæ„ÅôÔºé

```py
keymap_global["U0-F9"] = shell(
    "C:\\Program Files\\Google\\Chrome\\Application\\Chrome.exe",
    "--new-window https://www.google.com/webhp?hl=ja",
)
```


### VSCode„ÅÆÈÅ∏ÊäûÁØÑÂõ≤Êã°Â§ß(x2)

Visual Studio Code „Åß `Shift+Alt+Âè≥`„Ç≠„Éº„ÅØÈÅ∏ÊäûÁØÑÂõ≤„ÅÆÊã°Â§ß„Å´„Å™„Çä„Åæ„ÅôÔºé„Å°„Çá„ÅÜ„Å©2ÂõûÂÆüË°å„Åô„Çã„Å®„ÄÅ„ÅÑ„ÅÑÊÑü„Åò„Å´ÈÅ∏Êäû„Åß„Åç„Çã„Åì„Å®„ÅåÂ§ö„ÅÑ„Åü„ÇÅÈáçÂÆù„Åó„Å¶„ÅÑ„Åæ„ÅôÔºé„Åó„Åã„Åó„ÄÅ`Shift+Alt+Âè≥`„Ç≠„Éº„ÅØÊäº„Åó„Å•„Çâ„ÅÑ„Åß„ÅôÔºé„Åù„Åì„Åß„ÄÅ`ÁÑ°Â§âÊèõ`„Ç≠„Éº„Å®`Âè≥`„Ç≠„ÉºÊäº„Åó„Åß2ÂõûÂàÜ„ÅÆ`Shift+Alt+Âè≥`„Ç≠„Éº„ÇíÊäº„Åô„Çà„ÅÜ„Å´„Åó„Åæ„ÅôÔºé

```py
def ikey(*keys):
    return keymap.InputKeyCommand(*keys)

keymap_global["U0-Right"] = ikey("S-A-Right", "S-A-Right")
```


### „Éû„É´„ÉÅ„Çπ„Éà„É≠„Éº„ÇØ„Ç≠„Éº

Keyhac„Åß„ÅØ„Éû„É´„ÉÅ„Çπ„Éà„É≠„Éº„ÇØ„Ç≠„Éº„Çí„Çµ„Éù„Éº„Éà„Åó„Å¶„ÅÑ„Åæ„ÅôÔºé`keymap.defineMultiStrokeKeymap`„ÅßÊúÄÂàù„ÅÆ„Ç≠„Éº„ÇíÁôªÈå≤„Åó„Åæ„ÅôÔºé‰æã„Åà„Å∞„ÄÅ`ÁÑ°Â§âÊèõ`„Ç≠„Éº„Å®`D`„Ç≠„Éº„ÇíÊäº„Åó„Å¶„ÄÅÊó•‰ªò„Çí„Éï„Ç©„Éº„Éû„ÉÉ„Éà„ÇíÊåáÂÆö„Åó„Å¶ÂÖ•Âäõ„Åó„Åü„ÅÑÂ†¥Âêà„ÄÅÊ¨°„ÅÆ„Çà„ÅÜ„Å´„Å™„Çä„Åæ„ÅôÔºé

```py
def send_keys(*keys):
    keymap.beginInput()
    for key in keys:
        keymap.setInput_FromString(str(key))
    keymap.endInput()
    keymap._fixFunnyModifierState()
    
def set_ime(mode):
    if keymap.getWindow().getImeStatus() != mode:
        send_keys("(243)")
        delay(0.01)

def input_date(fmt):
    def _input_data():
        d = datetime.datetime.today()
        date_str = d.strftime(fmt)
        set_ime(0)
        send_input(date_str, 0)

    return _input_data

keymap_global["U0-D"] = keymap.defineMultiStrokeKeymap("DATE: [1]YMD, [2]Y/M/D, [3]Y-M-D")
for key, args in {
    "1": ["%Y%m%d"],
    "2": ["%Y/%m/%d"],
    "3": ["%Y-%m-%d"],
}.items():
    keymap_global["U0-D"][key] = input_date(*args)
```

ÂÆüË°å„Åô„Çã„Å®„ÄÅ„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™„Ç¶„Ç£„É≥„Éâ„Ç¶„ÅÆ‰∏ã„Å´ `DATE: [1]YMD, [2]Y/M/D, [3]Y-M-D` „ÅåË°®Á§∫„Åï„Çå„ÄÅÊ¨°„ÅÆ„Ç≠„ÉºÂÖ•ÂäõÂæÖ„Å°„Å´„Å™„Çä„Åæ„ÅôÔºé„Åì„Åì„Åß„ÅØ `1`„ÄÅ`2`„ÄÅ`3`„Ç≠„Éº„ÅÆ„Å©„Çå„Åã„ÇíÊäº„Åô„Å®„ÄÅ„Åù„Çå„Åû„Çå„ÅÆÊõ∏Âºè„Å´ÂØæÂøú„Åó„ÅüÊó•‰ªò„ÅåÂÖ•Âäõ„Åï„Çå„Åæ„ÅôÔºé

‰ªñ„Å´„ÄÅÊã¨Âºß„ÅÆÂÖ•ÂäõÊîØÊè¥„ÅØÊ¨°„ÅÆ„Çà„ÅÜ„Å´„Å™„Çä„Åæ„ÅôÔºé(`ÁÑ°Â§âÊèõ`„Ç≠„Éº„Å®`P`„Ç≠„Éº)

```py
def send_string(s):
    keymap.beginInput()
    keymap.setInput_Modifier(0)
    for c in s:
        keymap.input_seq.append(pyauto.Char(c))
    keymap.endInput()
    
def send_input(sequence, sleep=0.01):
    for elem in sequence:
        delay(sleep)
        try:
            send_keys(elem)
        except:
            send_string(elem)
            
def ime_input0(*sequence):
    def _ime_input0():
        set_ime(0)
        send_input(sequence)

    return _ime_input0

def ime_input1(*sequence):
    def _ime_input1():
        set_ime(1)
        send_input(sequence)

    return _ime_input1

keymap_global["U0-P"] = keymap.defineMultiStrokeKeymap("PARENTHES: [1]„Ää„Äã [2]„Äà„Äâ [3]„Äî„Äï [4]„Äé„Äè [5]„Äê„Äë [6]ÔºàÔºâ [7]()")
for key, args in {
    "1": ["„Ää„Äã", "Left"],
    "2": ["„Äà„Äâ", "Left"],
    "3": ["„Äî„Äï", "Left"],
    "4": ["„Äé„Äè", "Left"],
    "5": ["„Äê„Äë", "Left"],
    "6": ["ÔºàÔºâ", "Left"],
    "7": ["()", "Left"],
}.items():
    keymap_global["U0-P"][key] = ime_input1(*args)
```


### Êó•Êú¨Ë™ûÂÖ•ÂäõÊôÇ„Å´ÂçäËßí„ÅÆÊã¨Âºß„ÇíÂÖ•„Çå„Çã

ÈÄöÂ∏∏„ÅØÂÖ®Ëßí„ÅÆÊã¨Âºß(`ÔºàÔºâ`)„Åß„Åô„Åå„ÄÅÂçäËßí„ÇíÂÖ•„Çå„Çã„Çà„ÅÜ„Å´„Åß„Åç„Åæ„ÅôÔºé

```py
def ime_context(func):
    def _ime_context():
        mode = keymap.getWindow().getImeStatus()
        func()
        set_ime(mode)

    return _ime_context

keymap_global["U0-8"] = ime_context(ime_input0("S-8"))
keymap_global["U0-9"] = ime_context(ime_input0("S-9"))
```

`ÁÑ°Â§âÊèõ`„Ç≠„Éº„Å®`8`„Ç≠„Éº„Åß`(`„Åå„ÄÅ`ÁÑ°Â§âÊèõ`„Ç≠„Éº„Å®`9`„Ç≠„Éº„Åß`)`„ÅåÊó•Êú¨Ë™ûÂÖ•ÂäõÊôÇ„Å´ÂÖ•„Çå„Çâ„Çå„Åæ„ÅôÔºé

Âêå„Åò„ÇÑ„ÇäÊñπ„Åß„ÄÅ`Ôºè`„Çí`/`„ÄÅ`„Äå„Äç`„Çí`[]`„Å®ÂÖ•Âäõ„Åß„Åç„Åæ„ÅôÔºé

```py
keymap_global["U0-OpenBracket"] = ime_context(ime_input0("OpenBracket"))
keymap_global["U0-CloseBracket"] = ime_context(ime_input0("CloseBracket"))
keymap_global["U0-Slash"] = ime_context(ime_input0("Slash"))
```


### „Ç§„É≥„ÇØ„É™„É°„É≥„Çø„É´„Çµ„Éº„ÉÅ

Keyhac„ÅØ„Ç¶„Ç£„É≥„Éâ„Ç¶„ÇíË°®Á§∫„Åó„Åü„Å®„Åç„Å´„Ç§„É≥„ÇØ„É™„É°„É≥„Çø„É´„Çµ„Éº„ÉÅ„Çí‰Ωø„Åà„Çã„ÅÆ„Åß„Åô„Åå„ÄÅÊ§úÁ¥¢„É¢„Éº„Éâ(`f`„Ç≠„Éº)„Å´ÂÖ•„Çâ„Å™„ÅÑ„Å®‰Ωø„Åà„Å™„ÅÑ„ÅÆ„Åß‰∏ç‰æø„Åß„ÅôÔºé„Åù„Åì„Åß„ÄÅ„Ç¶„Ç£„É≥„Éâ„Ç¶„ÇíË°®Á§∫„Åó„Åü„Å®„Åç„Å´Ëá™Âãï„ÅßÊ§úÁ¥¢„É¢„Éº„Éâ„Å´ÂÖ•„Çã„Çà„ÅÜ„Å´„Åó„Åü„ÅÑ„ÅÆ„Åß„Åô„Åå„Åß„Åç„Åæ„Åõ„ÇìÔºé„Åæ„Åü„ÄÅ„Ç¶„Ç£„É≥„Éâ„Ç¶„ÅØ„Çπ„ÇØ„É™„Éº„É≥„ÅÆ‰∏≠Â§Æ„Å´Ë°®Á§∫„Åó„Å¶„Åª„Åó„ÅÑ„ÅÆ„Åß„Åô„Åå„ÄÅÊ®ôÊ∫ñ„Åß„ÅØ„Çπ„ÇØ„É™„Éº„É≥„ÅÆÂéüÁÇπ(„Å§„Åæ„ÇäÂ∑¶‰∏ä)„Å´Ë°®Á§∫„Åï„Çå„Åæ„ÅôÔºé„Åì„Çå„Åå„Å®„Å¶„ÇÇ‰∏çÊ∫Ä„Å†„Å£„Åü„ÅÆ„Åß„Åô„Åå„ÄÅ„Å™„Çì„Å®„ÅãÂ¶•Âçî„Åß„Åç„Çã„É¨„Éô„É´„Å´„Åß„Åç„Åæ„Åó„ÅüÔºé„Åù„Çå„ÅØ„ÄÅ„Ç¶„Ç£„É≥„Éâ„Ç¶„ÇíË°®Á§∫„Åô„Çã„Ç≠„Éº„Çí2ÂõûÈÄ£Á∂ö„ÅßÊäº„Åô„Åì„Å®„Åß„ÄÅ„Ç¶„Ç£„É≥„Éâ„Ç¶„Çí‰∏≠Â§Æ„Å´ÁßªÂãï„Åó„Å¶„ÄÅÊ§úÁ¥¢„É¢„Éº„Éâ„Å´ÂÖ•„Çã„Çà„ÅÜ„Å´„Åô„Çã„Åì„Å®„Åß„ÅôÔºéÊ¨°„ÅÆ„Çà„ÅÜ„Å´„Åó„Åæ„ÅôÔºé

```py
 def lw_search():
    ikey("F")()
    lw_search_mode = True

def lw_exit():
    if lw_search_mode:
        ikey("Esc", "Esc")()
    else:
        ikey("Esc")()

def is_list_window(window):
    if window.getClassName() == "KeyhacWindowClass" and window.getText() != "Keyhac":
        lw_search_mode = False
        return True
    else:
        return False

keymap_lw = keymap.defineWindowKeymap(check_func=is_list_window)
keymap_lw["U0-N"] = ikey("Down")
keymap_lw["U0-P"] = ikey("Up")
keymap_lw["U0-AtMark"] = lambda: [window_to_center(), lw_search()]
keymap_lw["U0-Space"] = lambda: [window_to_center(), lw_search()]
keymap_lw["U0-Semicolon"] = lambda: [window_to_center(), lw_search()]
keymap_lw["Enter"] = ikey("Enter", "Enter")
keymap_lw["Escape"] = lw_exit
```

`keymap_lw`„ÅØKeyhac„ÅåË°®Á§∫„Åô„Çã„É™„Çπ„Éà„Ç¶„Ç£„É≥„Éâ„Ç¶„Å´ÈÅ©Áî®„Åï„Çå„Çã„Ç≠„Éº„Éû„ÉÉ„Éó„Åß„ÅôÔºé„Ç¶„Ç£„É≥„Éâ„Ç¶„ÇíË°®Á§∫„Åô„Çã„Ç≠„Éº„Å´ `lambda: [window_to_center(), lw_search()]` „ÇíÊåáÂÆö„Åô„Çã„Åì„Å®„Åß„ÄÅ„Ç¶„Ç£„É≥„Éâ„Ç¶„Çí‰∏≠Â§Æ„Å´Ë°®Á§∫„Åó„ÄÅÊ§úÁ¥¢„É¢„Éº„Éâ„Å´ÂÖ•„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„ÅôÔºé

Ê§úÁ¥¢„É¢„Éº„Éâ„Åß„ÅØ„ÄÅ`Enter`„Ç≠„Éº„ÇíÊäº„Åô„Å®„ÄÅÊ§úÁ¥¢„É¢„Éº„Éâ„ÅåÁµÇ‰∫Ü„Åô„Çã„Å†„Åë„Å™„ÅÆ„Åß„ÄÅ2Âõû`Enter`„Ç≠„Éº„ÇíÊäº„Åô„Çà„ÅÜ„Å´„Åó„Å¶„ÅÑ„Åæ„ÅôÔºé

„Åæ„Åü„ÄÅ`ÁÑ°Â§âÊèõ`„Ç≠„Éº„Å®`N`„Ç≠„Éº„Åæ„Åü„ÅØ`P`„Ç≠„Éº„Åß‰∏ä‰∏ã„Å´„Ç´„Éº„ÇΩ„É´„ÅåÁßªÂãï„Åô„Çã„Çà„ÅÜ„Å´„Åó„Å¶„ÅÑ„Åæ„ÅôÔºé‰ªñ„Å´`Escape`„Ç≠„Éº„ÅÆÂá¶ÁêÜ„Çí„Åó„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅ„Åì„Çå„ÇÇÊ§úÁ¥¢„É¢„Éº„Éâ„Åã„ÇâÊäú„Åë„Çã„Å†„Åë„Å™„ÅÆ„Åß„ÄÅ2ÂõûÊäº„Åó„Åü„Åì„Å®„Å´„Åó„Å¶„ÅÑ„Åæ„Åô


### „Ç≥„Éû„É≥„Éâ„Éë„É¨„ÉÉ„Éà

`ÁÑ°Â§âÊèõ`„Ç≠„Éº„Å®`@`„Ç≠„Éº„ÇíÊäº„Åó„Å¶„Ç≥„Éû„É≥„Éâ„Éë„É¨„ÉÉ„Éà„ÇíË°®Á§∫„Åó„Åæ„ÅôÔºéÂêÑ„Ç≥„Éû„É≥„Éâ„ÅÆÂÆüË£Ö„ÅØ„ÄÅ„Åì„ÅÆ„Éö„Éº„Ç∏„ÅÆÊúÄÂæå„Å´„ÅÇ„Çä„Åæ„ÅôÔºé

```py
def command_PopCommandList():
    # If the list window is already opened, just close it
    if keymap.isListWindowOpened():
        keymap.cancelListWindow()
        return

    def popCommandList():
        commands = [
            ("  :splitlines_with_period", splitlines_with_period),
            ("  :remove_bullet", remove_bullet),
            ("  :remove_breaklines", remove_breaklines),
            ("  :remove_breaklines_with_trim", remove_breaklines_with_trim),
            ("  :replace_zenkaku_punctuation", replace_zenkaku_punctuation),
            ("1 :stanza_runner", stanza_runner),
            ("  :stanza_displacy", stanza_displacy),
            ("  :number_to_half_width", number_to_half_width),
            ("  :number_to_full_width", number_to_full_width),
            ("  :url_encode", url_encode),
            ("  :url_decode", url_decode),
            ("  :uuid", gen_uuid),
            ("  :uuid8", gen_uuid8),
            ("  :config(edit)", keymap.command_EditConfig),
            ("  :config(reload)", keymap.command_ReloadConfig),
            ("  :convert_google_drive_image_url", convert_google_drive_image_url),
            ("  ^since:today", itext("since:" + date_and_time("%Y-%m-%d", 0))),
            ("  ^since:yesterday", itext("since:" + date_and_time("%Y-%m-%d", -1))),
        ]

        listers = [("Commmand", cblister_FixedPhrase(commands))]

        item, mod = keymap.popListWindow(listers)

        if item:
            item[1]()

    # Because the blocking procedure cannot be executed in the key-hook,
    # delayed-execute the procedure by delayedCall().
    keymap.delayedCall(popCommandList, 0)

keymap_global["U0-AtMark"] = command_PopCommandList
```

ÂÆüË°å„Åô„Çã„Å®Ê¨°„ÅÆ„Çà„ÅÜ„Å´„Å™„Çä„Åæ„ÅôÔºé

![](../../static/img/post/keyhac-230127023247.png)

Â∑•Â§´„Åó„Å¶„ÅÑ„Çã„Å®„Åì„Çç„ÅØ `1 :stanza_runner` „Å®„ÅÑ„ÅÜÈÉ®ÂàÜ„Åå„ÅÇ„Çä„Åæ„ÅôÔºé„Åì„Çå„ÅØ„ÄÅ„Ç¶„Ç£„É≥„Éâ„Ç¶„ÇíË°®Á§∫„Åó„Åü„Çâ`1`„Ç≠„Éº„ÇíÊäº„Åô„Å®„Åù„ÅÆ„Ç≥„Éû„É≥„Éâ„ÅåÈÅ∏ÊäûÁä∂ÊÖã„Å´„Å™„Çä„Åæ„ÅôÔºé„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„Åß„Åô„Å≠Ôºé

„ÅÇ„Å®„ÄÅ„Ç≥„Éû„É≥„ÉâÂêç„Åß„ÅØ `^xxx` „ÅßÂÆöÂûãÊñá„Çí„ÄÅ`:xxx`„ÅØ„Åù„Çå‰ª•Â§ñ„Å´ÂàÜÈ°û„Åó„Å¶„ÅÑ„Åæ„ÅôÔºé

‰ª•‰∏ã„ÅÆ2„Å§„ÅÆ„É°„ÇΩ„ÉÉ„Éâ„ÅØ„Åù„Çå„Åû„Çå„ÄÅË®≠ÂÆö„Éï„Ç°„Ç§„É´„ÅÆÁ∑®ÈõÜ„ÄÅÂÜçË™≠„ÅøËæº„Åø„Çí„Åó„Åæ„ÅôÔºéÁâπ„Å´Ë®≠ÂÆö„ÇíÁ∑®ÈõÜ„Åó„Å¶ÂÜçË™≠„ÅøËæº„Åø„ÅØÈ†ªÁπÅ„Å´Âà©Áî®„Åó„Åæ„ÅôÔºé

- keymap.command_EditConfig
- keymap.command_ReloadConfig


### „ÇØ„É™„ÉÉ„Éó„Éú„Éº„ÉâÂ±•Ê≠¥

Keyhac„Åß„ÅØ„ÇØ„É™„ÉÉ„Éó„Éú„Éº„ÉâÂ±•Ê≠¥„ÅÆÊ©üËÉΩ„ÅåÊ®ôÊ∫ñ„ÅßÂÆüË£Ö„Åï„Çå„Å¶„ÅÑ„Åæ„ÅôÔºé„Åù„ÅÆ„Åü„ÇÅ„Å´`„Éï„ÉÉ„ÇØ`„ÇíÊúâÂäπ„Å´„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„ÅôÔºéÁ¢∫Ë™ç„Åô„Çã„Å´„ÅØ„ÄÅ„Ç∑„Çπ„ÉÜ„É†„Éà„É¨„Ç§„Åã„ÇâKeyhac„Ç¢„Ç§„Ç≥„É≥„ÇíÂè≥„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Á¢∫Ë™ç„Åß„Åç„Åæ„ÅôÔºé„ÇØ„É™„ÉÉ„Éó„Éú„Éº„ÉâÂ±•Ê≠¥„ÅÆË®≠ÂÆö„ÅØÊ¨°„ÅÆ„Çà„ÅÜ„Å´„Å™„Å£„Å¶„ÅÑ„Åæ„ÅôÔºé

```py
# Enable clipboard monitoring hook (Default:Enabled)
keymap.clipboard_history.enableHook(True)

# Maximum number of clipboard history (Default:1000)
keymap.clipboard_history.maxnum = 10

# Total maximum size of clipboard history (Default:10MB)
keymap.clipboard_history.quota = 10 * 1024 * 1024
```

ÂàùÊúüË®≠ÂÆö„ÅÆÁä∂ÊÖã„Å†„Å®„ÄÅ„ÇØ„É™„ÉÉ„Éó„Éú„Éº„ÉâÂ±•Ê≠¥„ÅØ `Ctrl+Shift+Z`„Ç≠„Éº„Å´Ââ≤„ÇäÂΩì„Å¶„Çâ„Çå„Å¶„ÅÑ„Åæ„ÅôÔºé

```py
# Open the clipboard history list
keymap_global["C-S-Z"] = keymap.command_ClipboardList
# Move the most recent history to tail
keymap_global["C-S-X"] = keymap.command_ClipboardRotate
# Remove the most recent history
keymap_global["C-S-A-X"] = keymap.command_ClipboardRemove
# Mark for quote pasting
keymap.quote_mark = "> "
```

„Åü„Å†„ÄÅÊ®ôÊ∫ñ„ÅÆË®≠ÂÆö„Åß„ÅØ„Å®„Å¶„ÇÇ‰Ωø„ÅÑ„Å•„Çâ„ÅÑ„Å®ÊÑü„Åò„Åæ„Åó„ÅüÔºéÁí∞Â¢É„Å´„Çà„Çã„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„Çì„Åå„ÄÅ„ÇØ„É™„ÉÉ„Éó„Éú„Éº„ÉâÂ±•Ê≠¥„Åã„Çâ„ÅÆÁõ¥Êé•Ë≤º„Çä‰ªò„Åë„Åå(`Shift+Enter`„Ç≠„Éº)„ÅåÂäπ„Åã„Åö„Å´Âõ∞„Çä„Åæ„Åó„ÅüÔºé„Åæ„Åü„ÄÅÊï∞Â≠ó„Å´„Çà„Çã„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„ÇÇ‰Ωø„ÅÑ„Åü„Åã„Å£„Åü„ÅÆ„Åß„ÄÅËá™Ââç„ÅßÂÆüË£Ö„Åó„Åæ„ÅôÔºéÂπ∏„ÅÑ„Å™„Åì„Å®„Å´„ÇØ„É™„ÉÉ„Éó„Éú„Éº„ÉâÂ±•Ê≠¥Ëá™‰Ωì„ÅØÂèñÂæó„Åô„Çã„Åì„Å®„ÅåÂá∫Êù•„Åæ„Åô„ÅÆ„Åß„ÄÅ„ÅÇ„Å®„ÅØ„Ç≥„Éû„É≥„Éâ„Éë„É¨„ÉÉ„Éà„Å®Âêå„Åò„ÇÑ„ÇäÊñπ„ÅßÂÆüË£Ö„Åó„Åæ„ÅôÔºé„Å§„ÅÑ„Åß„Å´„ÄÅÂÆöÂûãÊñáÊ©üËÉΩ„ÇÇËøΩÂä†„Åó„Åæ„ÅôÔºé

```py
phrase = []
phrase.append(("name", "snippet code here"))

def paste_string(s):
    setClipboardText(s)
    send_keys("C-V")
    
def command_PopHistoryList():
    # If the list window is already opened, just close it
    if keymap.isListWindowOpened():
        keymap.cancelListWindow()
        return

    def popHistoryList():
        def direct_paste(s):
            def _direct_paste():
                paste_string(s)

            return _direct_paste

        histories = []
        items = keymap.clipboard_history.getListItems()
        for i, item in enumerate(items):
            histories.append(("{}: {}".format((i + 1) % 10, item[0]), direct_paste(item[1])))
        for i, item in enumerate(phrase):
            histories.append(("{}: {}".format(chr(ord("a") + i), item[0]), direct_paste(item[1])))

        listers = [("Clipboard", cblister_FixedPhrase(histories))]
        item, mod = keymap.popListWindow(listers)
        if item:
            item[1]()

    # Because the blocking procedure cannot be executed in the key-hook,
    # delayed-execute the procedure by delayedCall().
    keymap.delayedCall(popHistoryList, 0)

keymap_global["U0-Semicolon"] = command_PopHistoryList
```

ÁßÅ„ÅØ`ÁÑ°Â§âÊèõ`„Ç≠„Éº„Å®`;`„Ç≠„Éº„ÅßÂÆüË°å„Åô„Çã„Çà„ÅÜ„Å´Ë®≠ÂÆö„Åó„Å¶„ÅÑ„Åæ„ÅôÔºéÊ¨°„ÅÆ„Çà„ÅÜ„Å´Ë°®Á§∫„Åï„Çå„Åæ„ÅôÔºé

![](../../static/img/post/keyhac-230127024747.png)

`phrase`Â§âÊï∞„ÅßÂÆöÂûãÊñá„ÇíËøΩÂä†„Åß„Åç„Åæ„ÅôÔºé„ÇØ„É™„ÉÉ„Éó„Éú„Éº„ÉâÂ±•Ê≠¥„ÅØÊï∞Â≠ó„Åß„ÄÅÂÆöÂûãÊñá„ÅØ„Ç¢„É´„Éï„Ç°„Éô„ÉÉ„Éà„Åå„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà„Å´„Å™„Çä„Åæ„ÅôÔºé


## Ë®≠ÂÆö„Éï„Ç°„Ç§„É´

ÊúÄÂæå„Å´ÁßÅ„ÅÆË®≠ÂÆö„Éï„Ç°„Ç§„É´„Åã„ÇâÊäúÁ≤ã„Åß„ÅôÔºé

```py title=config.py
import os
import datetime
import time
import re
import unicodedata
import urllib
import uuid
import pyauto
from keyhac import setClipboardText, getClipboardText, cblister_FixedPhrase, JobItem, JobQueue, Window

def configure(keymap):
    class MySetting:
        def __init__(self):
            self.chrome_history = []
            self.debug = False
            self.lw_search_mode = False
            self.phrase = []

    mysetting = MySetting()

    # Phrase
    # mysetting.phrase.append(("name", "snippet code here"))

    # User Define Functions

    def dbg(text):
        if mysetting.debug:
            print("dbg: " + text)

    def itext(text):
        return keymap.InputTextCommand(text)

    def ikey(*keys):
        return keymap.InputKeyCommand(*keys)

    def shell(s, arg=None):
        return keymap.ShellExecuteCommand(None, s, arg, None)

    def shell_mini(s, arg=None):
        return keymap.ShellExecuteCommand(None, s, arg, None, "minimized")

    def delay(sec=0.05):
        time.sleep(sec)

    def get_current_clipboard():
        s = getClipboardText() or ""
        return s

    def send_keys(*keys):
        keymap.beginInput()
        for key in keys:
            keymap.setInput_FromString(str(key))
        keymap.endInput()
        keymap._fixFunnyModifierState()

    def send_string(s):
        keymap.beginInput()
        keymap.setInput_Modifier(0)
        for c in s:
            keymap.input_seq.append(pyauto.Char(c))
        keymap.endInput()

    def send_input(sequence, sleep=0.01):
        for elem in sequence:
            delay(sleep)
            try:
                send_keys(elem)
            except:
                send_string(elem)

    def set_ime(mode):
        if keymap.getWindow().getImeStatus() != mode:
            send_keys("(243)")
            delay(0.01)

    def copy_string(sec=0.01):
        setClipboardText("")
        send_keys("C-Insert")
        delay(sec)
        return get_current_clipboard()

    def paste_string(s):
        setClipboardText(s)
        send_keys("C-V")

    def ime_input0(*sequence):
        def _ime_input0():
            set_ime(0)
            send_input(sequence)

        return _ime_input0

    def ime_input1(*sequence):
        def _ime_input1():
            set_ime(1)
            send_input(sequence)

        return _ime_input1

    def ime_context(func):
        def _ime_context():
            mode = keymap.getWindow().getImeStatus()
            func()
            set_ime(mode)

        return _ime_context

    def set_cursor_pos(x, y):
        keymap.beginInput()
        keymap.input_seq.append(pyauto.MouseMove(x, y))
        keymap.endInput()

    def cursor_to_center():
        wnd = keymap.getTopLevelWindow()
        wnd_left, wnd_top, wnd_right, wnd_bottom = wnd.getRect()
        to_x = int((wnd_left + wnd_right) / 2)
        to_y = int((wnd_bottom + wnd_top) / 2)
        set_cursor_pos(to_x, to_y)

    def get_monitor_areas():
        monitors = pyauto.Window.getMonitorInfo()
        main_monitor_first = sorted(monitors, key=lambda x: x[2], reverse=True)
        non_taskbar_areas = list(map(lambda x: x[1], main_monitor_first))
        return non_taskbar_areas

    def set_window_rect(rect):
        wnd = keymap.getTopLevelWindow()
        if list(wnd.getRect()) == rect:
            wnd.maximize()
        else:
            if wnd.isMaximized():
                wnd.restore()
                delay()
            wnd.setRect(rect)

    def window_to_center_force():
        wnd = keymap.getTopLevelWindow()
        if wnd.isMaximized():
            wnd.restore()
            delay()
        window_to_center()

    def window_to_center():
        wnd = keymap.getTopLevelWindow()
        if wnd.isMaximized():
            return None
        wnd_left, wnd_top, wnd_right, wnd_bottom = wnd.getRect()
        width = wnd_right - wnd_left
        height = wnd_bottom - wnd_top
        mntr_left, mntr_top, mntr_right, mntr_bottom = get_monitor_areas()[0]
        center_h = (mntr_right - mntr_left) / 2
        center_v = (mntr_bottom - mntr_top) / 2
        lx = int(center_h - width / 2)
        ly = int(center_v - height / 2)
        to_rect = (lx, ly, lx + width, ly + height)
        set_window_rect(to_rect)

    def window_to_cursor():
        wnd = keymap.getTopLevelWindow()
        if wnd.isMaximized():
            return None
        wnd_left, wnd_top, wnd_right, wnd_bottom = wnd.getRect()
        width = wnd_right - wnd_left
        height = wnd_bottom - wnd_top
        x, y = pyauto.Input.getCursorPos()
        to_rect = (x, y, x + width, y + height)
        set_window_rect(to_rect)

    def find_window(pattern):
        dbg(">>>>> find_window <<<<<")

        def getWindowList(wnd, arg):
            if not wnd.isVisible():
                return True
            # if not wnd.getOwner():
            #     return True
            if wnd.getText() == "":
                return True
            dbg(wnd.getProcessName())
            dbg("  " + wnd.getClassName())
            dbg("    " + wnd.getText())
            if re.match(
                r"{0}".format(pattern),
                wnd.getProcessName(),
            ):
                dbg("(found)")
                window_list.append(wnd)
                return False
            # if re.match(r"chrome", wnd.getClassName()):m
            #     windom_list.append(wnd)
            return True

        window_list = []
        Window.enum(getWindowList, pattern)

        if len(window_list) > 0:
            return window_list[0]

        dbg("(not found.)")
        return None

    def foreground_window(wnd):
        dbg(">>>>> foreground_window <<<<<")
        if wnd.isMinimized():
            wnd.restore()
            delay()
        wnd.setForeground()

    full_width_chars = (
        "ÔΩÅÔΩÇÔΩÉÔΩÑÔΩÖÔΩÜÔΩáÔΩàÔΩâÔΩäÔΩãÔΩåÔΩçÔΩéÔΩèÔΩêÔΩëÔΩíÔΩìÔΩîÔΩïÔΩñÔΩóÔΩòÔΩôÔΩöÔº°Ôº¢Ôº£Ôº§Ôº•Ôº¶ÔºßÔº®Ôº©Ôº™Ôº´Ôº¨Ôº≠ÔºÆÔºØÔº∞Ôº±Ôº≤Ôº≥Ôº¥ÔºµÔº∂Ôº∑Ôº∏ÔºπÔº∫ÔºÅ‚ÄùÔºÉÔºÑÔºÖÔºÜ‚ÄôÔºàÔºâÔºäÔºãÔºå‚àíÔºéÔºèÔºöÔºõÔºúÔºùÔºûÔºüÔº†ÔºªÔø•ÔºΩÔºæÔºø‚ÄòÔΩõÔΩúÔΩùÔΩûÔºêÔºëÔºíÔºìÔºîÔºïÔºñÔºóÔºòÔºô„ÄÄ"
    )
    half_width_chars = (
        "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!\"#$%&'()*+,-./:;<=>?@[\]^_`{|}ÔΩû0123456789 "
    )

    # Convert to half-with characters
    def to_half_width_clipboard_text():
        s = getClipboardText()
        s = s.translate(str.maketrans(full_width_chars, half_width_chars))
        return s

    # Convert to full-with characters
    def to_full_width_clipboard_text():
        s = getClipboardText()
        s = s.translate(str.maketrans(half_width_chars, full_width_chars))
        return s

    # Convert to half-with characters
    def number_to_half_width():
        s = getClipboardText()
        s = s.translate(str.maketrans("ÔºêÔºëÔºíÔºìÔºîÔºïÔºñÔºóÔºòÔºô", "0123456789"))
        paste_string(s)

    # Convert to full-with characters
    def number_to_full_width():
        s = getClipboardText()
        s = s.translate(str.maketrans("0123456789", "ÔºêÔºëÔºíÔºìÔºîÔºïÔºñÔºóÔºòÔºô"))
        paste_string(s)

    # Convert to emoji numbers
    def to_emoji():
        # emoji = {
        #     ".0": "0Ô∏è‚É£",
        #     ".1": "1Ô∏è‚É£",
        #     ".2": "2Ô∏è‚É£",
        #     ".3": "3Ô∏è‚É£",
        #     ".4": "4Ô∏è‚É£",
        #     ".5": "5Ô∏è‚É£",
        #     ".6": "6Ô∏è‚É£",
        #     ".7": "7Ô∏è‚É£",
        #     ".8": "8Ô∏è‚É£",
        #     ".9": "9Ô∏è‚É£",
        #     ".#": "#Ô∏è‚É£",
        #     ".*": "*Ô∏è‚É£",
        #     ".!": "‚úÖ",
        #     ".a": "üìå",
        #     ".b": "üìñ",
        #     ".c": "üìÅ",
        #     ".d": "üí°",
        #     ".e": "üî∏",
        #     ".f": "üîπ",
        #     ".g": "‚ö†Ô∏è",
        #     ".h": "‚ö°Ô∏è",
        #     ".i": "‚≠êÔ∏è",
        #     ".j": "üî•",
        # }
        # # emoji = {k: v.strip("\ufe0f") for k, v in emoji.items()}
        # s = getClipboardText()
        # # s = s.translate(str.maketrans(emoji))
        # pairs = re.split("(..)", s)[1::2]
        # s = "".join(emoji.get(pair, "") for pair in pairs)
        # paste_string(s)
        #
        # ‰∏äË®ò„ÅÆ„Ç≥„Éº„Éâ„Åß„ÅØ‰∏äÊâã„Åè„ÅÑ„Åã„Å™„ÅÑ„ÅÆ„ÅßPowerShell„ÅßÂÆüË°å.
        # (setClipboardText„Åô„Çã„Å®„Åä„Åã„Åó„Åè„Å™„Çã)
        shell_mini("pwsh.exe", '-nop -f "C:\\Users\\{user}\\convert_to_emoji.ps1"')()

    def url_encode():
        paste_string(urllib.parse.quote(getClipboardText(), safe=""))

    def url_decode():
        paste_string(urllib.parse.unquote(getClipboardText()))

    def next_chrome_window():
        dbg(">>>>> next_chrome_window <<<<<")

        def getWindowList(wnd, arg):
            if not wnd.isVisible():
                return True
            # if not wnd.getOwner():
            #     return True
            if wnd.getText() == "":
                return True
            # dbg(wnd.getProcessName())
            if re.match(r"chrome", wnd.getProcessName()):
                window_list.append(wnd)
            # if re.match(r"chrome", wnd.getClassName()):
            #     window_list.append(wnd)
            # window_list.append(wnd)
            return True

        now = time.time_ns() / 1_000_000  # ms
        history = sorted(mysetting.chrome_history, key=lambda x: x[1], reverse=True)
        if len(history) > 0:
            dbg("{}".format(now - history[0][1]))
            if now - history[0][1] > 5_000:  # 5s
                dbg("clear chrome history")
                mysetting.chrome_history = []
                history = []

        if mysetting.debug:
            for entry in history:
                dbg(f"{entry[0]}, {entry[1]}")

        next_window = (None, -1)
        window_list = []
        Window.enum(getWindowList, None)
        current_wnd_text = keymap.getTopLevelWindow().getText()
        dbg(f"[current] {current_wnd_text}")
        for wnd in window_list:
            text = wnd.getText()
            if current_wnd_text == text:
                continue
            idx = [i for i, e in enumerate(history) if e[0] == text]
            if len(idx) > 0:
                if next_window[1] < idx[0]:
                    dbg(f"found in history: {text}({idx[0]})")
                    next_window = (wnd, idx[0])
            else:
                dbg(f"not found in history: {text}")
                next_window = (wnd, len(history))
                break

        if next_window[0]:
            dbg("[next] " + next_window[0].getText())
            mysetting.chrome_history.append((next_window[0].getText(), now))
            next_window[0].setForeground()

    def truncate(string, length, ellipsis="..."):
        return string[:length] + (ellipsis if string[length:] else "")

    def truncate_cjk(string, length, ellipsis="..."):
        # http://www.unicode.org/reports/tr11/
        count = 0
        text = ""
        for c in string:
            if unicodedata.east_asian_width(c) in "FWA":
                count += 2
            else:
                count += 1

            if count > length:
                text += ellipsis
                break
            text += c
        return text

    def switch_windows():
        dbg(">>>>> switch_windows <<<<<")

        def popWindowList():
            # If the list window is already opened, just close it
            if keymap.isListWindowOpened():
                keymap.cancelListWindow()
                return

            def getWindowList(wnd, arg):
                if not wnd.isVisible():
                    return True
                # if not wnd.getOwner():
                #     return True
                if wnd.getText() == "":
                    return True
                dbg(wnd.getProcessName())
                dbg("  " + wnd.getClassName())
                dbg("    " + wnd.getText())
                if re.match(
                    r"(keyhac|DesktopTicker|SystemSettings|ApplicationFrameHost|TextInputHost|explorer|onenoteim)\.exe",
                    wnd.getProcessName(),
                ):
                    dbg("(pass)")
                    return True
                # if re.match(r"chrome", wnd.getClassName()):
                #     window_list.append(wnd)
                window_list.append(wnd)
                return True

            window_list = []
            Window.enum(getWindowList, None)

            popup_list = [
                ("{:>20s} :: {}".format(truncate(i.getProcessName()[:-4], 17), truncate_cjk(i.getText(), 45)), i)
                for i in sorted(window_list, key=lambda x: x.getProcessName())
            ]

            if mysetting.debug:
                for i in popup_list:
                    dbg(i[0])

            listers = [("Windows", cblister_FixedPhrase(popup_list))]
            item, mod = keymap.popListWindow(listers)
            if item:
                item[1].setForeground()

        # Because the blocking procedure cannot be executed in the key-hook,
        # delayed-execute the procedure by delayedCall().
        keymap.delayedCall(popWindowList, 0)



    # Setting with program file path (Simple usage)
    keymap.editor = "code"

    # Font
    keymap.setFont("Sarasa Fixed Slab J Semibold", 24)

    # Theme
    keymap.setTheme("black")

    # Simple key replacement
    keymap.replaceKey("(29)", 235)  # ÁÑ°Â§âÊèõ
    keymap.replaceKey("(28)", 236)  # Â§âÊèõ

    # User modifier key definition
    keymap.defineModifier(235, "User0")
    keymap.defineModifier(236, "User1")

    # Global keymap which affects any windows
    keymap_global = keymap.defineWindowKeymap()
    keymap.quote_mark = "> "  # Mark for quote pasting

    keymap_global["S-RCtrl"] = cursor_to_center
    keymap_global["C-RCtrl"] = window_to_center
    keymap_global["U0-RCtrl"] = window_to_cursor
    keymap_global["U0-Space"] = switch_windows
    keymap_global["U0-F7"] = next_chrome_window
    keymap_global["U0-F8"] = window_to_center_force
    keymap_global["U0-F9"] = shell(
        "C:\\Program Files\\Google\\Chrome\\Application\\Chrome.exe",
        "--new-window https://www.google.com/webhp?hl=ja",
    )
    keymap_global["U0-Right"] = ikey("S-A-Right", "S-A-Right")

    def switch_zulip():
        wnd = find_window("^Zulip")
        if wnd:
            foreground_window(wnd)
        else:
            dbg("(start zulip.)")
            shell("C:\\Users\\{user}\\AppData\\Local\\Programs\\zulip\\Zulip.exe")()

    keymap_global["U0-M"] = switch_zulip
    keymap_global["U0-P"] = keymap.defineMultiStrokeKeymap("PARENTHES: [1]„Ää„Äã [2]„Äà„Äâ [3]„Äî„Äï [4]„Äé„Äè [5]„Äê„Äë [6]ÔºàÔºâ [7]()")
    for key, args in {
        "1": ["„Ää„Äã", "Left"],
        "2": ["„Äà„Äâ", "Left"],
        "3": ["„Äî„Äï", "Left"],
        "4": ["„Äé„Äè", "Left"],
        "5": ["„Äê„Äë", "Left"],
        "6": ["ÔºàÔºâ", "Left"],
        "7": ["()", "Left"],
    }.items():
        keymap_global["U0-P"][key] = ime_input1(*args)

    def input_date(fmt):
        def _input_data():
            d = datetime.datetime.today()
            date_str = d.strftime(fmt)
            set_ime(0)
            send_input(date_str, 0)

        return _input_data

    keymap_global["U0-D"] = keymap.defineMultiStrokeKeymap("DATE: [1]YMD, [2]Y/M/D, [3]Y-M-D")
    for key, args in {
        "1": ["%Y%m%d"],
        "2": ["%Y/%m/%d"],
        "3": ["%Y-%m-%d"],
    }.items():
        keymap_global["U0-D"][key] = input_date(*args)

    keymap_global["U0-8"] = ime_context(ime_input0("S-8"))
    keymap_global["U0-9"] = ime_context(ime_input0("S-9"))
    keymap_global["U0-OpenBracket"] = ime_context(ime_input0("OpenBracket"))
    keymap_global["U0-CloseBracket"] = ime_context(ime_input0("CloseBracket"))
    keymap_global["U0-Slash"] = ime_context(ime_input0("Slash"))

    def splitlines_with_period():
        s = get_current_clipboard()
        s = s.replace("\r\n", "").split(".")
        s = ".\r\n".join(list(map(str.strip, s)))
        paste_string(s)

    def remove_bullet():
        paste_string(get_current_clipboard().replace(" ‚àô ", " ").replace("‚àô", ""))

    def remove_breaklines():
        paste_string(get_current_clipboard().replace("\r\n", ""))

    def remove_breaklines_with_trim():
        paste_string("".join(list(map(str.strip, get_current_clipboard().split("\r\n")))))

    def replace_zenkaku_punctuation():
        paste_string(get_current_clipboard().replace("Ôºé", "„ÄÇ"))

    def stanza_runner():
        paste_string('p ./stanza_runner.py "{}"'.format(get_current_clipboard().replace('"', '""')))

    def stanza_displacy():
        paste_string('p ./stanza_displacy.py "{}"'.format(get_current_clipboard().replace('"', '""')))

    def convert_google_drive_image_url():
        # https://drive.google.com/open?id=XXXX&authuser=xxx.gmail.com&usp=drive_fs
        # -> https://drive.google.com/file/d/XXXX/view
        s = getClipboardText()
        result = re.match("https://.+open\?id=(\w+)", s)
        if result:
            paste_string("https://drive.google.com/file/d/{0}/view".format(result.group(1)))

    # Return formatted date-time string
    def date_and_time(fmt, d):
        return (datetime.datetime.now() + datetime.timedelta(d)).strftime(fmt)

    def gen_uuid():
        s = getClipboardText()
        uid = str(uuid.uuid5(uuid.uuid1(), s))
        paste_string(uid.replace("-", ""))

    def gen_uuid8():
        s = getClipboardText()
        uid = str(uuid.uuid5(uuid.uuid1(), s))
        paste_string(uid[0:8])

    def command_PopCommandList():
        # If the list window is already opened, just close it
        if keymap.isListWindowOpened():
            keymap.cancelListWindow()
            return

        def popCommandList():
            commands = [
                ("  :splitlines_with_period", splitlines_with_period),
                ("  :remove_bullet", remove_bullet),
                ("  :remove_breaklines", remove_breaklines),
                ("  :remove_breaklines_with_trim", remove_breaklines_with_trim),
                ("  :replace_zenkaku_punctuation", replace_zenkaku_punctuation),
                ("1 :stanza_runner", stanza_runner),
                ("  :stanza_displacy", stanza_displacy),
                ("  :number_to_half_width", number_to_half_width),
                ("  :number_to_full_width", number_to_full_width),
                ("  :to_emoji", to_emoji),
                ("  :url_encode", url_encode),
                ("  :url_decode", url_decode),
                ("  :uuid", gen_uuid),
                ("  :uuid8", gen_uuid8),
                ("  :config(edit)", keymap.command_EditConfig),
                ("  :config(reload)", keymap.command_ReloadConfig),
                ("  :convert_google_drive_image_url", convert_google_drive_image_url),
                ("  ^since:today", itext("since:" + date_and_time("%Y-%m-%d", 0))),
                ("  ^since:yesterday", itext("since:" + date_and_time("%Y-%m-%d", -1))),
            ]

            listers = [("Commmand", cblister_FixedPhrase(commands))]

            item, mod = keymap.popListWindow(listers)

            if item:
                item[1]()

        # Because the blocking procedure cannot be executed in the key-hook,
        # delayed-execute the procedure by delayedCall().
        keymap.delayedCall(popCommandList, 0)

    keymap_global["U0-AtMark"] = command_PopCommandList

    def command_PopHistoryList():
        # If the list window is already opened, just close it
        if keymap.isListWindowOpened():
            keymap.cancelListWindow()
            return

        def popHistoryList():
            def direct_paste(s):
                def _direct_paste():
                    paste_string(s)

                return _direct_paste

            histories = []
            items = keymap.clipboard_history.getListItems()
            for i, item in enumerate(items):
                histories.append(("{}: {}".format((i + 1) % 10, item[0]), direct_paste(item[1])))
            for i, item in enumerate(mysetting.phrase):
                histories.append(("{}: {}".format(chr(ord("a") + i), item[0]), direct_paste(item[1])))

            listers = [("Clipboard", cblister_FixedPhrase(histories))]
            item, mod = keymap.popListWindow(listers)
            if item:
                item[1]()

        # Because the blocking procedure cannot be executed in the key-hook,
        # delayed-execute the procedure by delayedCall().
        keymap.delayedCall(popHistoryList, 0)

    keymap_global["U0-Semicolon"] = command_PopHistoryList

    def lw_search():
        ikey("F")()
        mysetting.lw_search_mode = True

    def lw_exit():
        if mysetting.lw_search_mode:
            ikey("Esc", "Esc")()
        else:
            ikey("Esc")()

    def is_list_window(window):
        if window.getClassName() == "KeyhacWindowClass" and window.getText() != "Keyhac":
            mysetting.lw_search_mode = False
            return True
        else:
            return False

    keymap_lw = keymap.defineWindowKeymap(check_func=is_list_window)
    keymap_lw["U0-N"] = ikey("Down")
    keymap_lw["U0-P"] = ikey("Up")
    keymap_lw["U0-AtMark"] = lambda: [window_to_center(), lw_search()]
    keymap_lw["U0-Space"] = lambda: [window_to_center(), lw_search()]
    keymap_lw["U0-Semicolon"] = lambda: [window_to_center(), lw_search()]
    keymap_lw["Enter"] = ikey("Enter", "Enter")
    keymap_lw["Escape"] = lw_exit

    # Customizing clipboard history list

    # Enable clipboard monitoring hook (Default:Enabled)
    keymap.clipboard_history.enableHook(True)

    # Maximum number of clipboard history (Default:1000)
    keymap.clipboard_history.maxnum = 10

    # Total maximum size of clipboard history (Default:10MB)
    keymap.clipboard_history.quota = 10 * 1024 * 1024
```

`{user}`„ÅØ„ÄÅWindows„ÅÆ„É¶„Éº„Ç∂„ÉºÂêç„Å´ÁΩÆ„ÅçÊèõ„Åà„Å¶„Åè„Å†„Åï„ÅÑÔºé„Åæ„Åü„ÄÅÁµµÊñáÂ≠ó„ÇíÂ§âÊèõ„Åô„ÇãPowerShell„Çπ„ÇØ„É™„Éó„Éà„ÅØÊ¨°„ÅÆ„Çà„ÅÜ„Å´„Å™„Å£„Å¶„ÅÑ„Åæ„ÅôÔºé

```powershell title=convert_to_emoji.ps1
$emoji = @{
    "0"= "0Ô∏è‚É£"
    "1"= "1Ô∏è‚É£"
    "2"= "2Ô∏è‚É£"
    "3"= "3Ô∏è‚É£"
    "4"= "4Ô∏è‚É£"
    "5"= "5Ô∏è‚É£"
    "6"= "6Ô∏è‚É£"
    "7"= "7Ô∏è‚É£"
    "8"= "8Ô∏è‚É£"
    "9"= "9Ô∏è‚É£"
    "#"= "#Ô∏è‚É£"
    "*"= "*Ô∏è‚É£"
    "!"= "‚úÖ"
    "a"= "üìå"
    "b"= "üìñ"
    "c"= "üìÅ"
    "d"= "üí°"
    "e"= "üî∏"
    "f"= "üîπ"
    "g"= "‚ö†Ô∏è"
    "h"= "‚ö°Ô∏è"
    "i"= "‚≠êÔ∏è"
    "j"= "üî•"
}
$chars = Get-Clipboard
$result = ""
foreach ($_ in $chars.ToCharArray()) {
    if ($emoji.ContainsKey("${_}")) {
        $result += $emoji["${_}"];
    } else {
        $result += $_;
    }
}
Set-Clipboard $result
```

‰ª•‰∏ä„Åß„ÅôÔºéKeyhac„ÅØ„Å®„Å¶„ÇÇ‰æøÂà©„Å™„ÅÆ„Åß„ÄÅËààÂë≥„Åå„ÅÇ„Çå„Å∞‰Ωø„Å£„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑÔºé