<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://mebiusbox.github.io/blog</id>
    <title>Mebiusbox software Blog</title>
    <updated>2024-10-12T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://mebiusbox.github.io/blog"/>
    <subtitle>Mebiusbox software Blog</subtitle>
    <icon>https://mebiusbox.github.io/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[Eagleで無効なフォルダが存在する問題]]></title>
        <id>https://mebiusbox.github.io/blog/2024/10/12/eagle-unused-directory-in-library</id>
        <link href="https://mebiusbox.github.io/blog/2024/10/12/eagle-unused-directory-in-library"/>
        <updated>2024-10-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Eagleで無効なフォルダが存在することがあり、ディスク容量を無駄に消費する場合があります]]></summary>
        <content type="html"><![CDATA[<p>Eagleを使っているとライブラリの中に無効なフォルダが存在することがあります．
ここではこの無効なフォルダに関する内容を残しておきます</p>
<p><a href="https://jp.eagle.cool/" target="_blank" rel="noopener noreferrer">Eagle</a>を使っていると、ライブラリの中に無効なフォルダがあることに気づきました．
この無効なフォルダとはEagleからは認識されていないフォルダのことです．</p>
<p>Eagleでは1つのファイルごとにディレクトリがライブラリの<code>images</code>ディレクトリの中に作成され管理されているようです．
その中に<code>metadata.json</code>ファイルやサムネイルなどが格納されています．
無効なフォルダはこの<code>metadata.json</code>ファイルが入っていません．ですから、Eagleからは認識されていないようです．
ただし、確認したのは検索で見つかるかどうかなので、もしかすると内部では参照している可能性もあります．
記憶が曖昧なので、それが削除したものなのかEagleの不具合によって発生したのか見当がつきません．
少なくともEagleでのごみ箱は空になっている状態で、検索で見つからない以上、無効なフォルダと言っていいでしょう．</p>
<p>無効なフォルダを調べてみると、削除したものや重複したものがありました．それらは不要なので削除しておきたいです．</p>
<p>この無効なフォルダを探す場合はライブラリ内のディレクトリを走査して<code>metadata.json</code>ファイルが存在するかどうかを確認すればよさそうです．
そこで、次のようなPowerShellスクリプトを作成してライブラリを走査し、無効なフォルダがあれば出力しています．また、削除する機能も入れました．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">Move-ToRecycleBin</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">CmdletBinding</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">SupportsShouldProcess = </span><span class="token boolean" style="color:#ae81ff">$True</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> DefaultParameterSetName = </span><span class="token string" style="color:#a6e22e">'Path'</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">Param</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[SupportsWildCards()]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">Parameter</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      Mandatory = </span><span class="token boolean" style="color:#ae81ff">$True</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      Position = 0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ParameterSetName = </span><span class="token string" style="color:#a6e22e">'Path'</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ValueFromPipeline = </span><span class="token boolean" style="color:#ae81ff">$True</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ValueFromPipelineByPropertyName = </span><span class="token boolean" style="color:#ae81ff">$True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[string[]]</span><span class="token variable" style="color:#f8f8f2">$Path</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">Alias</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">'LP'</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">Alias</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">'PSPath'</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">Parameter</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      Mandatory = </span><span class="token boolean" style="color:#ae81ff">$True</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      Position = 0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ParameterSetName = </span><span class="token string" style="color:#a6e22e">'LiteralPath'</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ValueFromPipeline = </span><span class="token boolean" style="color:#ae81ff">$False</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      ValueFromPipelineByPropertyName = </span><span class="token boolean" style="color:#ae81ff">$True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[string[]]</span><span class="token variable" style="color:#f8f8f2">$LiteralPath</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">Begin</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$shell</span><span class="token plain"> = </span><span class="token function" style="color:#e6db74">New-Object</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">ComObject Shell</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Application</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$trash</span><span class="token plain"> = </span><span class="token variable" style="color:#f8f8f2">$shell</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">NameSpace</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">10</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">Process</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$PSBoundParameters</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ContainsKey</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">'Path'</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token variable" style="color:#f8f8f2">$targets</span><span class="token plain"> = </span><span class="token function" style="color:#e6db74">Convert-Path</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$Path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token variable" style="color:#f8f8f2">$targets</span><span class="token plain"> = </span><span class="token function" style="color:#e6db74">Convert-Path</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">LiteralPath </span><span class="token variable" style="color:#f8f8f2">$LiteralPath</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$targets</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">Foreach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$PSCmdlet</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ShouldProcess</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token variable" style="color:#f8f8f2">$trash</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">MoveHere</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> CheckUnused</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[CmdletBinding()]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">param</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[string]</span><span class="token variable" style="color:#f8f8f2">$LibraryPath</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[switch]</span><span class="token variable" style="color:#f8f8f2">$Remove</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[switch]</span><span class="token variable" style="color:#f8f8f2">$Force</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#e6db74">Test-Path</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">LiteralPath </span><span class="token variable" style="color:#f8f8f2">$LibraryPath</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$ImagePath</span><span class="token plain"> = </span><span class="token function" style="color:#e6db74">Join-Path</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$LibraryPath</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"images"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#e6db74">Get-ChildItem</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">Directory </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">LiteralPath </span><span class="token variable" style="color:#f8f8f2">$ImagePath</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token function" style="color:#e6db74">Write-Progress</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">Activity </span><span class="token string" style="color:#a6e22e">"Checking..."</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">Status </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Name</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token variable" style="color:#f8f8f2">$metaDataJson</span><span class="token plain"> = </span><span class="token function" style="color:#e6db74">Join-Path</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">FullName </span><span class="token string" style="color:#a6e22e">"metadata.json"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#66d9ef">-not</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#e6db74">Test-Path</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">LiteralPath </span><span class="token variable" style="color:#f8f8f2">$metaDataJson</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token function" style="color:#e6db74">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Unused: </span><span class="token string function" style="color:#e6db74">$</span><span class="token string function punctuation" style="color:#f8f8f2">(</span><span class="token string function variable" style="color:#f8f8f2">$_</span><span class="token string function punctuation" style="color:#f8f8f2">.</span><span class="token string function" style="color:#e6db74">FullName</span><span class="token string function punctuation" style="color:#f8f8f2">)</span><span class="token string" style="color:#a6e22e">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token function" style="color:#e6db74">Get-ChildItem</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">LiteralPath </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">FullName </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token string" style="color:#a6e22e">"    "</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">+</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Name</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$Remove</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$Force</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token function" style="color:#e6db74">Move-ToRecycleBin</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">LiteralPath </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">FullName</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token function" style="color:#e6db74">Move-ToRecycleBin</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">Literalpath </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">FullName </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">Confirm</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ここで使用している<code>Move-ToRecycleBin</code>はゴミ箱への削除機能で「<a href="https://zenn.dev/zuishin/articles/2019_03_02_1fa77bccd111b55f7bf6" target="_blank" rel="noopener noreferrer">PowerShell でファイルやフォルダをごみ箱に入れる</a>」を参考にして作成したものです．</p>
<p><code>CheckUnused</code>コマンドレットでEagleのライブラリをチェックします．<code>-LibraryPath</code>には<code>xxx.library</code> (xxxは任意)のパスを指定します．
<code>-Remove</code>で削除します．通常は削除確認しますが、<code>-Force</code>を有効にすれば確認せずに削除します．</p>
<p>なお、ここに記述しているコードは使用する場合は自己責任でお願いいたします．</p>
<p>以上です．</p>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="eagle" term="eagle"/>
        <category label="powershell" term="powershell"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[ForEach-Objectにおけるcontinueとbreakについて]]></title>
        <id>https://mebiusbox.github.io/blog/2024/10/11/foreach-object-continue-break</id>
        <link href="https://mebiusbox.github.io/blog/2024/10/11/foreach-object-continue-break"/>
        <updated>2024-10-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[誤解を招きやすいForEach-Objectでのcontinueとbreakについて]]></summary>
        <content type="html"><![CDATA[<p>ForEach-Object内での<code>continue</code>や<code>break</code>に関する備忘録です．</p>
<p>PowerShellでパイプライン処理のfor文として <code>ForEach-Object</code> をよく使います．これは <code>foreach</code> や <code>%</code> のエイリアスがあります．
この <code>foreach</code> エイリアスと <code>foreach(in)</code> は別物です．本文では <code>foreach(in)</code> は次のような構文を指しているとします．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$i</span><span class="token plain"> in </span><span class="token variable" style="color:#f8f8f2">$arr</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>ForEach-Object</code> は便利な反面、誤解を招きやすいものだと思います．
実際、AIチャットも見当違いな回答をしていましたし、ネットでも間違った内容が見受けられました．
かくいう私も絶対の確信をもっていっているわけではないので、ご了承ください．動作環境はPowerShell<code>7.4.5</code>です．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="foreach-object-に-continue-や-break-は使えない">ForEach-Object に continue や break は使えない<a class="hash-link" aria-label="ForEach-Object に continue や break は使えない ��への直接リンク" title="ForEach-Object に continue や break は使えない への直接リンク" href="https://mebiusbox.github.io/blog/2024/10/11/foreach-object-continue-break#foreach-object-%E3%81%AB-continue-%E3%82%84-break-%E3%81%AF%E4%BD%BF%E3%81%88%E3%81%AA%E3%81%84">​</a></h2>
<p>これがすべてです．使えるのは <code>return</code> です．<code>ForEach-Object</code>はパイプライン処理であって、<code>continue</code>や<code>break</code>はパイプラインに直接作用しません．
<code>continue</code>や<code>break</code>が作用するのは内側のループ処理に対してです．ちなみに、ループがなければプログラム全体に作用しますので、その場合はプログラムが終了します．</p>
<p>たとえば次のプログラムでは、<code>continue</code> が実行されたときにプログラムが終了します．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">test.ps1</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">1</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">5 </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-gt</span><span class="token plain"> 3</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">continue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#e6db74">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"CHECKPOINT"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>この出力は次のようになります．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">1</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">2</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>CHECKPOINT</code>は出力されません．これは <code>break</code> でも同じです．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">1</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">5 </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-gt</span><span class="token plain"> 3</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#e6db74">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"CHECKPOINT"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>この場合、次のように<code>return</code>を使うと意図した動作になります．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">1</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">5 </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-gt</span><span class="token plain"> 3</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#e6db74">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"CHECKPOINT"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>この出力は次のようになります．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">1</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">2</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">3</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">CHECKPOINT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>このコードではすべてのパイプラインが実行されていることに注意してください．5回処理されています．
<code>break</code>のように中断されるわけではありません．
<code>continue</code>や<code>break</code>を使いたい場合は、ループ回数が分かっているなら <code>foreach(in)</code> を使うか <code>for</code>文を使いましょう．</p>
<p>では、パイプライン処理で中断させたいときはどうすればいいでしょうか．1つの方法としてパイプラインの外にループを入れて<code>break</code>することです．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    1</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">5 </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-gt</span><span class="token plain"> 3</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token boolean" style="color:#ae81ff">$false</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#e6db74">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"CHECKPOINT"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>この出力は次のようになります．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">1</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">2</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">3</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">CHECKPOINT</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>continue</code>や<code>break</code>は<code>ForEach-Object</code>に対して使いたくなるし、<code>foreach</code>というエイリアスもあって間違えやすいですよね．
以上です．</p>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="powershell" term="powershell"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[WindowsでTensorflow(GPU)を使う]]></title>
        <id>https://mebiusbox.github.io/blog/2024/09/20/tensorflow-gpu-for-windows</id>
        <link href="https://mebiusbox.github.io/blog/2024/09/20/tensorflow-gpu-for-windows"/>
        <updated>2024-09-20T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[WindowsでWSLとDocker Desktopを使ってTensorflowがGPUを使うようにする方法]]></summary>
        <content type="html"><![CDATA[<p>WindowsでTensorflowがGPUを使えるようにするための方法をここに記録しておきます．
また、それに関係するWSLやDocker Desktopについてもまとめておきます．</p>
<p>試した環境はWindowsでpythonの仮想環境を構築して、Visual Studio CodeのJupyter拡張機能を使っています．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tensorflow-intel">tensorflow-intel<a class="hash-link" aria-label="tensorflow-intel への直接リンク" title="tensorflow-intel への直接リンク" href="https://mebiusbox.github.io/blog/2024/09/20/tensorflow-gpu-for-windows#tensorflow-intel">​</a></h2>
<p>Tensorflowを使う機会があったので、普通に Tensorflow を <code>uv add tensorflow</code> でインストールしてみました．
とりあえず、インストールはできたみたいなのですが、Jupyter Notebook からインポートしてもモジュールが見つかりませんとエラーになります．
まずは<code>uv pip list</code>を実行してインストールされていることを確認しました．
あとはネットで検索したりして同様な症状が発生しているときの対処方法を試してみても変わらず．
そこで、<code>uv pip show tensorflow</code> としたところ次のように表示されました．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Name: tensorflow</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Version: 2</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">17</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">0</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Location: F:\src\jupyter\</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">venv\Lib\site-packages</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Requires: tensorflow-intel</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Required-by:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>どうやら<code>tensorflow-intel</code>が必要みたいです．確認してみるとインストールされていませんでした．
uvでは依存解決できなかったらしく、直接指定してインストールすることで Jupyter Notebookからでもモジュールが見つかるようになりました．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tensorflow-gpu対応">tensorflow (GPU対応)<a class="hash-link" aria-label="tensorflow (GPU対応) への直接リンク" title="tensorflow (GPU対応) への直接リンク" href="https://mebiusbox.github.io/blog/2024/09/20/tensorflow-gpu-for-windows#tensorflow-gpu%E5%AF%BE%E5%BF%9C">​</a></h2>
<p><code>tensorflow-intel</code>が必要だったので、GPUの対応はどうなっているのか気になりました．
そこで調べてみると、最近のWindows用 tensorflow はGPUに対応していないみたいです．
どうやらWSL2を使えばいいらしいので、試してみることにしました．また、Dockerイメージも用意されているみたいなので、それも使うことにします．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="wsl2--docker-desktop">WSL2 + Docker Desktop<a class="hash-link" aria-label="WSL2 + Docker Desktop への直接リンク" title="WSL2 + Docker Desktop への直接リンク" href="https://mebiusbox.github.io/blog/2024/09/20/tensorflow-gpu-for-windows#wsl2--docker-desktop">​</a></h2>
<p>WSLは環境構築済みで、Ubuntu (<code>22.04.5 LTS</code>) を使っています．
Docker Desktopは最新のものをインストールしています．</p>
<p>あまり両者とも使っていなかったので、整理することにしました．
Ubuntuは再インストールして最低限の設定をしておきました．
問題は Docker Desktop です．イメージが肥大化していくので大容量HDDに移動しておこうと思います．</p>
<p>色々調べてみると情報が結構古かったので調べたり試したりして得られたことをここに書いておきます．
もしかすると設定が必要なのかもしれませんが、そこはご了承ください．</p>
<p>まず、Docker Desktop は WSL2 をバックエンドとして実行されます．
Docker DesktopをWSL2にインテグレーションすると <code>docker-desktop</code> というディストリビューションが作られます．
これは <code>docker-desktop</code> と <code>docker-desktop-data</code> の2つが作成されるとネットでよく見たのですが、最新は1つだけのようです．
また、データの格納先も変わっていました．</p>
<p>旧バージョン</p>
<table><thead><tr><th style="text-align:left">ディストリビューション</th><th style="text-align:left">場所</th></tr></thead><tbody><tr><td style="text-align:left">docker-desktop</td><td style="text-align:left"><code>%LocalAppData%\Docker\wsl\distro\ext4.vhdx</code></td></tr><tr><td style="text-align:left">docker-desktop-data</td><td style="text-align:left"><code>%LocalAppData%\Docker\wsl\data\ext4.vhdx</code></td></tr></tbody></table>
<p>最新</p>
<table><thead><tr><th style="text-align:left">ディストリビューション</th><th style="text-align:left">場所</th></tr></thead><tbody><tr><td style="text-align:left">docker-desktop</td><td style="text-align:left"><code>%LocalAppData%\Docker\wsl\disk\docker_data.vhdx</code></td></tr></tbody></table>
<p>このファイルがどんどん肥大化していくので、別のドライブにしたいのです．
まず、Docker Desktop自体に設定で場所を変更できる機能がありますが、試したところ失敗することが多く、まったく安定しません．
次に、エクスポート・インポートする方法がありますが、ちょっと面倒ですし、人によっては上手くいかないこともあるようです．
なので、シンボリックリンクを作成して<code>%LocalAppData%\Docker\wsl</code>ディレクトリを別のドライブにリンクするようにしました．</p>
<p>あと、WSL2にインテグレーションすると、WSL側のディストリビューションで docker コマンドが Docker Desktop を経由するようになります．
この場合、別途 Docker をインストールする必要がありません．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tensorflow-gpu">tensorflow-gpu<a class="hash-link" aria-label="tensorflow-gpu への直接リンク" title="tensorflow-gpu への直接リンク" href="https://mebiusbox.github.io/blog/2024/09/20/tensorflow-gpu-for-windows#tensorflow-gpu">​</a></h2>
<p>これで WSL2(Ubuntu) で Docker を使う環境が整ったので、あとはイメージをpullして実行するだけです．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">docker pull tensorflow/tensorflow:latest-gpu</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">docker run </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">gpus all </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">it </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">name tfgpu tensorflow/tensorflow:latest-gpu</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>必要に応じてマウントを追加してください．
あとは、Visual Studio Codeの Dev Containerを使ってアタッチします．
実行するカーネルを選択したり、Jupyter notebookを使うために拡張機能や ipykernel のインストールなどが求められますのでインストールします．
諸々設定が終わったらGPUを認識しているか確認します．</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">IN</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">import</span><span class="token plain"> tensorflow </span><span class="token keyword" style="color:#66d9ef">as</span><span class="token plain"> tf</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">tf</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">config</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">list_physical_devices</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">"GPU"</span><span class="token punctuation" style="color:#f8f8f2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">OUT</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">PhysicalDevice</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">name=</span><span class="token string" style="color:#a6e22e">'/physical_device:GPU:0'</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> device_type=</span><span class="token string" style="color:#a6e22e">'GPU'</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ちゃんと認識しているみたいです．</p>
<p>ちなみに、Jupyter notebookのサーバーを立ち上げたい場合は <code>tensorflow/tensorflow:latest-gpu-jupyter</code> を使います．</p>
<p>以上です．</p>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="wsl" term="wsl"/>
        <category label="ubuntu" term="ubuntu"/>
        <category label="docker" term="docker"/>
        <category label="tensorflow" term="tensorflow"/>
        <category label="python" term="python"/>
        <category label="jupyter" term="jupyter"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[cargo-makeを少し使いやすくする]]></title>
        <id>https://mebiusbox.github.io/blog/2024/09/15/improve-cargo-make</id>
        <link href="https://mebiusbox.github.io/blog/2024/09/15/improve-cargo-make"/>
        <updated>2024-09-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[cargo-makeをより使いやすくするためのPowerShellスクリプト]]></summary>
        <content type="html"><![CDATA[<p>タスクランナーとしてcargo-makeを使用しています．
ここでは、より使いやすくするためのPowerShellスクリプトを作成したのでここに残しておきます．</p>
<p><a href="https://github.com/sagiegurari/cargo-make" target="_blank" rel="noopener noreferrer">cargo-make</a>はタスクランナーです．
汎用的に使えるタスクランナーを探していて、他にも <a href="https://github.com/casey/just" target="_blank" rel="noopener noreferrer">Just</a> がありました．
cargo-makeは基本的にRust言語の開発用ツールですが、Rust言語以外でも汎用的に使うことができます．
また、Makefile形式よりかはTOML形式の記述に統一していきたいとも思っていて、cargo-makeを利用しています．
ちなみに、機能的にはどちらでも問題なさそうな感じでした．</p>
<p>cargo-makeを日常的に使っていて、ちょっとこういう機能が欲しいなとかここを改善してほしいなと思うところがありました．
そこで、PowerShellでWrapper関数（コマンドレット）を作成してみました．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="タスク一覧">タスク一覧<a class="hash-link" aria-label="タスク一覧 への直接リンク" title="タスク一覧 への直接リンク" href="https://mebiusbox.github.io/blog/2024/09/15/improve-cargo-make#%E3%82%BF%E3%82%B9%E3%82%AF%E4%B8%80%E8%A6%A7">​</a></h2>
<p>まずは、タスクの一覧表示の改善です．cargo-makeは<code>--list-all-steps</code>オプションを指定することでタスクの一覧を表示できます．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">PS</span><span class="token plain"> &gt; cargo make </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">list-all-steps</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[cargo-make]</span><span class="token plain"> INFO </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain"> cargo make 0</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">37</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">16</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[cargo-make]</span><span class="token plain"> INFO </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain"> Build File: Makefile</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">toml</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[cargo-make]</span><span class="token plain"> INFO </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain"> Task: default</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[cargo-make]</span><span class="token plain"> INFO </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain"> Profile: development</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Hooks</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token operator" style="color:#66d9ef">--</span><span class="token operator" style="color:#66d9ef">--</span><span class="token operator" style="color:#66d9ef">--</span><span class="token operator" style="color:#66d9ef">--</span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain"> By default this task is invoked at the </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"> of every cargo-make run</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">init </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain"> By default this task is invoked at the </span><span class="token function" style="color:#e6db74">start</span><span class="token plain"> of every cargo-make run</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">No Category</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token operator" style="color:#66d9ef">--</span><span class="token operator" style="color:#66d9ef">--</span><span class="token operator" style="color:#66d9ef">--</span><span class="token operator" style="color:#66d9ef">--</span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">dev </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain"> Run gradio with watch mode </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[aliases: default]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resize </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain"> Resize image</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">serve </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain"> Serve app</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Tools</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token operator" style="color:#66d9ef">--</span><span class="token operator" style="color:#66d9ef">--</span><span class="token operator" style="color:#66d9ef">--</span><span class="token operator" style="color:#66d9ef">--</span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">empty </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain"> Empty Task</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>正直なところ見やすいとは言いづらいですね．
これは数が少ないからいいですが、多くなってくるとわかりづらくなります．
カテゴリを指定するオプションもありますが、まずはどんなカテゴリがあるかの確認もしたいです．</p>
<p>これを整形して見やすくしましょう．
具体的には出力内容から必要な文字を読み取って、カスタムオブジェクトに変換して表示します．
こうすることで PowerShell上で色々操作ができるようになります．
ここではさらに<a href="https://github.com/wfxr/csview" target="_blank" rel="noopener noreferrer">csview</a>を使って見やすく表示します．
そのためにカスタムオブジェクトからCSV形式に変換(<code>ConvertTo-Csv</code>)を使います．</p>
<p>これを使うと（コードは後述）さきほどのタスク一覧が次のように表示されます:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">PS</span><span class="token plain"> &gt; psmake </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">List</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">┌────────┬───────────────────────────────────────────────┬─────────────┐</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">│  Name  │                  Description                  │  Category   │</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">├────────┼───────────────────────────────────────────────┼─────────────┤</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">│ dev    │ Run gradio with watch mode </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[aliases: default]</span><span class="token plain"> │ No Category │</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">│ resize │ Resize image                                  │ No Category │</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">│ serve  │ Serve app                                     │ No Category │</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">│ empty  │ Empty Task                                    │ Tools       │</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">└────────┴───────────────────────────────────────────────┴─────────────┘</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="タスク選択">タスク選択<a class="hash-link" aria-label="タスク選択 への直接リンク" title="タスク選択 への直接リンク" href="https://mebiusbox.github.io/blog/2024/09/15/improve-cargo-make#%E3%82%BF%E3%82%B9%E3%82%AF%E9%81%B8%E6%8A%9E">​</a></h2>
<p>タスク一覧を表示する以外にも、インタラクティブなタスク選択機能も追加しました．
fzfを使ってタスクを選択します．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">PS</span><span class="token plain"> &gt; psmake </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">Sel</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">&gt;</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"> 6/6 </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">0</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">&gt; </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain"> By default this task is invoked at the </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"> of every cargo-make run</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  init </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain"> By default this task is invoked at the </span><span class="token function" style="color:#e6db74">start</span><span class="token plain"> of every cargo-make run</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  dev </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain"> Run gradio with watch mode </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[aliases: default]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  resize </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain"> Resize image</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  serve </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain"> Serve app</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  empty </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain"> Empty Task</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="複数のmakefile">複数のmakefile<a class="hash-link" aria-label="複数のmakefile への直接リンク" title="複数のmakefile への直接リンク" href="https://mebiusbox.github.io/blog/2024/09/15/improve-cargo-make#%E8%A4%87%E6%95%B0%E3%81%AEmakefile">​</a></h2>
<p>あまり使うことはありませんが、<code>makefile.toml</code>とは別にローカル用のmakefileが欲しいことがありました．
そのため、fzfを使って手軽に切り替えられる機能を追加しました．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="コマンド実行">コマンド実行<a class="hash-link" aria-label="コマンド実行 への直接リンク" title="コマンド実行 への直接リンク" href="https://mebiusbox.github.io/blog/2024/09/15/improve-cargo-make#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E5%AE%9F%E8%A1%8C">​</a></h2>
<p>Windows環境なのでなるべくPowerShellで実行させたいですが、標準だと通常のコマンドプロンプトで実行されます．
プラグインだったり、スクリプトランナーにPowerShellを指定することで実行できます．
しかし、一時ファイルが生成されたり新しくプロセスが生成されるのでプロファイルの読み込みに時間がかかったりします．
<code>-nop</code>オプションを指定して、標準のプロファイル読み込みをさせないこともできますが、せっかく自作した便利な関数やコマンドレットを利用できないのはもったいないです．
そこで、設定ファイル（標準で<code>makefile.toml</code>）を読み込んで、開いているPowerShellプロンプトで実行する機能も追加しました．
ただし、機能は限定的でコマンドのみ、変数展開も<code>${@}</code>のみ対応しています（コマンド以外の場合、cargo-makeを実行するようにしています）．</p>
<p>これを実装するために、TOML形式からJSON形式に変換するのですが、これは<a href="https://github.com/TomWright/dasel" target="_blank" rel="noopener noreferrer">dasel</a>を使用しました．
私は json や yaml などの解析は <a href="https://github.com/mikefarah/yq" target="_blank" rel="noopener noreferrer">yq</a> を使っています．
yqは一応TOML形式も対応しているらしいのですが、基本的にまともに読み込めたことはないです．なのでTOML形式はdaselからJSON形式に変換して解析しています．
また、daselもデータ操作機能がありますが、jq/yq と互換はなく、ちょっと使いづらいです．</p>
<p>標準でdefaultタスクを参照します．また、defaultタスクの場合、aliasも参照するようにしています．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="psmake">psmake<a class="hash-link" aria-label="psmake への直接リンク" title="psmake への直接リンク" href="https://mebiusbox.github.io/blog/2024/09/15/improve-cargo-make#psmake">​</a></h2>
<p>これらをまとめて <code>psmake</code> という関数にまとめました．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">psmake.psm1</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> psmake</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[CmdletBinding()]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">param</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[string]</span><span class="token variable" style="color:#f8f8f2">$Name</span><span class="token plain"> = </span><span class="token string" style="color:#a6e22e">"default"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[string]</span><span class="token variable" style="color:#f8f8f2">$File</span><span class="token plain"> = </span><span class="token string" style="color:#a6e22e">"makefile.toml"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[switch]</span><span class="token variable" style="color:#f8f8f2">$List</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[switch]</span><span class="token variable" style="color:#f8f8f2">$Sel</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[string[]]</span><span class="token variable" style="color:#f8f8f2">$Arguments</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token variable" style="color:#f8f8f2">$file</span><span class="token plain"> = </span><span class="token variable" style="color:#f8f8f2">$File</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$file</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#66d9ef">-not</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#e6db74">Test-Path</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$file</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">PathType Leaf</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token function" style="color:#e6db74">Write-Error</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Not found file [${File}]"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$file</span><span class="token plain"> = </span><span class="token function" style="color:#e6db74">Get-ChildItem</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"*.toml"</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Name </span><span class="token operator" style="color:#66d9ef">-like</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"*makefile*.toml"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Name</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> fzf</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#66d9ef">-not</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$file</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$List</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$prevLine</span><span class="token plain"> = </span><span class="token string" style="color:#a6e22e">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$category</span><span class="token plain"> = </span><span class="token string" style="color:#a6e22e">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    cargo make </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">makefile </span><span class="token variable" style="color:#f8f8f2">$file</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">list-all-steps </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-match</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"^(?&lt;name&gt;\w+?)\s-\s(?&lt;desc&gt;.*)$"</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[PSCustomObject]</span><span class="token plain">@</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          Name = </span><span class="token variable" style="color:#f8f8f2">$Matches</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          Description = </span><span class="token variable" style="color:#f8f8f2">$Matches</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">desc</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          Category = </span><span class="token variable" style="color:#f8f8f2">$category</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">elseif</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-match</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"^-+$"</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token variable" style="color:#f8f8f2">$category</span><span class="token plain"> = </span><span class="token variable" style="color:#f8f8f2">$prevLine</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token variable" style="color:#f8f8f2">$prevLine</span><span class="token plain"> = </span><span class="token string" style="color:#a6e22e">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token variable" style="color:#f8f8f2">$category</span><span class="token plain"> = </span><span class="token string" style="color:#a6e22e">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token variable" style="color:#f8f8f2">$prevLine</span><span class="token plain"> = </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Category </span><span class="token operator" style="color:#66d9ef">-ne</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Hooks"</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ConvertTo-Csv</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> csview</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">elseif</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$Sel</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$tasks</span><span class="token plain"> = cargo make </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">makefile </span><span class="token variable" style="color:#f8f8f2">$file</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">list-all-steps </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-match</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"^(?&lt;name&gt;\w+?)\s-\s(?&lt;desc&gt;.*)$"</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[PSCustomObject]</span><span class="token plain">@</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          Name = </span><span class="token variable" style="color:#f8f8f2">$Matches</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">name</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          Description = </span><span class="token variable" style="color:#f8f8f2">$Matches</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">desc</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          Category = </span><span class="token variable" style="color:#f8f8f2">$category</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          FullName = </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Category </span><span class="token operator" style="color:#66d9ef">-ne</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Hooks"</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$tasks</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">FullName</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> fzf </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#66d9ef">foreach</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$task</span><span class="token plain"> in </span><span class="token variable" style="color:#f8f8f2">$tasks</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-eq</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">FullName</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token function" style="color:#e6db74">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Command: </span><span class="token string function" style="color:#e6db74">$</span><span class="token string function punctuation" style="color:#f8f8f2">(</span><span class="token string function variable" style="color:#f8f8f2">$task</span><span class="token string function punctuation" style="color:#f8f8f2">.</span><span class="token string function" style="color:#e6db74">Name</span><span class="token string function punctuation" style="color:#f8f8f2">)</span><span class="token string" style="color:#a6e22e"> ${Arguments}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          cargo make </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">makefile </span><span class="token variable" style="color:#f8f8f2">$file</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Name @Arguments</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$json</span><span class="token plain"> = dasel </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">f </span><span class="token variable" style="color:#f8f8f2">$file</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">r toml </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">w json </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ConvertFrom-Json</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$tasks</span><span class="token plain"> = </span><span class="token variable" style="color:#f8f8f2">$json</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">tasks </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">Get-Member</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">MemberType Properties </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">Select-Object</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">ExpandProperty Name </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token variable" style="color:#f8f8f2">$task</span><span class="token plain"> = </span><span class="token variable" style="color:#f8f8f2">$json</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">tasks</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[PSCustomObject]</span><span class="token plain">@</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        Name = </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        Category = </span><span class="token variable" style="color:#f8f8f2">$task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">category</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        Command = </span><span class="token variable" style="color:#f8f8f2">$task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">command</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        Args = </span><span class="token variable" style="color:#f8f8f2">$task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">args</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        Description = </span><span class="token variable" style="color:#f8f8f2">$task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">description</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        Alias = </span><span class="token variable" style="color:#f8f8f2">$task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">alias</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$task</span><span class="token plain"> = </span><span class="token variable" style="color:#f8f8f2">$tasks</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Name </span><span class="token operator" style="color:#66d9ef">-eq</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$Name</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$task</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Alias</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token variable" style="color:#f8f8f2">$task</span><span class="token plain"> = </span><span class="token variable" style="color:#f8f8f2">$tasks</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">Where-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Name </span><span class="token operator" style="color:#66d9ef">-eq</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Alias </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token variable" style="color:#f8f8f2">$newArguments</span><span class="token plain"> = </span><span class="token variable" style="color:#f8f8f2">$task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Args </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-eq</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"`${@}"</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token variable" style="color:#f8f8f2">$Arguments</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Command </span><span class="token operator" style="color:#66d9ef">-and</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$task</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Command </span><span class="token operator" style="color:#66d9ef">-ne</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">""</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token function" style="color:#e6db74">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Command: </span><span class="token string function" style="color:#e6db74">$</span><span class="token string function punctuation" style="color:#f8f8f2">(</span><span class="token string function variable" style="color:#f8f8f2">$task</span><span class="token string function punctuation" style="color:#f8f8f2">.</span><span class="token string function" style="color:#e6db74">Command</span><span class="token string function punctuation" style="color:#f8f8f2">)</span><span class="token string" style="color:#a6e22e"> ${newArguments}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        &amp; </span><span class="token string" style="color:#a6e22e">"</span><span class="token string function" style="color:#e6db74">$</span><span class="token string function punctuation" style="color:#f8f8f2">(</span><span class="token string function variable" style="color:#f8f8f2">$task</span><span class="token string function punctuation" style="color:#f8f8f2">.</span><span class="token string function" style="color:#e6db74">Command</span><span class="token string function punctuation" style="color:#f8f8f2">)</span><span class="token string" style="color:#a6e22e">"</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$newArguments</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        cargo make </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">makefile </span><span class="token variable" style="color:#f8f8f2">$file</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$Name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token function" style="color:#e6db74">Write-Error</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Not found Task [${Name}]"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>syntaxは次のようになっています：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">NAME</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    psmake</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">SYNTAX</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    psmake </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">Name</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> &lt;string&gt;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">File</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> &lt;string&gt;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">Arguments</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> &lt;string</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain">&gt;</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">List</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">Sel</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">&lt;CommonParameters&gt;</span><span class="token punctuation" style="color:#f8f8f2">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="まとめ">まとめ<a class="hash-link" aria-label="まとめ への直接リンク" title="まとめ への直接リンク" href="https://mebiusbox.github.io/blog/2024/09/15/improve-cargo-make#%E3%81%BE%E3%81%A8%E3%82%81">​</a></h2>
<p>とくに欲しかったのはタスク一覧とタスク選択機能です．
これで makefile.toml にどんどんタスクを追加していってもよさそうです．</p>
<p>以上です．</p>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="make" term="make"/>
        <category label="cargo" term="cargo"/>
        <category label="powershell" term="powershell"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[ghqでプロジェクト管理（整理）する]]></title>
        <id>https://mebiusbox.github.io/blog/2024/09/13/ghq</id>
        <link href="https://mebiusbox.github.io/blog/2024/09/13/ghq"/>
        <updated>2024-09-13T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[ghqを使って一貫のあるフォルダ構成で管理する方法について]]></summary>
        <content type="html"><![CDATA[<p>ある程度、自分なりにクローン先を指定して管理していたのですが、数が多くなって管理が難しくなってきたので、ghq を使ってみました．
ここでは、その備忘録を残しておきます．</p>
<p><a href="https://github.com/x-motemen/ghq" target="_blank" rel="noopener noreferrer">ghq</a> はリポジトリをクローンするときに、ルールにもとづいて自動的にフォルダを生成して、そこにクローンしてくれるツールです．一貫した構成になるので、管理しやすくなりますし、ghqコマンドを使ってリストを取得することもできます．fzfと組み合わせることで、プロジェクトの行き来が楽になります．</p>
<p>すでにある程度、自分なりにクローン先を分別してやっていたのですが、いざ不要なものを削除するときにわかりづらいものとなっていました．
たとえば、GitHubで管理しているものとローカルに作成したベアリポジトリ（バックアップ用）の区別がつきませんでした．
そこで、ghqを導入して整理することにしました．100個以上のクローンしたプロジェクトがあったので、なるべく一括でできるようにPowerShellでスクリプトを作成しました．
前述したように GitHubで管理しているものとローカルに作成したものがあったのですが、ghqではローカルに作成したもの（<code>ssh</code>や<code>https</code>以外）は上手くいかなかったので、そこはいい感じの構成にしておきました（<code>repo</code>ディレクトリの中に <code>xxx.git</code>ディレクトリが置いてあるので、<code>&lt;ghq.root&gt;/repo/&lt;project&gt;</code> という名前にしました）．
あとは、すでにあるプロジェクトを移行します．<code>migrate2ghq</code>という関数を作成してghqのフォルダ構成になるように移動するものです．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> migrate2ghq</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">param</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[Parameter(Mandatory)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[string]</span><span class="token variable" style="color:#f8f8f2">$InputPath</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[switch]</span><span class="token variable" style="color:#f8f8f2">$DryRun</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#e6db74">Push-Location</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#e6db74">Set-Location</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$InputPath</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#e6db74">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Location: </span><span class="token string function" style="color:#e6db74">$</span><span class="token string function punctuation" style="color:#f8f8f2">(</span><span class="token string function" style="color:#e6db74">Get-Location</span><span class="token string function punctuation" style="color:#f8f8f2">)</span><span class="token string" style="color:#a6e22e">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token variable" style="color:#f8f8f2">$url</span><span class="token plain"> = git remote </span><span class="token function" style="color:#e6db74">get-url</span><span class="token plain"> origin</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#e6db74">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Origin  : ${url}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#e6db74">Pop-Location</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token variable" style="color:#f8f8f2">$root</span><span class="token plain"> = git config </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">global ghq</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#e6db74">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"ghq.root: ${root}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token variable" style="color:#f8f8f2">$repo</span><span class="token plain"> = @</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$url</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-match</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"^git@(?&lt;host&gt;.*?):(?&lt;user&gt;.*?)/(?&lt;project&gt;.*?)\.git$"</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$repo</span><span class="token plain"> = @</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      Host = </span><span class="token variable" style="color:#f8f8f2">$Matches</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">host</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      User = </span><span class="token variable" style="color:#f8f8f2">$Matches</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">user</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      project = </span><span class="token variable" style="color:#f8f8f2">$Matches</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">project</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">elseif</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$url</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-match</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"^https://(?&lt;host&gt;.*?)/(?&lt;user&gt;.*?)/(?&lt;project&gt;.*?)\.git$"</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$repo</span><span class="token plain"> = @</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      Host = </span><span class="token variable" style="color:#f8f8f2">$Matches</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">host</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      User = </span><span class="token variable" style="color:#f8f8f2">$Matches</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">user</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      project = </span><span class="token variable" style="color:#f8f8f2">$Matches</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">project</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">elseif</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$url</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-match</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"^(?&lt;drive&gt;\w+?):[/\\].*?(?&lt;host&gt;.*)[/\\](?&lt;project&gt;.+)\.git$"</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$repo</span><span class="token plain"> = @</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      Host = </span><span class="token variable" style="color:#f8f8f2">$Matches</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">host</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      User = </span><span class="token string" style="color:#a6e22e">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      project = </span><span class="token variable" style="color:#f8f8f2">$Matches</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">project</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#e6db74">Write-Error</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Not found repository information. Couldn't migration."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#8292a2;font-style:italic"># &lt;ghq.root&gt;/&lt;host&gt;/&lt;user&gt;/&lt;project&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token variable" style="color:#f8f8f2">$outputPath</span><span class="token plain"> = </span><span class="token function" style="color:#e6db74">Join-Path</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$root</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$repo</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">host </span><span class="token variable" style="color:#f8f8f2">$repo</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">user </span><span class="token variable" style="color:#f8f8f2">$repo</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">project</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token variable" style="color:#f8f8f2">$outputParentPath</span><span class="token plain"> = </span><span class="token function" style="color:#e6db74">Join-Path</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$root</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$repo</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">host </span><span class="token variable" style="color:#f8f8f2">$repo</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">user</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#66d9ef">-not</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#e6db74">Test-Path</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$outputParentPath</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token function" style="color:#e6db74">Type</span><span class="token plain"> Container</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$DryRun</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token function" style="color:#e6db74">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"MKDIR(DryRun): ${outputParentPath}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token function" style="color:#e6db74">New-Item</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">Path </span><span class="token variable" style="color:#f8f8f2">$outputParentPath</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">ItemType Directory</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#e6db74">Test-Path</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$outputPath</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token function" style="color:#e6db74">Type</span><span class="token plain"> Container</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token function" style="color:#e6db74">Write-Error</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"[${outputPath}] is Already exists."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$DryRun</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#e6db74">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Move(DryRun): ${InputPath} -&gt; ${outputPath}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#e6db74">Move-Item</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">LiteralPath </span><span class="token variable" style="color:#f8f8f2">$InputPath</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">Destination </span><span class="token variable" style="color:#f8f8f2">$outputPath</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#e6db74">Write-Host</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Move: ${InputPath} -&gt; ${outputPath}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>使い方は次のようになっています：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">PS</span><span class="token plain"> &gt; migrate2ghq hoge </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">DryRun</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#e6db74">PS</span><span class="token plain"> &gt; migrate2ghq hoge</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>リポジトリはリモートの <code>origin</code> に紐づいているURLを参照します．
また、ghqのルートパスはgitのグローバルに設定されていることを想定しています．
現在のディレクトリに一括で行う場合は次のように使います：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">PS</span><span class="token plain"> &gt; </span><span class="token function" style="color:#e6db74">Get-ChildItem</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">Attributes Directory </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> migrate2ghq </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">DryRun </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#e6db74">PS</span><span class="token plain"> &gt; </span><span class="token function" style="color:#e6db74">Get-ChildItem</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">Attributes Directory </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> migrate2ghq </span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>これであまり手間をかけずに移行できました．
ただ、完全に ghq で管理できるようになったわけではなく、いくつかのプロジェクトはその構成上 ghq に合わないため、除外しています．
また、クローン先は他にも2種類あって、高速なSSDと通常のHDDに分けており、その場合はどちらかが ghq 管理外としています．
実際には、ghqを使って取得したリストと別のフォルダで管理しているリストを切り替えて検索できる関数を作成して使用しています．
この場合は ghq を使わずとも今回作成した migrate2ghq を調整して、まず適当な場所にクローンしてから migrate2ghq で移動するのもありかなと思います．
残念ながらすべてを ghq 管理下に置くことはできませんが、全然マシかなと思っています．</p>
<p>以上です．</p>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="git" term="git"/>
        <category label="ghq" term="ghq"/>
        <category label="powershell" term="powershell"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[PowerShellプロファイルの肥大化]]></title>
        <id>https://mebiusbox.github.io/blog/2024/09/13/powershell-profile</id>
        <link href="https://mebiusbox.github.io/blog/2024/09/13/powershell-profile"/>
        <updated>2024-09-13T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[PowerShellプロファイルの肥大化に伴う問題]]></summary>
        <content type="html"><![CDATA[<p>PowerShellが便利なので、さまざまな関数やコマンドレットをプロファイルに追加していったら、肥大化して少し問題になりました．
ここでは、それに関する備忘録を残しておきます．</p>
<p>PowerShellでも色んなことができるので、ちょっとしたことは可能ならPowerShellで処理するようにしています．
そういったものはスクリプトとして作成せずに、関数やコマンドレットとして作成していました．
ところが、PowerShellプロンプトを開くたびにコマンドが打てるまでの時間が長くなってしまいました．
プロファイルの読み込み時間が表示されるので確認してみると10秒以上かかっています．
さすがに長く感じてきたので、対処することにしました．</p>
<p>具体的には、もともといくつかのモジュールに分けていて、プロファイルですべてをインポートしていたのですが、それをやめて必要最小限にとどめました．
そして、必要であればモジュールをインポートする形に変更しました．結果、プロファイルの読み込みが2秒ぐらいになり、快適になりました．
その反面、必要になるたびにモジュールを手動でインポートする手間が発生するようになりました．
もちろん、インポートを手軽にできるように工夫してこの手間も最小限にしています．</p>
<p>機能ごとにスクリプトを1つ作成して呼び出すのは、結局管理が大変になりそうなので、今はこのやり方で落ち着いています．</p>
<p>以上です．</p>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="powershell" term="powershell"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Visual Studio Codeで Ruff を使ったときの問題]]></title>
        <id>https://mebiusbox.github.io/blog/2024/09/07/vscode-ruff</id>
        <link href="https://mebiusbox.github.io/blog/2024/09/07/vscode-ruff"/>
        <updated>2024-09-07T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Visual Studio Codeで Ruff を使ったときに問題が発生したのでその対処方法について]]></summary>
        <content type="html"><![CDATA[<p>Visual Studio CodeでRuffを使うときに1つ問題があったので対処方法を記録しておきます．</p>
<p><a href="https://docs.astral.sh/ruff/" target="_blank" rel="noopener noreferrer">Ruff</a> はリンターおよびフォーマッタです．高速なのが特徴です．
Visual Studio Codeで使う場合、<a href="https://marketplace.visualstudio.com/items?itemName=charliermarsh.ruff" target="_blank" rel="noopener noreferrer">拡張機能</a>をインストールします．</p>
<p>使用していると、整形時に最終行が複製されてしまう問題が発生しました．
どうやら、他の拡張機能と合わせて使っていると起きるようです．
issue(<a href="https://github.com/astral-sh/ruff-vscode/issues/128" target="_blank" rel="noopener noreferrer">#128</a>)として報告はされているようです．
対処方法は確認したところ、2つあるようです．</p>
<ul>
<li>他のリンターやフォーマッタなどの拡張機能を無効にする</li>
<li><code>ruff.organizeImports</code> を無効にする</li>
</ul>
<p>前者の場合、<a href="https://marketplace.visualstudio.com/items?itemName=ms-python.isort" target="_blank" rel="noopener noreferrer">ms-python.isort</a> を無効にします．
もしかするとそれ以外も無効にする必要があるかもしれません．</p>
<p>厄介な問題なので、対応はしておきましょう．</p>
<p>以上です．</p>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="vscode" term="vscode"/>
        <category label="python" term="python"/>
        <category label="ruff" term="ruff"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Visual Studio Codeの新規ファイル作成を支援する拡張機能]]></title>
        <id>https://mebiusbox.github.io/blog/2024/09/05/vscode-simple-new-file</id>
        <link href="https://mebiusbox.github.io/blog/2024/09/05/vscode-simple-new-file"/>
        <updated>2024-09-05T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Visual Studio Codeの拡張機能「Simple New File」の紹介]]></summary>
        <content type="html"><![CDATA[<p>Visual Studio Codeで新規にファイルを作成するときに便利な拡張機能「Simple New File」を紹介します．</p>
<p>Visual Studio Codeで新規にファイルを作成するときに、ファイルエクスプローラから作成するのが基本だと思います．
しかし、現在開いているフォルダに対して作成するのはいいのですが、それ以外の場所、とくにワークスペースのルートフォルダに作成するときにちょっとやりづらいかなと思っています．
そこで、以前は新規にファイルを作成するときに便利な拡張機能「<a href="https://marketplace.visualstudio.com/items?itemName=fayras.simple-new-file" target="_blank" rel="noopener noreferrer">Simple New File</a>」を使っていました．この拡張機能は現在更新されておらず、Visual Studio Codeのバージョンアップによってまともに動作しなくなっていました．</p>
<p>しばらく使わずにいたのですが、あらためて新規ファイル作成まわりを調べてもこの拡張機能が便利だなと感じたので、<a href="https://github.com/mebiusbox/vscode-simple-new-file" target="_blank" rel="noopener noreferrer">フォーク</a>して不具合を修正しました．
この拡張機能はファイル作成時にパスを入力することで、そのファイルを一発で作成できる機能があります．たとえば <code>/aaa/bbb/ccc/ddd.txt</code> と入力すれば、<code>aaa</code> や <code>bbb</code> フォルダを自動で作成してくれます．これを使うと、ワークスペースのルートフォルダに作成する場合、<code>/README.md</code>とすれば、すぐにルートフォルダに作成できます．
また、すでに存在すればそのファイルを開くこともできます．ただ、<code>Ctrl+P</code>でも開くことはできますので使いやすいほうを選べばいいと思います．</p>
<p>しばらく使ってみて問題なさそうならプルリクエストしてもいいかもしれません．</p>
<p>以上です．</p>
<hr>
<p>以下の場所からリリースページのvsixファイルを使ってインストールできます．</p>
<ul>
<li><a href="https://github.com/mebiusbox/vscode-simple-new-file" target="_blank" rel="noopener noreferrer">mebiusbox/vscode-simple-new-file</a></li>
</ul>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="vscode" term="vscode"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Gpg4winのgpg-agent.confの場所]]></title>
        <id>https://mebiusbox.github.io/blog/2024/09/02/gpg4win-gpgconf</id>
        <link href="https://mebiusbox.github.io/blog/2024/09/02/gpg4win-gpgconf"/>
        <updated>2024-09-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Gpg4winのgpg-agent.confを置く正しい場所について]]></summary>
        <content type="html"><![CDATA[<p>Gpg4winのgpg-agent.confを置く場所について書いておきます．</p>
<p>Gitで署名付きコミットをするためにGPGキーが必要なので、Gpg4winをインストールしました．
WinGetでインストールできます．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">PS</span><span class="token plain"> &gt; winget install GnuPG</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Gpg4win</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>現在のバージョンは <code>4.3.1</code> です．
キーを生成して、GitとGitHubに登録．
Gitの設定で常に署名付きコミットをするために以下の設定をしました．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">PS</span><span class="token plain"> &gt; git config </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">global commit</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">gpgsign true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>また、gpg.exe のパスをgitに設定しておく必要があります．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">PS</span><span class="token plain"> &gt; git config </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">global gpg</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">program </span><span class="token string" style="color:#a6e22e">"C:\Program Files (x86)\GnuPG\bin\gpg.exe"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>あとは、普通にコミットすればパスフレーズの入力が求められるので、正しく入力できればコミットできます．
署名付きコミットをGitHubにプッシュすれば、<code>Verified</code>がつきます．</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>備考</div><div class="admonitionContent_BuS1"><p>グローバルで署名付きコミットを有効にしない場合、コミット時に <code>-S</code> オプションをつけると署名付きになります．</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>備考</div><div class="admonitionContent_BuS1"><p>署名付きでコミットされているかはGitのlogコマンドで <code>--show-signature</code> オプションを指定すると確認できます．</p></div></div>
<p>で、パスフレーズの入力は gpg-agent がある程度キャッシュしてくれるのですが、その期間は標準だと10分しかありません．
最大で2時間です．現在の設定は <code>gpgconf</code> で確認できます．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">PS</span><span class="token plain"> &gt; gpgconf </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">list-options gpg-agent</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>標準のキャッシュ期間はちょっと短すぎるので、もっと長くしたいです．
そのためには <code>gpg-agent.conf</code> ファイルを生成して、そこに設定を書きます．
このファイルは <code>$env:appdata\gnupg\</code> に置きます．</p>
<p>ちなみに、このファイルの置き場所として <code>~\.gnupg\</code> に置くとネットでは書かれているものが多いのですが、
Gpg4win 4.3.1 では認識されませんでした．確認はしてませんが、Git for Windowsに同梱されている gpg はこちらを参照するようです．</p>
<p>設定ファイルを作成できたら、反映されたか確認します．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">PS</span><span class="token plain"> &gt; gpgconf </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">reload gpg-agent</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#e6db74">PS</span><span class="token plain"> &gt; gpgconf </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">list-options gpg-agent</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">default-cache-ttl:24:0:expire cached PINs after N seconds:3:3:N:600::31536000</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">max-cache-ttl:24:2:</span><span class="token function" style="color:#e6db74">set</span><span class="token plain"> maximum PIN cache lifetime to N seconds:3:3:N:7200::31536000</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>以下のコマンドでも設定ファイルをリロードできるようですが、ちゃんと反映されているかどうかわからないので上記のコマンドをオススメします．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">PS</span><span class="token plain"> &gt; gpg-agent reloadagent </span><span class="token operator" style="color:#66d9ef">/</span><span class="token plain">bye</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>以上です．</p>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="gpg4win" term="gpg4win"/>
        <category label="gpg" term="gpg"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Typosでスペルミスを減らす]]></title>
        <id>https://mebiusbox.github.io/blog/2024/09/01/typos</id>
        <link href="https://mebiusbox.github.io/blog/2024/09/01/typos"/>
        <updated>2024-09-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Typosを使ってスペルチェックするときの設定についてのメモ]]></summary>
        <content type="html"><![CDATA[<p>スペルミス（typo）を減らすために、スペルチェッカー「Typos」を導入してみました．
ここでは、設定について調べたことを残しておきます．</p>
<p>スペルチェッカーは Visual Studio Codeの拡張機能である「<a href="https://marketplace.visualstudio.com/items?itemName=streetsidesoftware.code-spell-checker" target="_blank" rel="noopener noreferrer">Code Spell Checker</a>」を利用していました．ただ、誤検出や、過剰検出などのノイズが多いとも感じていました．
スペルチェックの範囲を限定したり、単語を登録しておくことによってノイズを減らすことはもちろんできますが、もう少し手抜きがしたいところです．</p>
<p>そこで、別のスペルチェッカーを試してみようと、調べたら <a href="https://github.com/crate-ci/typos" target="_blank" rel="noopener noreferrer">Typos</a> が目立ったので、試しに導入してみました．
よくCIで回して運用する方法が解説されていましたが、普通に個人の開発で利用するようにしました．
主に、Visual Studio Codeの拡張機能「<a href="https://marketplace.visualstudio.com/items?itemName=tekumara.typos-vscode" target="_blank" rel="noopener noreferrer">Typos spell checker</a>」と、コマンドラインツールによるチェックで使用しています．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="インストール">インストール<a class="hash-link" aria-label="インストール への直接リンク" title="インストール への直接リンク" href="https://mebiusbox.github.io/blog/2024/09/01/typos#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">​</a></h2>
<p>私は <code>cargo</code> でインストールしました．</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">cargo install typos-cli</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>後は <code>typos</code>コマンドで実行できます．標準で現在のディレクトリ以下のファイルをチェックします．</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">typos</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>実際にチェックされるファイルは <code>--files</code>オプションで確認できます．</li>
<li>スペルミスを修正する機能もあります．その場合は <code>-w</code> または <code>--write-changes</code> オプションを付けます．</li>
<li>出力フォーマットは <code>--format</code> で指定できます．標準は <code>long</code> ですが、<code>brief</code> で短く、<code>json</code>でJSON形式で出力できます．</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="設定ファイル">設定ファイル<a class="hash-link" aria-label="設定ファイル への直接リンク" title="設定ファイル への直接リンク" href="https://mebiusbox.github.io/blog/2024/09/01/typos#%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB">​</a></h2>
<p><code>.typos.toml</code>, <code>typos.toml</code>, <code>_typos.toml</code>、また <code>Cargo.toml</code>, <code>pyproject.toml</code> にも含めることができるようです．</p>
<p>詳しくは<a href="https://github.com/crate-ci/typos/blob/master/docs/reference.md" target="_blank" rel="noopener noreferrer">ドキュメント</a>に書かれています．</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ignore">ignore<a class="hash-link" aria-label="ignore への直接リンク" title="ignore への直接リンク" href="https://mebiusbox.github.io/blog/2024/09/01/typos#ignore">​</a></h3>
<p>個人的にちょっとわかりづらかった部分なので、調べた限りの情報を整理しておきます．
まず、標準で ignore 関連は有効になっています．オプションに <code>--dump-config -</code> を指定して実行すると、設定情報が出力されます．
何も指定していない状態だと次のような設定になります（一部のみ抜粋）：</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token table class-name" style="color:#e6db74">files</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key property" style="color:#f92672">extend-exclude</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key property" style="color:#f92672">ignore-hidden</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key property" style="color:#f92672">ignore-files</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key property" style="color:#f92672">ignore-dot</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key property" style="color:#f92672">ignore-vcs</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key property" style="color:#f92672">ignore-global</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key property" style="color:#f92672">ignore-parent</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token table class-name" style="color:#e6db74">default</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key property" style="color:#f92672">binary</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key property" style="color:#f92672">check-filename</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key property" style="color:#f92672">check-file</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key property" style="color:#f92672">unicode</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key property" style="color:#f92672">ignore-hex</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key property" style="color:#f92672">identifier-leading-digits</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">=</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key property" style="color:#f92672">locale</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"en"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key property" style="color:#f92672">extend-ignore-identifiers-re</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key property" style="color:#f92672">extend-ignore-words-re</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token key property" style="color:#f92672">extend-ignore-re</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>たとえば、<code>ignore-files</code> はドキュメントを確認すると <code>Respect ignore files.</code> とあってちょっと曖昧だと感じました．
なので、実際にソースコードを直接見てどうなっているのか調べてみました．</p>
<ul>
<li><code>ignore-files</code> が有効になっていると <code>ignore-dot</code>, <code>ignore-vcs</code>, <code>ignore-global</code>, <code>ignore-parent</code> が有効になります．</li>
<li><code>ignore-vcs</code> が有効になると <code>.gitignore</code> を参照します．ですから、標準で <code>.gitignore</code> に指定されているディレクトリやファイルは除外されます．また、<code>$GIT_DIR/info/exclude</code>も参照されます．</li>
<li><code>ignore-dot</code> はすべてのドットファイルが無視されるわけではなく <code>.ignore</code> ファイルという <code>.gitignore</code> と同じ記法のファイルが参照されます．</li>
<li><code>ignore-global</code> はgitのグローバル設定を参照します．これは <code>core.excludesfile</code> の値です．</li>
<li><code>ignore-parent</code>は親ディレクトリにある <code>.gitignore</code> を参照します．</li>
</ul>
<p>全部をしっかりと動作確認したわけではないので、誤りがあったら指摘してもらえると助かります．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enabledisable">enable/disable<a class="hash-link" aria-label="enable/disable への直接リンク" title="enable/disable への直接リンク" href="https://mebiusbox.github.io/blog/2024/09/01/typos#enabledisable">​</a></h2>
<p>Typosは標準でソースコード内でチェッカーの挙動を制御するものは用意されていないので、必要であれば追加する必要があります．
よくある <code>enable/disable</code> や <code>disable-line</code> はドキュメントに書かれているのでそれを使います．
あと <code>disable-next-line</code> も欲しかったのでこれも追加してみます．<code>extend-ignore-re</code>で設定します．</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token key property" style="color:#f92672">extend-ignore-re</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic"># spellchecker: disable-line, disable-next-line, disable, enable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token string" style="color:#a6e22e">"(?Rm)^.*(#|//|/\\*)\\s*spellchecker:\\s*disable-line$"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token string" style="color:#a6e22e">"(?m)^\\s*(?:#|//|/\\*)\\s*spellchecker:\\s*disable-next-line.*$\\r?\\n.*$"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token string" style="color:#a6e22e">"(?s)(#|//|/\\*|&lt;!--)\\s*spellchecker:\\s*disable.*?\\n\\s*(#|//|/\\*|&lt;!--)\\s*spellchecker:\\s*enable"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ドキュメントに書かれているものを少し改善して、4種類のコメントに対応しています：</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token title important punctuation" style="color:#f8f8f2">#</span><span class="token title important"> spellchecker: disable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">// spellchecker: disable</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">/</span><span class="token italic punctuation" style="color:#f8f8f2">*</span><span class="token italic content"> spellchecker: disable </span><span class="token italic punctuation" style="color:#f8f8f2">*</span><span class="token plain">/</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">&lt;!-- spellchecker: disable --&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>また、この記法は Code Spell Checker（内部でcspellを使用）にも準拠しています．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ハッシュ値">ハッシュ値<a class="hash-link" aria-label="ハッシュ値 への直接リンク" title="ハッシュ値 への直接リンク" href="https://mebiusbox.github.io/blog/2024/09/01/typos#%E3%83%8F%E3%83%83%E3%82%B7%E3%83%A5%E5%80%A4">​</a></h2>
<p>実際に使用していて気になったのがハッシュ値に対する誤検出です．issueでもいくつか報告（<a href="https://github.com/crate-ci/typos/issues/484" target="_blank" rel="noopener noreferrer">#484</a>）されていますが根本的な解決はまだされていないようです．対応としては、正規表現を使ってある一定以上の文字数を無視するぐらいしかできず、この方法もその文字数以上はすべてチェックされなくなるのでよろしくありません．いまのところどうしようもないので無視しています．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="実際の運用について">実際の運用について<a class="hash-link" aria-label="実際の運用について への直接リンク" title="実際の運用について への直接リンク" href="https://mebiusbox.github.io/blog/2024/09/01/typos#%E5%AE%9F%E9%9A%9B%E3%81%AE%E9%81%8B%E7%94%A8%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">​</a></h2>
<p>なかなか私の中でも確立した方法が見つかっていません．
Typosでもやはり誤検知はするので、該当箇所はスペルチェッカーを無効にしたりしないとノイズとして残り続けます．
とはいえ、スペルチェッカー関連でコードを汚染するのもよろしくないですし、難しい問題です．
まあ、ほどほどにしてスペルチェックの結果に対してチェック済みかどうか記録できる仕組みとかあると管理しやすいかもしれません．</p>
<p>以上です．</p>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="typos" term="typos"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Gistコマンドを自作してテンプレートファイルを管理する]]></title>
        <id>https://mebiusbox.github.io/blog/2024/08/31/gist-tool</id>
        <link href="https://mebiusbox.github.io/blog/2024/08/31/gist-tool"/>
        <updated>2024-08-31T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[PowerShellを使って Gist を扱うコマンドを作成します]]></summary>
        <content type="html"><![CDATA[<p>Gistを有効に活用できるようにgistコマンドを作ってみました．これはその備忘録です．</p>
<p>詳しくは <a href="https://gist.github.com/mebiusbox/a90fda22776c9c9b376ffc165dd0988d" target="_blank" rel="noopener noreferrer">Gistコマンドを自作してテンプレートファイルを管理する</a> にあります．
そこにも書いてある通り、Gistを扱うコマンドをPowerShellで実装して活用しています．
とりあえず使ってみている状態で、まだ良し悪しはわかっていません．
ここでは、いくつか思っていることを書いておきます．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="スニペットで管理するのは">スニペットで管理するのは？<a class="hash-link" aria-label="スニペットで管理するのは？ への直接リンク" title="スニペットで管理するのは？ への直接リンク" href="https://mebiusbox.github.io/blog/2024/08/31/gist-tool#%E3%82%B9%E3%83%8B%E3%83%9A%E3%83%83%E3%83%88%E3%81%A7%E7%AE%A1%E7%90%86%E3%81%99%E3%82%8B%E3%81%AE%E3%81%AF">​</a></h2>
<p>たとえば、Visual Studio Codeのスニペットや、独立したスニペット管理ツール、またはテキスト入力支援などを使うのはどうでしょうか．
個人的にGistコマンドのメリットを挙げると次のとおりです：</p>
<ul>
<li>バージョン管理ができる（履歴がたどれる）</li>
<li>共有できる</li>
<li>diffがとれる（パッチも当てられる）</li>
</ul>
<p>逆にデメリットがあまりないかなと思っています．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="gistをcloneするのは">Gistをcloneするのは？<a class="hash-link" aria-label="Gistをcloneするのは？ への直接リンク" title="Gistをcloneするのは？ への直接リンク" href="https://mebiusbox.github.io/blog/2024/08/31/gist-tool#gist%E3%82%92clone%E3%81%99%E3%82%8B%E3%81%AE%E3%81%AF">​</a></h2>
<p>ローカルリポジトリを作ってしまうので、ちょっと面倒かなと思いました（たとえば、cloneしたあとに<code>.git</code>ディレクトリを削除）．
あとは、プッシュができるので、そこは利点かなと思っています．
ただし、今回の用途としては別のプロジェクトに手軽にファイルをコピーしてくることを想定しているので、ローカルリポジトリは邪魔になってしまい、それを削除すればプッシュも出来なくなります．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="プロジェクトテンプレートとしてgithubなどにプロジェクトを作成しておくのは">プロジェクトテンプレートとして、GitHubなどにプロジェクトを作成しておくのは？<a class="hash-link" aria-label="プロジェクトテンプレートとして、GitHubなどにプロジェクトを作成しておくのは？ への直接リンク" title="プロジェクトテンプレートとして、GitHubなどにプロジェクトを作成しておくのは？ への直接リンク" href="https://mebiusbox.github.io/blog/2024/08/31/gist-tool#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%83%86%E3%83%B3%E3%83%97%E3%83%AC%E3%83%BC%E3%83%88%E3%81%A8%E3%81%97%E3%81%A6github%E3%81%AA%E3%81%A9%E3%81%AB%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E6%88%90%E3%81%97%E3%81%A6%E3%81%8A%E3%81%8F%E3%81%AE%E3%81%AF">​</a></h2>
<p>これも手間かなと思っています．そこまで几帳面に管理するつもりはないですし、したくもありません．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="gistpad">GistPad<a class="hash-link" aria-label="GistPad への直接リンク" title="GistPad への直接リンク" href="https://mebiusbox.github.io/blog/2024/08/31/gist-tool#gistpad">​</a></h2>
<p>エディタはVisual Studio Codeを使っていて、Gistの管理は拡張機能「<a href="https://marketplace.visualstudio.com/items?itemName=vsls-contrib.gistfs" target="_blank" rel="noopener noreferrer">GistPad</a>」を利用しています．
Gistコマンドを使ってもいいですし、GistPadでコピペしても構いません．
GistPadには現在開いているエディタ内にGistファイルをペーストする機能があります．</p>
<p>今回作成したGistコマンドはプッシュする機能がないので、GistPadで更新しています．
その際、ちょっと問題が発生したので、対処方法も書いておきます．
それはフォーマッタの問題です．フォーマッタはprettierなどを使っているのですが、基本的に保存時にフォーマッタが実行されるようにしています．
設定ファイルをプロジェクトごとに置いているんですが、それぞれの環境で保存したものと、GistPadで保存するときの挙動が異なります．
コーディングスタイルに依存する部分なので、結局はどうしようもないのですが、GistPadで保存するときの挙動がVisual Studio Codeのデフォルトの設定になってしまうので設定を合わせていないと保存したときに、予期しないフォーマットがされてしまいました．ですので、少なくともGistPadで保存するときはフォーマッタを実行しないようにする必要があります．その場合、コマンドパレットから「File &gt; Save without Formatting」を使うと、フォーマッタを実行せずに保存できます．</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>備考</div><div class="admonitionContent_BuS1"><p>GistPadからは、エディター内で右クリック「Paste Gist File」で手軽にペーストできます．</p></div></div>
<p>とりあえず、しばらく使って様子を見てみることにします．
以上です．</p>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="gist" term="gist"/>
        <category label="powershell" term="powershell"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[DaVinci ResolveのLuaスクリプト入門]]></title>
        <id>https://mebiusbox.github.io/blog/2024/08/30/davinci-resolve-lua</id>
        <link href="https://mebiusbox.github.io/blog/2024/08/30/davinci-resolve-lua"/>
        <updated>2024-08-30T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[DaVinci ResolveのLuaスクリプトを作ってみよう]]></summary>
        <content type="html"><![CDATA[<p><a href="https://www.blackmagicdesign.com/jp/products/davinciresolve" target="_blank" rel="noopener noreferrer">DaVinci Resolve</a> は動画編集ソフトです．
無料版でも十分な機能があり、とくに Fusion でいろいろなエフェクトや調整ができるので使っています．
ここでは、標準で使用できるLuaスクリプトを使ってツールを作ってみます．また、Luaについても少し解説します．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="はじめに">はじめに<a class="hash-link" aria-label="はじめに への直接リンク" title="はじめに への直接リンク" href="https://mebiusbox.github.io/blog/2024/08/30/davinci-resolve-lua#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB">​</a></h2>
<p>DaVinci Resolveのスクリプトは標準で Lua が組み込まれています．Luaはとても簡潔で、実は慣れると、とても書きやすいことがわかります．
ただし、Luaそのものは最低限の機能しか実装されておらず、使える機能はアプリ側が用意したライブラリに依存します．</p>
<p>ちなみに、DaVinci Resolveは Lua だけではなく、Pythonもサポートしています．しかし、標準では利用できず、あとからインストールする必要があります．
公式からインストーラをダウンロードしてインストールしてもいいですし、仮想環境を作成しても問題ありません．ただし、仮想環境の場合、環境変数を設定する必要があります．<a href="https://resolvedevdoc.readthedocs.io/en/latest/API_intro.html" target="_blank" rel="noopener noreferrer">ResolveDevDoc</a> や、README.txt (たとえば、<code>C:\ProgramData\Blackmagic Design\DaVinci Resolve\Support\Developer\Scripting\README.txt</code>)を参照してください．もちろん、ここでは Python について詳しく触れません．</p>
<p>なお、環境は Windows で、UIは英語表記、バージョンは 19.0 です．DaVinci Resolveを個人で少し使っている程度です．</p>
<p>今回作るツールは2つ．1つはタイムラインを開くツールです．シーンが多くなるとフォルダ構造も階層が深くなったり、なぜかシーンファイルを開くためにダブルクリックしようとするとクリックした直後にしばらく操作できずにいて、その後はシーンの名前変更になってしまったりと若干ストレスを感じていました．私はEdit画面を主に使っているので、Edit画面からタイムラインを切り替えたいです．
もう1つはFusionのツールで、特定のノードのインスペクタに表示されるボタンを押すスクリプトです．これは、Trailsノードを使っているときに、RestartやPrerollボタンを押すことがよくあるのですが、複数のTrailsノードがあったりするととても面倒でした．</p>
<p>今回はこの2つを作成します．ここでは、最低限のプログラミングについて知っていることを前提とします（たとえば、変数や関数）．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lua">Lua<a class="hash-link" aria-label="Lua への直接リンク" title="Lua への直接リンク" href="https://mebiusbox.github.io/blog/2024/08/30/davinci-resolve-lua#lua">​</a></h2>
<p>Luaのマニュアルや日本語版へのリンクを貼っておきます：</p>
<ul>
<li><a href="https://www.lua.org/manual/5.1/" target="_blank" rel="noopener noreferrer">Lua 5.1 Manual</a></li>
<li><a href="https://inzkyk.xyz/lua_5_4/" target="_blank" rel="noopener noreferrer">Lua 5.4 Manual(JP)</a></li>
</ul>
<p>また、次の記事もシンプルでわかりやすいです：</p>
<ul>
<li><a href="https://qiita.com/aike@github/items/2023bbeb21094af6795e" target="_blank" rel="noopener noreferrer">しぶしぶ覚えるLua言語</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lua-入門">Lua 入門<a class="hash-link" aria-label="Lua 入門 への直接リンク" title="Lua 入門 への直接リンク" href="https://mebiusbox.github.io/blog/2024/08/30/davinci-resolve-lua#lua-%E5%85%A5%E9%96%80">​</a></h2>
<p>DaVinci Resolve のコンソール画面を使いながら、まずは Lua について解説します．
まずは、<code>print</code>関数から．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">"Hello World!"</span><span class="token punctuation" style="color:#f8f8f2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="print" src="https://mebiusbox.github.io/assets/images/08-30-davinci-resolve-lua-print-3be212f5c4bee676178c0ecf84754fe8.png" width="487" height="203" class="img_ev3q"></p>
<p>DaVinci ResolveのLuaのバージョンを確認します．バージョンは <code>_VERSION</code> に格納されています．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">_VERSION</span><span class="token punctuation" style="color:#f8f8f2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="version" src="https://mebiusbox.github.io/assets/images/08-30-davinci-resolve-lua-version-94511fe4bf25751bf28fb6136903e0ab.png" width="487" height="203" class="img_ev3q"></p>
<p><code>5.1</code>と結構古いです．最新版ではないので注意してください．
以降はコンソール画面のスクリーンショットを省略します．</p>
<p>変数は大域変数とローカル変数があります．ローカルの場合、<code>local</code> を指定します．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> a </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">"a="</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">a</span><span class="token operator" style="color:#66d9ef">=</span><span class="token number" style="color:#ae81ff">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> b </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">"b="</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">b</span><span class="token operator" style="color:#66d9ef">=</span><span class="token keyword" style="color:#66d9ef">nil</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>b</code>が<code>nil</code>になっています．<code>nil</code>は初期化されていない、無効な値という意味です．
今はスコープがないので、<code>local</code>で定義できません．</p>
<p>大域変数は「大域環境」または「大域テーブル」に格納されます．それは <code>_G</code> です．
<code>print(_G)</code> としてみると</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">_G</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a311d68</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>これは <code>_G</code> がテーブルで、<code>0x02549a311d68</code>はそのアドレスです．
この中身を詳しく見るには <code>dump</code>関数で見ることができます．
ですが、このテーブルはでかいので、表示するのに時間がかかってしまうし、おそらく画面に収まりません．</p>
<p>このテーブルはキーと値の2つのペアの集まりです．そのキーを表示してみましょう．
そのために、<code>for</code>文と <code>pairs</code>関数を使います．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> k</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">v </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">pairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">_G</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">k</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">_FusionApp__GetAttr_String</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">_FusionApp__GetAttr_Ptr</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">_FusionApp__GetAttr_float64</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">_FusionApp__GetAttr_uint32</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">_FusionApp__GetAttr_int32</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>それでも、結構な数があります．ここで <code>v</code> にはキーに対応した値が入っています．
どのような値が入っているかは <code>type</code> 関数でわかります．
<code>string.format</code> 関数も使って整形して表示してみましょう．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> k</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">v </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">pairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">_G</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">string</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">format</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">"%s\t%s"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> k</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">type</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">_ParticleStyle__GetAttr_ID	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">_ParticleStyle__GetAttr_String	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">_ParticleStyle__GetAttr_Ptr	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">_ParticleStyle__GetAttr_float64	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">_ParticleStyle__GetAttr_uint32	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ここまでくれば、大域環境で定義されている情報が取り出せます．
まずは組み込み関数(<code>builtin</code>)を調べてみると：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">assert	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">type	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">pairs	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">ipairs	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">setmetatable	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">9</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">getfenv	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">setfenv	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">rawget	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">rawset	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">13</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">rawequal	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">14</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">rawlen	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">15</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">unpack	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">16</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">select	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">17</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">tonumber	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">18</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">tostring	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">19</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">error	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">pcall	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">21</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">xpcall	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">22</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">loadfile	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">23</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">load	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">24</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">loadstring	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">25</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">dofile	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">26</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gcinfo	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">27</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">collectgarbage	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">28</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">newproxy	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">29</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">getmetatable	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">next	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> builtin</span><span class="token operator" style="color:#66d9ef">#</span><span class="token number" style="color:#ae81ff">4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>これは Lua に元からある関数です．</p>
<p>次に大域関数です：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">dumptostring	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a91f10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">splitpath	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a91f40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">callglob	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a91fa0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">safegetsymbol	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a91fd0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">ldofile	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a92000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">ordered	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a81db0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">printerr	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a92338</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">tr	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a92398</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">notr	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a923c8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">istype	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x0280f980</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">readdir	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a863c8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">createdir	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a86428</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">removedir	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8c348</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">pinghosts	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8c538</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">fileexists	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8c5a0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">direxists	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8c608</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">executebg	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8c670</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">getcurrentdir	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8c6d8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">setcurrentdir	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8c740</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">getpid	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8c7a8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">touserdata	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8c808</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">wait	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8c870</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">stripname	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8c998</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">isvalidname	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8ca00</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">fullpath	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8ca68</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">getclipboard	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8cca8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">setclipboard	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8cd10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">iif	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a92d60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">do_	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a92d90</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">dostring	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a91eb0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">match	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a91f70</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">dump	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a91ee0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">trace	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a81f30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">exit	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8cc70</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">module	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a85330</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">require	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a85368</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">print	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a9f180</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">eval	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02810608</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">findnest	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x0280f950</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Fusion	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a81de0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">FusionServer	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a81e10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Resolve	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a81e40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Generation	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a81e70</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">StudioPlayer	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a81ea0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">ThisApp	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a81ed0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Help	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a81f00</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">TableConstructor	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a821a0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Action	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a821d0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Event	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a82240</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Target	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a822b0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Hotkeys	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a82320</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Menus	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a92108</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Sub	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a92178</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Before	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a921e8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">After	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a92258</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Replace	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a922c8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">BITMASK	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x0280f8f0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">StartServer	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8cad0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">GetAppName	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8cb38</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">GetAppUUID	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8cba0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">CreateUUID	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8cc08</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">ToUNC	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8cd78</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">ScriptApp	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8cdd8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">AsyncScriptApp	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8ce40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">SendNotify	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8cea8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Using	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8cf10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">GetUsing	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8cf70</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">SetActiveComp	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8cf10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">GetActiveComp	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a8cf70</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">FuLimit	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02810638</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">FuLimitS	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02810668</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">FuFltLimit	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02810698</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">FuLimit8	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x028106c8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">CallEnv	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02810730</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">HexData	</span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x00a82b58</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>dump</code>関数はここにあります．これは DaVinci Resolveが用意した関数であることがわかります．</p>
<p>ライブラリなどはテーブルとして確認できます：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">io	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02432400</span><span class="token plain">	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02432400</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">math	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02437a30</span><span class="token plain">	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02437a30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">debug	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x024389c8</span><span class="token plain">	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x024389c8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">bit	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x024393c0</span><span class="token plain">	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x024393c0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Tags	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x0277c170</span><span class="token plain">	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x0277c170</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">lpeg	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x0243a690</span><span class="token plain">	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x0243a690</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">eyeon	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x0243d518</span><span class="token plain">	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x0243d518</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">class	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x0243e5d8</span><span class="token plain">	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x0243e5d8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">arg	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02448470</span><span class="token plain">	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02448470</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">bmd	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02432c18</span><span class="token plain">	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02432c18</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">ffi	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x027fecf0</span><span class="token plain">	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x027fecf0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">os	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02436af8</span><span class="token plain">	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02436af8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">string	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02437108</span><span class="token plain">	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02437108</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">jit	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02439af8</span><span class="token plain">	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02439af8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">table	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02435400</span><span class="token plain">	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02435400</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">coroutine	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02434580</span><span class="token plain">	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02434580</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">EnumMap	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x0246b4b0</span><span class="token plain">	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x0246b4b0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">TagMap	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x0246b3a8</span><span class="token plain">	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x0246b3a8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">package	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02434a80</span><span class="token plain">	table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02434a80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>最後にユーザーデータです．ユーザーデータはアプリ側（DaVinci Resolve）が用意したものです．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">fusion	</span><span class="token function" style="color:#e6db74">FusionUI</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">0x000001E6236D7040</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">fu	</span><span class="token function" style="color:#e6db74">FusionUI</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">0x000001E6236D7040</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">res	</span><span class="token function" style="color:#e6db74">Resolve</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">0x00007FF6E55FD7E0</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resolve	</span><span class="token function" style="color:#e6db74">Resolve</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">0x00007FF6E55FD7E0</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">app	</span><span class="token function" style="color:#e6db74">FusionUI</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">0x000001E6236D7040</span><span class="token punctuation" style="color:#f8f8f2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>アドレスが同じものは、指しているデータが同じなのでまったく同じものになります．
ですから、<code>fusion</code>と<code>fu</code>、<code>app</code>はすべて同じだとわかります．<code>res</code>と<code>resolve</code>も同様です．</p>
<p>Luaのテーブルは <code>{}</code> で作成できます．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">a </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>値の追加や設定は <code>a['key'] = value</code> という書き方をします．ここで <code>a</code> はテーブルです．
これは <code>a.key = value</code> とも書くことができます．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> a </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#a6e22e">'name'</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"John"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">age </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">dump</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x0254c17062c0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">	name </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> John</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">	age </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">20</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコー�ドをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>この<code>dump</code>関数はプロンプトの先頭に<code>==</code>と書いても同じです．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> a </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token string" style="color:#a6e22e">'name'</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"John"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> a</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">age </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">==</span><span class="token plain">a</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x0254c17062c0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">	name </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> John</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">	age </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">20</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>テーブルの初期化時に書くこともできます．その場合は <code>key = value</code>とします．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> a </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> name </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"John"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> age </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">20</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">dump</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x0254c1706a50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">	name </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> John</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">	age </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">20</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Luaでは配列もテーブルで扱います．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> a </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">2</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">4</span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配列のアクセスは<code>1</code>から始まります．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> a </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">2</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">4</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>#</code> を変数の前につけることで長さを取得できます．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> a </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">2</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">4</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#66d9ef">#</span><span class="token plain">a</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配列の各要素にアクセスするには<code>for</code>文を使います．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> a </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">2</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">4</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> i</span><span class="token operator" style="color:#66d9ef">=</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token operator" style="color:#66d9ef">#</span><span class="token plain">a </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>これは <code>ipairs</code>関数を使っても同じことができます．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> a </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">2</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">4</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">v </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ipairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">v </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ipairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>実は配列に<code>pairs</code>関数を使っても同じ結果になります．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> a </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">2</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">3</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">4</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">v </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">pairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">v </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">pairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">v</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">4</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>次に条件分岐ですが、<code>if</code>文を使います．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> a </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> b </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> a</span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token plain">b </span><span class="token keyword" style="color:#66d9ef">then</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">"a&lt;b"</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">else</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">"a&gt;=b"</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">a</span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token plain">b</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> a </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> b </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> a</span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token plain">b </span><span class="token keyword" style="color:#66d9ef">then</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">"a&lt;b"</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">else</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">"a&gt;=b"</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">a</span><span class="token operator" style="color:#66d9ef">&gt;=</span><span class="token plain">b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>また、DaVinci ResolveのLuaには<code>iif</code>関数があります．
これは、単純なif文を1行で短く書けます．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> a </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> b </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> c </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">iif</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">a</span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token number" style="color:#ae81ff">3</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>これは <code>a</code> が3未満の場合に<code>a</code>の値、そうでないなら<code>b</code>の値が返ります．</p>
<p>複数の条件を組み合わせるときは <code>and</code> または <code>or</code> を使います．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> a </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> a</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token number" style="color:#ae81ff">5</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">and</span><span class="token plain"> a</span><span class="token operator" style="color:#66d9ef">%</span><span class="token number" style="color:#ae81ff">2</span><span class="token operator" style="color:#66d9ef">==</span><span class="token number" style="color:#ae81ff">0</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">then</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">"OK"</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">else</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">"NG"</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">OK</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>比較演算子は、<code>==</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, <code>&gt;=</code> と一般的なものが使えますが、等しくない場合、<code>~=</code>となりますので注意してください．</p>
<p>次に関数定義です．<code>function</code> と <code>end</code> で囲みます．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">add</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">b</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> a</span><span class="token operator" style="color:#66d9ef">+</span><span class="token plain">b </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#e6db74">add</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">10</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token number" style="color:#ae81ff">20</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token number" style="color:#ae81ff">30</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>オブジェクトの関数を呼び出す場合、関数が引数にオブジェクトそのものを受け取るものがあります．この場合、オブジェクトの関数の呼び方は2種類あります．
たとえば、型が<code>hoge</code>のオブジェクト<code>obj</code>の関数<code>foo</code>を呼びたい場合、次のようになります：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> hoge</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">foo</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">foo</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>この2つはどちらも同じです．前者は型を明記する必要があるので、基本的に後者を使います．
あとは、コメント機能です．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic">-- コメント</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">--[[</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic">  複数行コメント</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic">--]]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>複数行コメントは閉じるときに <code>]]</code> だけでもいいのですが、<code>--]]</code> にすればコメントを開くときの <code>--[[</code> を <code>---[[</code> とするだけで切り替えられて便利です．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic">--[[</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic">  複数行コメント</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic">--]]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">---[[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">"この行は有効になる"</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">--]]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>最後に、文字列の連結は <code>..</code> 演算子を使います．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> m </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Hello"</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">..</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">" World!"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">m</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Hello World!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Luaには他にも機能がありますが、とりあえずこれぐらいの知識があれば今回は大丈夫かと思います．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="bmdライブラリ">bmdライブラリ<a class="hash-link" aria-label="bmdライブラリ への直接リンク" title="bmdライブラリ への直接リンク" href="https://mebiusbox.github.io/blog/2024/08/30/davinci-resolve-lua#bmd%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA">​</a></h2>
<p>前述したようにLuaは必要最低限の機能しか提供しておらず、DaVinci Resolveがある程度機能を提供してくれないと使い物になりません．
bmd(Black Magic Design?)ライブラリはDaVinci Resolveが提供しているライブラリです．このライブラリに含まれているものが大域環境に公開されていたりします．</p>
<p>中身を見てみましょう：</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Lua</span><span class="token operator" style="color:#66d9ef">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">dump</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">bmd</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">table</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a312c18</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">fileexists </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31c5a0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">direxists </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31c608</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">executebg </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31c670</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">getcurrentdir </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31c6d8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">setcurrentdir </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31c740</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">getpid </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31c7a8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">touserdata </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31c808</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">wait </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31c870</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">getuptime </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31c8d0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">gettime </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31c938</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">stripname </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31c998</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">isvalidname </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31ca00</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">isquotable </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31ca68</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">fullpath </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31cad0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">startserver </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31cb38</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">getappname </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31cba0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">getappuuid </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31cc08</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">createuuid </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31cc70</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">getclipboard </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31cd10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">setclipboard </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31cd78</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">tounc </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31cde0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">scriptapp </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31ce40</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">asyncscriptapp </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31cea8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">sendnotify </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31cf10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">using </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31cf78</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">getusing </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31cfd8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">obtaingloballock </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31d040</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">exit </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31ccd8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">defragfile </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31d120</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">defragsequence </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31d188</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">readfile </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31d1f0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">writefile </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31d258</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">readstring </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31d2c0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">writestring </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31d328</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">openfileexternal </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31d390</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">openurl </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31d400</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">setapptitle </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31d460</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">translate </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31d4c8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">UIDispatcher </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a32f8a8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">settrcontext </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a322560</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">nextstate </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a311f90</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">getstateindex </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a311f60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">_VERSION </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"19.0"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">releasegloballock </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31d0b0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">readdir </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a3163c8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">createdir </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a316428</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">removedir </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31c348</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">crash </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31c3b0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">allocconsole </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31c410</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">suspend </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31c478</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">noise </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31c4d8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">pinghosts </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0x02549a31c538</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>この中で重要なのはDaVinci ResolveでUIを管理する<code>UIDispatcher</code>です．これを使ってツールを作ります．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="opentimeline">OpenTimeline<a class="hash-link" aria-label="OpenTimeline への直接リンク" title="OpenTimeline への直接リンク" href="https://mebiusbox.github.io/blog/2024/08/30/davinci-resolve-lua#opentimeline">​</a></h2>
<p>それでは1つ目のツールを作ります．これはプロジェクトにあるタイムラインをすべて列挙して表示し、選択することでそのタイムラインを開くものです．
ここからはスクリプトファイルを作成する必要があります．スクリプトファイルの場所はコンソールから以下のスクリプトで開くことができます．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">bmd</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">openfileexternal</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">"Open"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> fusion</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">MapPath</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">"Scripts:"</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>openfileexternal</code>は外部アプリケーションで開く関数です．</p>
<p>私の場合、<code>C:\Users\&lt;user&gt;\AppData\Roaming\Blackmagic Design\DaVinci Resolve\Support\Fusion</code>のフォルダが開きます．
その中の <code>Comp</code>フォルダに <code>OpenTimeline.lua</code> ファイルを作成します．</p>
<p>とくに決まりはありませんが、ここでは<code>main</code>関数を作ります．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">OpenTimeline.lua</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">main</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">"Hello World!"</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token function" style="color:#e6db74">main</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>この状態で、DaVinci Resolveのメニューから「Workspace &gt; Scripts &gt; Comp &gt; OpenTimeline」の項目があるか確認し、実行してみましょう．
コンソールに "Hello World!" と表示されれば問題ありません．もし、Fusionページを開いているなら「Workspace &gt; Scripts &gt; OpenTimeline」となります．</p>
<p>具体的な処理は<code>main</code>関数に書いていきます．
まずはお約束として、現在開いているプロジェクト情報にアクセスできるようにします．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">main</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> pm </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> resolve</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetProjectManager</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> cm </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> pm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetCurrentProject</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> mp </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> cm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetMediaPool</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">end</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>タイムラインはメディアプールに含まれています．
メディアプールのルートフォルダを取得して、タイムラインを検索します．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">main</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> pm </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> resolve</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetProjectManager</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> cm </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> pm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetCurrentProject</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> mp </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> cm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetMediaPool</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> rootFolder </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> mp</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetRootFolder</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> clips </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">scandir</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">rootFolder</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> rootFolder</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetName</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">end</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>これから作成する<code>scandir</code>という関数はフォルダ内のクリップを取得します．
フォルダの<code>GetSubFolderList</code>でサブフォルダを、<code>GetClipList</code>でクリップを取得します．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">scandir</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">folder</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> parentName</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> clips </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">'scan... ['</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">..</span><span class="token plain"> folder</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetName</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">..</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">']'</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> subfolders </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> folder</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetSubFolderList</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">sub </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ipairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">subfolders</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> subclips </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">scandir</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">sub</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> parentName </span><span class="token operator" style="color:#66d9ef">..</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'/'</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">..</span><span class="token plain"> sub</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetName</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> k</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">v </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">pairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">subclips</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"> clips</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">k</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> v </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> subclips </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> folder</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetClipList</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">clip </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ipairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">subclips</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> clipName </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> clip</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetClipProperty</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">'Clip Name'</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> clipType </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> clip</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetClipProperty</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">'Type'</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> path </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> parentName </span><span class="token operator" style="color:#66d9ef">..</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'/'</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">..</span><span class="token plain"> clipName</span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        clips</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">path</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> Name</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">clipName</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> Type</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">clipType</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> Clip</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">clip </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> clips</span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">main</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> pm </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> resolve</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetProjectManager</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> cm </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> pm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetCurrentProject</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> mp </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> cm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetMediaPool</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> rootFolder </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> mp</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetRootFolder</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> clips </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">scandir</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">rootFolder</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> rootFolder</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetName</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">end</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>クリップを見つけたら <code>GetClipProperty</code> でクリップ名とクリップの種類を取得して一時テーブルに格納して、そのテーブルを返します．
クリップの列挙が終わったら、それを表示して選択できるようにしましょう．
bmdライブラリの<code>UIDispatcher</code>を使います．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">main</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> pm </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> resolve</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetProjectManager</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> cm </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> pm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetCurrentProject</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> mp </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> cm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetMediaPool</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> rootFolder </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> mp</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetRootFolder</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> clips </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">scandir</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">rootFolder</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> rootFolder</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetName</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    ui </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> fu</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">UIManager</span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    dispatcher </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> bmd</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">UIDispatcher</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ui</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> dispatcher</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">AddWindow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            ID </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'MainWin'</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            WindowTitle </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'Open Timeline...'</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            Geometry </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">400</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">300</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">800</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">400</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            ui</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">Tree</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                ID </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Tree"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                SortingEnabled </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">true</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                Events </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                    ItemDoubleClicked </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">true</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">On</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">MainWin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Close</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ev</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ev</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        dispatcher</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">ExitLoop</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">Show</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    dispatcher</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">RunLoop</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">Hide</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">end</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>これを実行すると次のようなウィンドウが表示されます．</p>
<p><img decoding="async" loading="lazy" alt="OpenTimeline - Window" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAkAAAAFuCAYAAABp1KftAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABCpSURBVHhe7d1rjFzlecDxd8e7NldfMGURgSwYQ0wkDG65FCMKAoTbQCuhIkFFpQrKpVJDJCSE+qEgCvlSpAoa8qEKFPqhRAoyoan4UrC5pQSjIJGYtgFfAosv2ASDr4S1d3Y6z+HMZg322sa7sN7n97MOfs85M7Pji8Tf533nbNcJJ5zQKiP09PSU6dOnl2nTplVbd3d3fQYA4NAwODhYPvnkkzIwMFC2bdtWdu3aVZ/51G4BNHPmzNLb21uuu+66cuqpp5a5c+eW2bNn12cBAA4NmzZtKqtWrSqrV68uP/rRj8qGDRvK5s2b67MjAijC59JLLy233HJLaR+rTgIAHOrWr19fHn744fLiiy9W41arVaYcffTR98SVn0WLFpV77rmntPfrhwMAHPqibS655JLy9ttvlzVr1lRTY41Y8xNXf26++eb6YQAAk0/Mch1//PHVeudGLHiONT+mvQCAySxa59prr62uCDXik16x4HlvhoaGSldX16hbPAYAYKKL5on26brwwgtbjz/++B4/7TWwc1d55If/WZb98s3yyc7B0uhqlHbxtM/E1iqt1lA5rKe7nH/2vHLzX/xpmTq1p3oeAMBEFJ8Ou/7660sj7vOzp/hpNpvl4cf/ozz24yVlRf/Gsvb9rWXNb7aVdR9sb2/bytr2OI6tePf98m9PLS0/+OFPqucAAF+NO+64o8yYMaOa4tnTFufiMRPN/LPOLi/99Kf13ufFubPOXlDvHZxonmifRr3/OY1Goyz7xa/aP08pXfXW03di+eCf7inNf7y7HHbC14aPx2Ne/cWb1XP2x+LFi3f7A7n99tvrM+PrlVde2e3rjvz6nfc0Vq6++urq64V43Xh9ABhP8VHvZcuWlbVr1+5xe/3116vHTDTf//5D5cYbb9xjBMWxOPfQQ9+rj4yNvRZLfEb+k4Gd1WxXV/Wj/fN580rXzp7StbW7HNl3ejt+GsPrgOKx8Zx9efDBB8u9995b3ZWxs73zzjtfSgRdcMEFw1/zlFNOKW+88UY1fuCBB8o111xTjcdDvG68PgCMp1iTGwt940rPnrY5c+ZMyHW7f3TRReXRRx/9XAR14ifOxWPG0iiXbNoxEz1T/RQ/Spm1/t1y+eC2ctHWHeWI99ZUwVP9qMKns+1dhM5dd91Vli9fXh/51FNPPVWWLl1anQcA8vlsBI1n/IRRrgBV/23/PFRa7VpsDg6WjT9bURZuXlkWbFlR3n1nVWk2B6tzVQhVW/XUvXrttdfKTTfdVO/t7rLLLqvOh86U0cgpqo6IpM7x2DrRNHIaK7aYgjoQMV3VeU68Trxe7MdrxXjk9NnI6azPTqvtyfz584ffZ4xHvs+4ItYx8ng8DgAyGRlB4xk/YdQpsCpu2tvCC0t56P6Ty/f+4U/KxuX/WzasfrP8y41/Vh49b0G57PBp7cc0h0NoX/r6+urR7uJ4zE92vPzyy8PTVY888sjwepozzzxz+HhMYY2MoxtuuGH4XHzvj85zvoj4mnfeeWf1WjG+//77q/EzzzxTTeGFiJpbb711+GvGuZHvZ2/iU3fx+Hj/cUUsxHvtHI/t7rvv3i2OAPhydf5Buq+NQ9PoAdRqlp7uXeVvblpXvn7Cf5d5J64uxx6+vfR27yhnTvlNOWPt8vL3zY/L1MFY/xNzivsOoP7+/nq0uzh+4okn1nulWpfTcd9995VXX311OGg6f+kihpYsWVIdC4899lg9+vSK0rp16+q9AxdXqmLNULj88surGApxLG6lHeKKVYw77+eKK66opvL2pfNrO/nkk6u1SBFS8euLX0vntW5ox1x8zxIAvhqdf5Dua2PsjJz2GjkdNh72vgaovgK0a+dg2bxpTdn+fn/ZtPIn5alnl5cnX1peti57sny8Y0XZ+ts1ZVc1Fdbc5xWgc845p7qasicRDnF+bzpxFDEykf7yRSiNfC+fXd90ICL0Rr5WrI0CgAw+u+bns2uCxtrerwC1t2k9U9oB1Czfvffr5b+eObZ899Fp5e0NQ+XXW5rl7/6nWZ7oPqL87c4jys52KMVj9zUDFlc8Ihg+u74l1trEFZs439FZZxNXR2KaKOIorr7EVZKDmdoaS52g66zvORjnn3/+8HTYSPHacUUoxJRYZ4otfg8nyu8DABND3I4mbvS3N/Gd0Pf3ljVfpr0teB7PCBr1d+Gc+fPK0OCu0r+2p/zgiVnl528eUYaau0prcGd55cPu8s+rG2XlQCnN9mPOnf+N+lmji+mf+IV0pnpiu/jii3eb8gqxBijOxTRXTG114ijW2cRUU+e5+7PmZrzEe4r3Fu+x836+6LqdiLu4AtR5ndhGLrYGgH2Jb2y+YMGC3f5fMnI744wzJtw3P4/Zo9tu+87n4qejE0Hf/vZt9ZGx0dWOj9bTTz9d7+7uo82byyP//mT5+S9/VQYGdrUfHXcDGqlVpk2dWs49a1656S//vMyaObM+fnDiDymmgACAyS8iKO4p+GW56qqrRg+gMDAwUIaGmnu9cVJcSos7Qcc3FhsrAggAGC8RQPucCIywOfzwI8qRRx61xy3OjWX8AACMt4m3EqrN1R8AYDxNyAACABhPAggASEcAAQDpCCAAIB0BBACkU90HaOPGj+pdAIDJrbd3litAAEA+AggASEcAAQDpCCAAIB0BBACkI4AAgHQEEACQjgACANIRQABAOgd0J+j+/pX1CABgYunrO60ejS7uBH3AAXT88SfVewAAX705p3+j/OylJQcUQKbAAIB0BBAAkI4AAgDSEUAAQDoCCABIZ2wDqHtmmX/VX5Xv/PUl5cT6EADA/hoaGiqtVqve210cHxpq1nsHZwwD6Gvl0muvKMetfLOsr48AAOyviJtFiy4r5577+5+LoNg/77w/KN/61qLSbB58BI1hAK0rzz3+RFny1m/rfQCAA9FVVqxYWb75zXnlggvOa0fPUHU04if24/hbb71VGo2u6vjBsAYIAJgQurq6ysqVq8vzz79Y5s6dUxYu/MMqdhYuPL/af/75F9oBtCoe+ekTDoIAAgAmhAignp6pZfXqt8tzz71Q5sw5uVx55R+Xvr6TytKlz5dVq96uzsfjDpYAAgAmjE4EvfPOu+XZZ5dW630ifvr714xZ/AQBBABMKJ0IWrt2fVm8+Mdl3br3xjR+ggACACacTgQdfviRYx4/YRwCaHlZ/K8vlLX1HgDAFxHR09nGmitAAEA6AggASEcAAQDpCCAAIJ2uiy++uLVx40f17uj6+1fWIwCAiaWv77R6NLre3lkHHkD7++IAAF+WA2mUCCBTYABAOgIIAEhHAAEA6QggACAdAQQApCOAAIB0BBAAkI4AAgDSEUAAQDoCCABIRwABAOkIIAAgHQEEAKQjgACAdAQQAJCOAAIA0hFAAEA6AggASEcAAQDpCCAAIB0BBACkI4AAgHQEEACQjgACANIRQABAOgIIAEhHAAEA6QggACAdAQQApCOAAIB0BBAAkI4AAgDSEUAAQDoCCABIRwABAOkIIAAgHQEEAKQjgACAdAQQAJCOAAIA0hFAAEA6AggASEcAAQDpCCAAIB0BBACkI4AAgHQEEACQjgACANIRQABAOgIIAEhHAAEA6QggACAdAQQApCOAAIB0BBAAkI4AAgDSEUAAQDoCCABIRwABAOkIIAAgHQEEAKQjgACAdAQQAJCOAAIA0hFAAEA6AggASEcAAQDpCCAAIB0BBACkI4AAgHQEEACQjgACANIRQABAOgIIAEhHAAEA6QggACAdAQQApCOAAIB0BBAAkI4AAgDSEUAAQDoCCABIp7Fjx456CAAw+UX7NGbMOKbeBQCY/KJ9TIEBAOkIIAAgHQEEAKQjgACAdAQQAJCOAAIA0hFAAEA6AggASEcAAQDpCCAAIB0BBACk05g1+9h6CAAw+UX7uAIEAKTT+GjTB/UQAGDyi/ZxBQgASEcAAQDpCCAAIB0BBACkI4AAgHQEEACQjgACANIRQABAOgIIAEhHAAEA6QggACAdAQQApCOAAIB0BBAAkI4AAgDSEUAAQDoCCABIRwABAOkIIAAgHQEEAKQjgACAdAQQAJCOAAIA0hFAAEA6AggASEcAAQDpCCAAIB0BBACkI4AAgHQEEACQjgACANIRQABAOgIIAEhHAAEA6QggACAdAQQApCOAAIB0BBAAkI4AAgDSEUAAQDoCCABIRwABAOkIIAAgHQEEAKTT2LLlw3oIADD5Rfs0Zsw4pt4FAJj8on1MgQEA6QggACAdAQQApCOAAIB0BBAAkI4AAgDSEUAAQDoCCABIRwABAOkIIAAgHQEEAKQjgACAdAQQAJCOAAIA0hFAAEA6AggASEcAAQDpCCAAIB0BBACkI4AAgHQEEACQjgACANJpbNnyYT0EAJj8on0as2f31rsAAJNftI8pMAAgHQEEAKQjgACAdAQQAJCOAAIA0hFAAEA6AggASEcAAQDpCCAAIB0BBACkI4AAgHQEEACQjgACANIRQABAOgIIAEhHAAEA6QggACAdAQQApCOAAIB0BBAAkE6jp2dKPQQAyKHR23tcPQQAyMEUGACQTmPuqafWQwCAHBpHT59RDwEAcjAFBgCk09iwYUM9BADIofHhh5vqIQBADo3p06fXQwCAHBql1aqHAAA5NPQPAJCNT4EBAOm0A8glIAAgl4b8AQCysQgaAEjHGiAAIB1TYABAOqbAAIB0TIEBAOm4ESIAkI4rQABAOhZBAwDpuBM0AJCOT4EBAOmYAgMA0rEIGgBIRwABAOlYAwQApONGiABAOhZBAwDpWAMEAKTjRogAQDquAAEA6TRaVkEDAMm4AgQApCOAAIB03AgRAEjHfYAAgHTcCRoASMd9gACAdCyCBgDScR8gACAdV4AAgHQEEACQjgACANIRQABAOgIIAEhHAAEA6TTee29DPQQAyKGxffvH9RAAIAdTYABAOgIIAEhHAAEA6QggACAdAQQApCOAAIB0BBAAkI4AAgDSEUAAQDoCCABIp7HwvNPrIQBADo3/2zy9HgIA5NA4ZVZPPQQAyKHx64921UMAgBwavcccVg8BAHJoNDdvqYcAADk0Vr/5Rj0EAMjBfYAAgHQEEACQjgACANIRQABAOgIIAEhHAAEA6QggACAdAQQApCOAAIB0BBAAkI4AAgDSEUAAQDoCCABIRwABAOkIIAAgHQEEAKQjgACAdAQQAJCOAAIA0hFAAEA6AggASEcAAQDpCCAAIB0BBACkI4AAgHQEEACQjgACANIRQABAOgIIAEhHAAEA6QggACAdAQQApCOAAIB0BBAAkI4AAgDSEUAAQDoCCABIRwABAOkIIAAgHQEEAKTTtWjRla3+/jX17uj6+1fWIwCAiaWv77R6NLq+vpMOLIAAAA51EUCmwACAdAQQAJBOo9lslu7uKfUuAMDkFc0T7dPYuXNnmTp1an0YAGDyiuYZGBiIANolgACAFKJ5on0a27fvKEcffVTp7u6uTwEATD7ROtE8O3Z8XBqDg4Nly5at5ZhjZtWnAQAmn2idaJ5on+pTYFu3bitdXaUcd9zvuRIEAEwq0TbROKW0yrZt26tjXfPmzW9Vg3YBxWWhGTOmVydjcXRsg4PN6oEAAIeK+LRXrPeJLfomrvxE37RaVfb8LoA6opKOOurI9hN6qidNmeIj8gDAoSU+6h6f9ooFz7HmJ6a9fqeU/wd0p9uzA3IHBgAAAABJRU5ErkJggg==" width="576" height="366" class="img_ev3q"></p>
<p><code>dispatcher</code>の関数<code>AddWindow</code>でウィンドウを作成しています．
<code>ID</code>は固有ID、<code>WindowTitle</code>はウィンドウのタイトル、<code>Geometry</code>はウィンドウの位置と大きさです．
UI要素として、Treeを配置しています．Treeでは <code>SortingEnabled</code> を有効にして自動ソートさせています．
また、<code>ItemDoubleClicked</code>イベントを有効にすることでダブルクリックイベントを発生させるようにしています．</p>
<p>最後の部分は、ウィンドウが閉じられた時の処理や、ウィンドウの表示、ループ処理などを行っています．ここは定型のような部分です．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">win</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">On</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">MainWin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Close</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ev</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ev</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    dispatcher</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">ExitLoop</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">win</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">Show</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">dispatcher</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">RunLoop</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">win</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">Hide</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>では、このTreeに列挙したクリップを表示しましょう．
まずはTreeの表示をカスタマイズします．カラムを2つにしてヘッダー名を設定します．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">items </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> win</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetItems</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">hdr </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">NewItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">hdr</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'Clip Name'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">hdr</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'Path'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">SetHeaderItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">hdr</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ColumnWidth</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">200</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>そして、クリップを追加します．タイムラインのみにしたいので、クリップの種類で判定します．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> k</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">v </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">pairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">clips</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> v</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Type </span><span class="token operator" style="color:#66d9ef">==</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Timeline"</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        newTreeItem </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">NewItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        newTreeItem</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> v</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Name</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        newTreeItem</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> k</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">AddTopLevelItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">newTreeItem</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>これらを組み込みましょう．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">main</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> pm </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> resolve</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetProjectManager</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> cm </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> pm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetCurrentProject</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> mp </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> cm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetMediaPool</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> rootFolder </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> mp</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetRootFolder</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> clips </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">scandir</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">rootFolder</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> rootFolder</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetName</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    ui </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> fu</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">UIManager</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    dispatcher </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> bmd</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">UIDispatcher</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ui</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> dispatcher</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">AddWindow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            ID </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'MainWin'</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            WindowTitle </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'Open Timeline...'</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            Geometry </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">400</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">300</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">800</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">400</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            ui</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">Tree</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                ID </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Tree"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                SortingEnabled </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">true</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                Events </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                    ItemDoubleClicked </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">true</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    items </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> win</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetItems</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    hdr </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">NewItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    hdr</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'Clip Name'</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    hdr</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'Path'</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">SetHeaderItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">hdr</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ColumnWidth</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">200</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> k</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">v </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">pairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">clips</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> v</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Type </span><span class="token operator" style="color:#66d9ef">==</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Timeline"</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">then</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            newTreeItem </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">NewItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            newTreeItem</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> v</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Name</span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            newTreeItem</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> k</span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">AddTopLevelItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">newTreeItem</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">On</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">MainWin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Close</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ev</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ev</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        dispatcher</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">ExitLoop</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">Show</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    dispatcher</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">RunLoop</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">Hide</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">end</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>実行すると次のようになります．</p>
<p><img decoding="async" loading="lazy" alt="OpenTimeline - Tree" src="https://mebiusbox.github.io/assets/images/08-30-davinci-resolve-lua-open-timeline-002-efeb2442de3d308dcbf394365e5bd7ce.png" width="644" height="343" class="img_ev3q"></p>
<p>後はダブルクリックしたときの処理を入れます．そのまえに、タイムラインを開く処理（<code>OpenTimeline</code>関数）を追加しましょう．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">OpenTimeline</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">clipName</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> count </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> cm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetTimelineCount</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> i</span><span class="token operator" style="color:#66d9ef">=</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">count </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> timeline </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> cm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetTimelineByIndex</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> timeline</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetName</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">==</span><span class="token plain"> clipName </span><span class="token keyword" style="color:#66d9ef">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            cm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">SetCurrentTimeline</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">timeline</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>これはクリップ名からタイムラインオブジェクトを検索して現在のタイムラインに設定します．
残りの処理を入れましょう．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">win</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">On</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ItemDoubleClicked </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ev</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#e6db74">OpenTimeline</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#e6db74">tostring</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ev</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">item</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    dispatcher</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">ExitLoop</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>やっていることは単純で先ほど作成した<code>OpenTimeline</code>にダブルクリックしたときのクリップ名を渡して呼んでいます．
今回はダブルクリックしてタイムラインを開いたら、ウィンドウを閉じるようにしています．</p>
<p>ここまでのコードです．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">main</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> pm </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> resolve</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetProjectManager</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> cm </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> pm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetCurrentProject</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> mp </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> cm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetMediaPool</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> rootFolder </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> mp</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetRootFolder</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> clips </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">scandir</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">rootFolder</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> rootFolder</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetName</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    ui </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> fu</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">UIManager</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    dispatcher </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> bmd</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">UIDispatcher</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ui</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> dispatcher</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">AddWindow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            ID </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'MainWin'</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            WindowTitle </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'Open Timeline...'</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            Geometry </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">400</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">300</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">800</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">400</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            ui</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">Tree</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                ID </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Tree"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                SortingEnabled </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">true</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                Events </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                    ItemDoubleClicked </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">true</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    items </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> win</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetItems</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    hdr </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">NewItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    hdr</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'Clip Name'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    hdr</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'Path'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">SetHeaderItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">hdr</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ColumnWidth</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">200</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> k</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">v </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">pairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">clips</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> v</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Type </span><span class="token operator" style="color:#66d9ef">==</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Timeline"</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">then</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            newTreeItem </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">NewItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            newTreeItem</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> v</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Name</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            newTreeItem</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> k</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">AddTopLevelItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">newTreeItem</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">OpenTimeline</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">clipName</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> count </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> cm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetTimelineCount</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> i</span><span class="token operator" style="color:#66d9ef">=</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">count </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> timeline </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> cm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetTimelineByIndex</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> timeline</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetName</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">==</span><span class="token plain"> clipName </span><span class="token keyword" style="color:#66d9ef">then</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                cm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">SetCurrentTimeline</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">timeline</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token keyword" style="color:#66d9ef">break</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">On</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ItemDoubleClicked </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ev</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token function" style="color:#e6db74">OpenTimeline</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#e6db74">tostring</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ev</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">item</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        dispatcher</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">ExitLoop</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">On</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">MainWin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Close </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ev</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        dispatcher</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">ExitLoop</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">Show</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    dispatcher</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">RunLoop</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">Hide</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">end</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>これでタイムラインを開くツールはできたのですが、もう少し使いやすくしましょう．
検索機能を入れます．具体的な詳細は省きますが、検索用のUIを追加し、入力された文字が更新されるたびにフィルターをかけるようにします．
また、検索入力のところでEnterキーを押したら、Treeの一番上に表示されているタイムラインを開くようにもしています．</p>
<p>最終的なコードは次のようになります．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">OpenTimeline.lua</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">scandir</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">folder</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> parentName</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> clips </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token function" style="color:#e6db74">print</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">'scan... ['</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">..</span><span class="token plain"> folder</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetName</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">..</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">']'</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> subfolders </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> folder</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetSubFolderList</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">sub </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ipairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">subfolders</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> subclips </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">scandir</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">sub</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> parentName </span><span class="token operator" style="color:#66d9ef">..</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'/'</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">..</span><span class="token plain"> sub</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetName</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> k</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">v </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">pairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">subclips</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"> clips</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">k</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> v </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> subclips </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> folder</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetClipList</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">clip </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ipairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">subclips</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> clipName </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> clip</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetClipProperty</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">'Clip Name'</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> clipType </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> clip</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetClipProperty</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">'Type'</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> path </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> parentName </span><span class="token operator" style="color:#66d9ef">..</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'/'</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">..</span><span class="token plain"> clipName</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        clips</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain">path</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> Name</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">clipName</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> Type</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">clipType</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> Clip</span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain">clip </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">return</span><span class="token plain"> clips</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">main</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> pm </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> resolve</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetProjectManager</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> cm </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> pm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetCurrentProject</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> mp </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> cm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetMediaPool</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> rootFolder </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> mp</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetRootFolder</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> clips </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">scandir</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">rootFolder</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> rootFolder</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetName</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    ui </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> fu</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">UIManager</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    dispatcher </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> bmd</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">UIDispatcher</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ui</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> dispatcher</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">AddWindow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            ID </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'MainWin'</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            WindowTitle </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'Open Timeline...'</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            Geometry </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">400</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">300</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">800</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">400</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            ui</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">VGroup</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                ui</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">HGroup</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                    Weight </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                    ui</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">Label</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain">Text </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'Search: '</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> Weight </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                    ui</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">LineEdit</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                        ID </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"SearchText"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                        Text </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">""</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                        PlaceholderText </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Search Text..."</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                        ClearButtonEnabled </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">true</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                        Events </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                            TextChanged </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">true</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                            ReturnPressed </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">true</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                ui</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">HGroup</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                    ui</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">Tree</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                        ID </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Tree"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                        SortingEnabled </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">true</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                        Events </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                            ItemDoubleClicked </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">true</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    items </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> win</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetItems</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    hdr </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">NewItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    hdr</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'Clip Name'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    hdr</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'Path'</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">SetHeaderItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">hdr</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ColumnWidth</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">200</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> k</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">v </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">pairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">clips</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> v</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Type </span><span class="token operator" style="color:#66d9ef">==</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Timeline"</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">then</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            newTreeItem </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">NewItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            newTreeItem</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> v</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Name</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            newTreeItem</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> k</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">AddTopLevelItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">newTreeItem</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">OpenTimeline</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">clipName</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> count </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> cm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetTimelineCount</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> i</span><span class="token operator" style="color:#66d9ef">=</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">count </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> timeline </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> cm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetTimelineByIndex</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">i</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> timeline</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetName</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">==</span><span class="token plain"> clipName </span><span class="token keyword" style="color:#66d9ef">then</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                cm</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">SetCurrentTimeline</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">timeline</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token keyword" style="color:#66d9ef">break</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">On</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">SearchText</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">TextChanged </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ev</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">Clear</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> searchText </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> ev</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">lower</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> k</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">v </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">pairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">clips</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> v</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Type </span><span class="token operator" style="color:#66d9ef">==</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Timeline"</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">and</span><span class="token plain"> v</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Name</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">lower</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">find</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">searchText</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">then</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                newTreeItem </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">NewItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                newTreeItem</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> v</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Name</span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                newTreeItem</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">1</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> k</span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">AddTopLevelItem</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">newTreeItem</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">On</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">SearchText</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ReturnPressed </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ev</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">local</span><span class="token plain"> currentItem </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> items</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">ItemAt</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> currentItem </span><span class="token keyword" style="color:#66d9ef">then</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token function" style="color:#e6db74">OpenTimeline</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#e6db74">tostring</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">currentItem</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            dispatcher</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">ExitLoop</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">On</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Tree</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">ItemDoubleClicked </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ev</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token function" style="color:#e6db74">OpenTimeline</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#e6db74">tostring</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ev</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">item</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Text</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        dispatcher</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">ExitLoop</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">On</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">MainWin</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Close </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">ev</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        dispatcher</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">ExitLoop</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">Show</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    dispatcher</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">RunLoop</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    win</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">Hide</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#f8f8f2"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token function" style="color:#e6db74">main</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>実行すると次のようになります．</p>
<p><img decoding="async" loading="lazy" alt="OpenTimeline - Final" src="https://mebiusbox.github.io/assets/images/08-30-davinci-resolve-lua-open-timeline-final-37c1ea9d6e6e075b8d76b682277304e6.png" width="624" height="327" class="img_ev3q"></p>
<p>これで完成です．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fusionで特定のノードのボタンを押す">Fusionで特定のノードのボタンを押す<a class="hash-link" aria-label="Fusionで特定のノードのボタンを押す への直接リンク" title="Fusionで特定のノードのボタンを押す への直接リンク" href="https://mebiusbox.github.io/blog/2024/08/30/davinci-resolve-lua#fusion%E3%81%A7%E7%89%B9%E5%AE%9A%E3%81%AE%E3%83%8E%E3%83%BC%E3%83%89%E3%81%AE%E3%83%9C%E3%82%BF%E3%83%B3%E3%82%92%E6%8A%BC%E3%81%99">​</a></h2>
<p>2つ目のツールです．
まず、現在開いているFusionのノードは <code>GetToolList</code>で列挙できます．<code>comp</code>は現在のコンポジションオブジェクトです．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">tools </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> comp</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetToolList</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#66d9ef">false</span><span class="token punctuation" style="color:#f8f8f2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>選択したノードだけ列挙したい場合は、次のようになります．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">tools </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> comp</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetToolList</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#66d9ef">true</span><span class="token punctuation" style="color:#f8f8f2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>特定のノードを絞り込みたい場合は、すべてのノードを列挙して走査するか、ノードタイプがわかっているならば、<code>GetToolList</code>の引数に渡すことができます．
たとえば、<code>Trails</code>ノードのみ列挙したい場合は次のようになります</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">tools </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> comp</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetToolList</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#66d9ef">false</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Trails"</span><span class="token punctuation" style="color:#f8f8f2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Fusion上で各ノードの種類を確認したい場合、<code>Ctrl+Shift+E</code>キーで確認できます．</p>
<p>次に、各ノードのパラメータを設定・取得する方法ですが、パラメータ名がキーとなっています．
たとえば、すべてのTrailsノードのRotateを変更したい場合、次のようになります．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">tools </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> comp</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetToolList</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#66d9ef">false</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Trails"</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">v </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ipairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">tools</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    v</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Rotate </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコ��ードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>アニメーションさせたい場合や、特定のフレームに設定したい場合については割愛します．
では、パラメータ名を調べるにはどうすればいいかというと、インスペクタで確認したいパラメータのところにカーソルを合わせると、ステータスバーに表示されます．</p>
<p><img decoding="async" loading="lazy" alt="Parameter-Name" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIsAAABXCAYAAAA05barAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAs/SURBVHhe7d0LUFTXGQfw/+7ykMeCiwoCK7JgIi4PYXmjCbSSGPGtiUGZJBofxUkzSSaTGRuSaTMTG9uMWjt2Js2rMWkSaxO1wZKkE60TG14iEFd8AIKhKAuR5SXCArv03t0DLmTBS4F9yPebuXrPvYe955z99pxzL3cvIm9vWb+PzyxY24wZPmhu1rKU9SgUc1Fb+wNLWY+t6juRxxUD/WzVuvR6PVuzrr6+PrZmXbaq70QeV9zfP7WCpaenl61ZFwXLONjqE97To2Nr1mWr+k7kccUGw9QKlu5uCpb/lw17Ftt0yzpdD1uzLlvVdyKPa7MJrq2C1GAwsDXrslV9J/K4XLAQIozY1XUaWyVkdCI3Nzfb9I/E4YgUivspWIggNGchglGwEMEoWIhgFCxEMAoWIpgoMDCo32Dog8Ggt9lVRuIYxL293dDr+yhQyF2JwiOi+hXzwiD18oZIJGKbCfkpcWRMAiQSCdrbWtF5q8Nmv2gj9k/c3XUbem6+IhaLjPMWPk2IJcabn8QiMTcEmRbqWchIxE5OEmOvMrA4OTmxXYQMJXad5sbNWZy5XkVi/J9PE2KJ+HxpEXS6bkxzc+MCZRqdEZERiXx9fekCCxFE7O7uyc1T+GGIehQyOlFYWGS/RGI6EyJkNHSnHBGMuhMiGAULEYyChQhGwUIEo2AhglGwEMHGferM39bQ0nLT+NwTR7vbjr8Q6eLiCplsJsRiCds6uqlWX3PjDpbm5kbwv7n28PDgCuBYHRV/O0ZnZ6fxsRQzZvixraObavU1N+7a8p8wR2w4Hl9mvuxjeRrUVKuvuXHXmO+KHbHhBvBlH8twMtXqa85xa02szi6CRZqxG3llFahQc0vBIWwPYzuGEZrPXkgz9uLbqkIceJhtGEaacRCF18z3hyHrrX+jokINdUUFCg5t57ZYIkXG7jyUcXlGzzex7CBY1uDN15egJicJ4ZHhWH9Yimf37kIw23uH0Hz2Ydbqg/hqz0L0NLMNw0kz8EZOKFoqWZoTvGsvXvY/gfXhkYhM2oTj05/H/hwLYbDmTby+pAY5SeGIDF+Pw9JnsXfX5LYEfyZl+2DZsALJbSfxfl6HMXn5wGEUy1ORNbzuQvPZhWBs2ngfCndtxJeNbNMQXM/wRg7CT7+Gr26xTZzVCeG4cmovLvOJju/xu48LEJD+BFTGvXdsWJGMtpPvw9QUl3HgcDHkqVmT+sHh5zq2DxZ/H3i3NKGUJYFqNGoDoEhgyQFC89mFaziQuRQv5sUgyMIZqjTjDeSE5mFnTiHbMqAbt9vZKq+1E11unpjJkgP8fbzR0nSnJVDdCG2AApPZFPx3y+xizqL57yW2xitFU4s3fPxZ0ozQfHZNugH7XwtF3gu7TT2ImaKqJigXbeD6Hd4srF4Vx/1riQZDm6IJLd4+mOymsItgmT1nAVvjqeAra4O2gSXNCM1nv6TYsP8lBB5/AbuHRwqn8PU9+DLgVyisKEdp6WdY11mJH/V9+OmTe2djaFP4QtamxeQ2Rb8dBEuDFm0yX7NxeR78fLRorGbJAULz2bVNWB7nDP/HDqO8vNy47IichaV7y/Gv36Zx85Q85GTEIDw8GipVKn7dPhsu6jM4zX56QIO2DTJfs5nMPD/4aBu5gXny6PUGOwiWIydQ4L0ET2eYOt+w5zKRoM1HLj8kB2/BvkOvwrhrtHwO4894Kjoa0WbL2+of8fWL0Xj45aEhIV34IvY9Dnz+h+PGdPCWfTj0aoZxiDpyogDeS542tQt30vxcZgK0+blm87mJx/+qwA6GoeN46ZWTCNldaLx+8nlmD9coe2Cc+kUnIm1xKhLvu0u+e0Xa73FSzfU4ajXy/xSPouefHByuohPTsDg1EaameAmvnAzB7kL+OsvnyOw5hFf3TG5L8Fd9x/2LxBs3fsDs2bNZyjFpNBoEBMxlqdFNtfqas4sJLnEMFCxEsHEHC38Z2JEf08GXfSzfxpxq9TU37mDh77zib6hxxAbky8yXna+DUFOtvubotsox3mZIt1USIgBNcIlgFCxEMAoWIhgFCxGMgoUIRn8jkQhGp85EMBqGiGAULEQwChYiGAULEYyChQhGwUIEu8upcxQefWER/Lp6oL+uRoVXJML5O8pFznB1AXp0veB/uKPiBD4+Y/F7miOQwF3mDn1LB3QIQPrWdODrD/FNPds9Aq+YVch6UIzCA8dRxrYNxb/WGoS56NDXL4ELV8b2hjKcOnYWdX0sizVFLkP2ogBIXNzQeOYgPrNcaIchkclm/IatW+AHZbIzzh/8FCcqr6NOXYaSEm7ReCIi6Cby3jmGU1xaXdfJ8gsVjpU7UiC9UoH6bilCVCHA1e9RY/7VzSEk8IldjY2x09Bp0KOp5DI0bM9Q/GvJcTPvAxw5dQ5F567CWfkQUvwaUFZj+o60VTVVG9urb04CfFqKcdFyoR2GjYahCzj6xyMoaGXJu/JD9HwDCv/2HRrG0kP0teJKfSs8vXzYhlEo0pGZHsASdzGWvPcQAT2LDC2Fwz7JXsFQzeM6g7JrGOgM5OlPYnlQH+QPrsXSB5SYrjmPGtkiZG1YisXxMYiPj8UCryZcrG2HwTi8JcPV+LrmPYsUESsex/ol8YiLj0eiKgD6q5Vo6O5ArfoKNDruuKkWyjNoaC/l5K7A4tQwdF/8Fpcae7lyz0P6ujVYlqpCXEI8ooLFaK68gbbAZGQuVcLPLxQxqhjMd7vB9ZYSRK58jCtLAuLiVIjny1JVCY2vpbxizE9fhbUPJyOBq2d8hC+6a6rRxJ7G5a+8N3qWCQsWr5CFSFTKUJP7CY6eKkdNG7fx1k1cPV+MgiJu6CrvQsiyKLgW869l/rpmb7BXClbOb8Th93PxXck5nL1wDdpOPfSmQ3BGKM8g/rWiEKaMgiouHklJgeg4fQz/vNDBBag7Etaug7zu7/jwaAGKz6rROudnWL6gG2Vny3HeIEfE7dN458i3bFjVoa2+CiUFxSguKUWdZzzSgppRVn4JF4bl9UhYhRXe5fjok5Mo4vJWusdiXbQE5y42cse9d4JlQoehrppzyNfceWu9QmOxPHMztu3YiuzNyQhwZjtGoqlGpUGJzKdWIj06EO76Hu4tG6tbuJz7Ht56668obPCA1FsP08gVArmfBpXFrSzdg9qKOuhm+cPiV8acfBHx89V4YttmZGdvxRqlJ9vxU/PkvnCbm4otXD4+76YoT+hcPUd4AoLjmtBg6e3pZmscj1hkPBKIhtyP8O7b3Jv3bgma2K4R9dXjzKd/waFj3+PmzERkbX8Uib5s35jdRnFRFbxUD0A5+DdCneAs8MZ2RfoKxItK8cm7H3CB9x7yqrrYHstazx815htcPs6f5KcaWN/kTXCnucKF6xc62009jVdMCIS+77r2OpR/8w/8p16GOYFs40jksViZvgBeLDlEbT7KtHMRl8w/DqcGtddlUCyczoUMT4KgBUFw/bFhcEjznD6T7QPcXJzR23XL1LM5yRE2Z2jPYp63ur4JsvtVUAwGogvc3cd+97y9m7xgaS5H/iU3pPxim7FrXhd4HVUjPV9tgH8KNu7YYsyfnb0ZizwrUKxm+0bgEaBAyP1zYfncxNS7uC1MQoTTbZTlfo0bc9di+07u9XduwSMzq3Ei74ppWKq8hKrpKdz2rdi4eBYuFpSgLXQFnuHLsjkJupo6cFNkk2F5O4u/wBfVMjy0bQd2Zm/DM89kYZnSYvg6NAEX5UJwdf9IF8GIEDGP/hKhVx3/opyAnsUfKfyna6WSpYlg/BVcru1S7pFLMnSnHBFs8uYs5J5DwUIEo2AhglGwEMFEaWlpNMElgojkcjkFCxEA+B9jB5En3izyuwAAAABJRU5ErkJggg==" width="139" height="87" class="img_ev3q"></p>
<p>では、本題に入ります．ボタンはどうなのかというと、たとえば Trails の Restart にカーソルを合わせると <code>Trails1.Restart</code> のように表示されます．
実は、この <code>Restart</code> に <code>1</code> を代入するとボタンを押したことになります．
試してみましょう．Trailsノードではわかりづらいので、ここでは <code>pEmitter</code>ノードを作成して使います．このノードには <code>Reseed</code> ボタンがあって、押すと <code>Random Seed</code>の値が変わります．
次のスクリプトを実行してみます．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">tools </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> comp</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetToolList</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#66d9ef">false</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"pEmitter"</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">v </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ipairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">tools</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    v</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Randomize </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>Reseed</code> ではなく、<code>Randomize</code> であることに注意しましょう．パラメータ名は必ずしもUIで表示されている名前と同じというわけではありません．
このスクリプトを実行するたびに、<code>Random Seed</code>の値が変わっていれば問題ありません．</p>
<p>あとは、同様にTrailsノードのボタンを押す処理を作るだけです．とてもシンプルです．</p>
<div class="language-lua codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-lua codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">tools </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> comp</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token function" style="color:#e6db74">GetToolList</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#66d9ef">false</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Trails"</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain">v </span><span class="token keyword" style="color:#66d9ef">in</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ipairs</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">tools</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    v</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Restart </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    v</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Preroll </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">end</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>以上です．スクリプトを使えば、生産性が劇的に上がるので、少しでも参考になれば幸いです．</p>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="DaVinci Resolve" term="DaVinci Resolve"/>
        <category label="Lua" term="Lua"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Visual Studio Codeでのターミナル操作]]></title>
        <id>https://mebiusbox.github.io/blog/2024/08/30/vscode-terminal</id>
        <link href="https://mebiusbox.github.io/blog/2024/08/30/vscode-terminal"/>
        <updated>2024-08-30T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Visual Studio Codeでターミナルを操作する便利な設定]]></summary>
        <content type="html"><![CDATA[<p>WindowsのVisual Studio Codeでターミナルを快適に操作させるためのいくつかの設定を紹介します．</p>
<p>まず、「Ctrl+@」でターミナル画面の表示を切り替えることができます．通常だとターミナルはパネルに含まれており、画面下部に表示されます．
ターミナル上で再度「Ctrl+@」を押せば、その前のビューに戻ります．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ターミナルの新規作成">ターミナルの新規作成<a class="hash-link" aria-label="ターミナルの新規作成 への直接リンク" title="ターミナルの新規作成 への直接リンク" href="https://mebiusbox.github.io/blog/2024/08/30/vscode-terminal#%E3%82%BF%E3%83%BC%E3%83%9F%E3%83%8A%E3%83%AB%E3%81%AE%E6%96%B0%E8%A6%8F%E4%BD%9C%E6%88%90">​</a></h2>
<p>「Ctrl+Shift+@」でターミナルを新規に作成できます．</p>
<p>私の場合、ターミナルはエディター内でも作業したいことがあります．これは、パネルにあるターミナル画面とは別のものです．サーバー起動などの用途に少なくとも2つのターミナルが欲しいので、使い分けたいのです．新規に作成されるターミナルの場所は設定で変更できます．設定画面で「Terminal &gt; integrated: Default Location」を「Editor」に設定します．設定ファイルを直接編集する場合、<code>"terminal.integrated.defaultLocation": "editor"</code> とします．</p>
<p>また、コマンドパレットから「Terminal: Create New Terminal in Editor Area」としてもエディター内に新規ターミナルを作れます．他にも「Terminal: Create New Terminal in Editor Area to the Side」であれば、隣のグループに新規ターミナルを作れます．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ターミナルとエディタを切り替える">ターミナルとエディタを切り替える<a class="hash-link" aria-label="ターミナルとエディタを切り替える への直接リンク" title="ターミナルとエディタを切り替える への直接リンク" href="https://mebiusbox.github.io/blog/2024/08/30/vscode-terminal#%E3%82%BF%E3%83%BC%E3%83%9F%E3%83%8A%E3%83%AB%E3%81%A8%E3%82%A8%E3%83%87%E3%82%A3%E3%82%BF%E3%82%92%E5%88%87%E3%82%8A%E6%9B%BF%E3%81%88%E3%82%8B">​</a></h2>
<p>エディター内に作成したターミナルと現在開いているエディターを切り替える方法がいくつかあります．</p>
<p>まずは「Ctrl+Tab」を使った方法です．このショートカットは「View: Quick Open Previous Recently Used Editor in Group」が割り当てられており、前回使っていたエディター画面を開きます．現在編集中のファイルと、ターミナルを切り替えていれば、この機能で手軽に切り替えられます．</p>
<p>別の方法として、「Terminal: Focus Terminal」を使うやり方があります．これはどのエディター画面からも一発でターミナル画面に移動できるコマンドで、標準だとショートカットが割り当てられていないので、手動で割り当てる必要があります．これでターミナル画面に移動できるのですが、前のエディターに戻ることができません．そこで、ターミナル画面をタブの一番最初に置くことを前提とすれば「View: Open Next Editor in Group」を使って、相互に切り替えられます．
たとえば、<code>F1</code>キーでターミナルと切り替えたい場合、「Terminal: Focus Terminal」を<code>F1</code>キーに設定し、Whenを<code>editorTextFocus</code>に設定します．そして、「View: Open Next Editor in Group」も<code>F1</code>キーに設定し、Whenを<code>terminalFocus</code>とします．これで、<code>F1</code>キーで相互に移動できます．</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>備考</div><div class="admonitionContent_BuS1"><p>ピン機能を使うと、一番左側に固定できます．タブを右クリックして「Pin」を選んだり、ショートカットキーを押すことでもできます．</p></div></div>
<p>ターミナルがタブの一番最初にするといいましたが、具体的にはターミナルがタブの左に、編集中のエディタータブがその右隣にあれば問題ありません．
以下は直接キー設定ファイルを編集する場合です：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token property" style="color:#f92672">"key"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"f1"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token property" style="color:#f92672">"command"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"workbench.action.terminal.focus"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token property" style="color:#f92672">"when"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"editorTextFocus"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token property" style="color:#f92672">"key"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"f1"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token property" style="color:#f92672">"command"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"workbench.action.nextEditorInGroup"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token property" style="color:#f92672">"when"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"terminalFocus"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>エディター内でターミナル操作とパネルでのターミナル（<code>Ctrl+@</code>）を使った方法は別々なので、2つのターミナルを使い分けることができます．</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>備考</div><div class="admonitionContent_BuS1"><p>この方法だと、ターミナルをフォーカスするときに、パネル内のターミナルが優先されることがあります．
エディター内のターミナルに確実に切り替えたい場合、ターミナルをタブの一番左において、「Terminal: Focus Terminal」ではなく、「View: Open First Editor in Group」を使います．</p></div></div>
<p>他には、エディターのセカンドグループにターミナルを置く方法もあります．
一種の仮想画面のような機能で、この方法はターミナルに限った方法ではありません．
エディターのグループは最大化できますので、これを使ってファーストグループとセカンドグループを互いに最大化で切り替えるやり方です．
ちょっとトリッキーですが、これをするためにはショートカットキーの設定ファイルを直接編集する必要があります．
<code>runCommands</code>を使うことで、複数のアクションを同時に行えます．たとえば、<code>F2</code>キーでこれを実行すると次のようになります．</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token property" style="color:#f92672">"key"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"f2"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token property" style="color:#f92672">"command"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"runCommands"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token property" style="color:#f92672">"args"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property" style="color:#f92672">"commands"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token string" style="color:#a6e22e">"workbench.action.toggleMaximizeEditorGroup"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token string" style="color:#a6e22e">"workbench.action.focusSecondEditorGroup"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token string" style="color:#a6e22e">"workbench.action.toggleMaximizeEditorGroup"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token property" style="color:#f92672">"when"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"activeEditorGroupIndex==1 &amp;&amp; (editorFocus || terminalFocus)"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token property" style="color:#f92672">"key"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"f2"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token property" style="color:#f92672">"command"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"runCommands"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token property" style="color:#f92672">"args"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token property" style="color:#f92672">"commands"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token string" style="color:#a6e22e">"workbench.action.toggleMaximizeEditorGroup"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token string" style="color:#a6e22e">"workbench.action.focusFirstEditorGroup"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token string" style="color:#a6e22e">"workbench.action.toggleMaximizeEditorGroup"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token property" style="color:#f92672">"when"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"activeEditorGroupIndex==2 &amp;&amp; (editorFocus || terminalFocus)"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>やっていることは単純で次のことをやっています</p>
<ol>
<li>現在のエディタグループの最大化を解除</li>
<li>別のエディタグループに切り替え</li>
<li>切り替えたエディタグループを最大化</li>
</ol>
<p>グループの状態が把握しづらいので、最大化を解除したり、両方のグループを表示できるようにすれば管理しやすいかもです．
たとえば、<code>Ctrl+F2</code>に <code>workbench.action.evenEditorWidths</code> を設定したりとか．これはエディターグループを2画面表示します．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="shortcut-menu-bar">Shortcut Menu Bar<a class="hash-link" aria-label="Shortcut Menu Bar への直接リンク" title="Shortcut Menu Bar への直接リンク" href="https://mebiusbox.github.io/blog/2024/08/30/vscode-terminal#shortcut-menu-bar">​</a></h2>
<p>最後に拡張機能「<a href="https://marketplace.visualstudio.com/items?itemName=jerrygoyal.shortcut-menu-bar" target="_blank" rel="noopener noreferrer">Shortcut Menu Bar</a>」を紹介します．
これはVisual Studio Codeのメニューバー（エディターの右上）にボタンを追加する拡張機能です．
この拡張機能でユーザーが自由に設定できるカスタムボタンを手軽に作成できます．これらのボタンにターミナルの新規作成や切り替えなどを割り当てると、マウス操作でも手軽に制御できます．詳しくは拡張機能のドキュメントを参照してください．</p>
<p>以上です．</p>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="vscode" term="vscode"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[WindowsでのPython環境について]]></title>
        <id>https://mebiusbox.github.io/blog/2024/08/27/python-on-windows</id>
        <link href="https://mebiusbox.github.io/blog/2024/08/27/python-on-windows"/>
        <updated>2024-08-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Anacondaから別の環境に移行できるのか]]></summary>
        <content type="html"><![CDATA[<p>WindowsでのPython環境はこれまでMiniconda(Anaconda)を利用してきました．個人的利用では正直なところ、とくに問題ありません．ただ、現在Minicondaを利用する理由がPythonとNodejsのバージョン管理にしか使っておらず、そろそろ別のに乗り換えるいい機会かなと思いました．そこで、いくつか試してみた結果を記録しておきます．</p>
<p>結論から言うと、やはりMinicondaが楽かなと思います．情報量も多いですし．ただ、最終的に py + winget + pip/uv + volta という環境になりました．
まずは他に試したものからまとめていきます．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pyenv--poetry">pyenv + poetry<a class="hash-link" aria-label="pyenv + poetry への直接リンク" title="pyenv + poetry への直接リンク" href="https://mebiusbox.github.io/blog/2024/08/27/python-on-windows#pyenv--poetry">​</a></h2>
<p>Windowsだと <a href="https://github.com/pyenv-win/pyenv-win" target="_blank" rel="noopener noreferrer">pyenv-win</a> を使います．インストールや初期設定など若干手間ではありますが、導入に関しては問題ありませんでした．ただ、pyenv経由でインストールしたpythonの動作が公式インストーラでのpythonや他のpythonバージョン管理での実行バイナリと挙動が違っていました．もちろん、それぞれ同じバージョンなのですが、ビルドはそれぞれ違います．pyenvでインストールしたバイナリだと結果がエラーになってしまう部分があり、こちらの環境で問題が発生しました．具体的には "-c" コマンドを空で実行したときに返ってくる結果が異なります．こちらのコードを調整すれば対応できますが、クローンしたプロジェクトで発生しており、ちょっと面倒なため、残念ながら不採用となりました．pyenvそのものはとくに問題なかったのですけどね．あと、poetryに関してもとくに問題ないと思います．しかし、uv があまりにも速かったのでそちらにしました．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rye">Rye<a class="hash-link" aria-label="Rye への直接リンク" title="Rye への直接リンク" href="https://mebiusbox.github.io/blog/2024/08/27/python-on-windows#rye">​</a></h2>
<p><a href="https://rye.astral.sh/" target="_blank" rel="noopener noreferrer">Rye</a> はPythonのバージョン、およびパッケージ、プロジェクトを管理できるツールです．これから新規にやっていくならありかなと思いますが、試してみて思ったのがすでにある環境への対応が難しいです．とくにpipコマンドが隠蔽されてしまうのが致命的で、環境の構築など簡単に実行できるスクリプトなどが用意されていることも多く、こういったスクリプトがまったく動かなくなります．ちなみに、pipコマンドが隠蔽されることは別に悪いことではなく、rye経由のパッケージ管理に集中できます．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="uv">uv<a class="hash-link" aria-label="uv への直接リンク" title="uv への直接リンク" href="https://mebiusbox.github.io/blog/2024/08/27/python-on-windows#uv">​</a></h2>
<p><a href="https://github.com/astral-sh/uv" target="_blank" rel="noopener noreferrer">uv</a> はパッケージとプロジェクト管理ツールです．Pythonのバージョン管理もあります．
とにかく仮想環境の構築が速いです．Ryeも標準でuvを使うようになっています．使い方も <code>uv pip ...</code> と pip に準拠した形になっているので移行しやすいです．
非常に魅力的なツールではありますが、まだまだ実験的な機能が多く、安定するには時間がかかるかもしれません．
また、pipでインストールすると問題なかったものが uv だと上手く動作しなかったことが1度だけありました．依存解決の仕方が違うようなのでそういったことが起こることがあるようです．ただ、それでも仮想環境の構築やパッケージのインストールが速いので、とりあえず uv で構築して、問題が起きたら pip にするようにしています．
ちょっと気になっているのは仮想環境のフォルダが <code>.venv</code> 固定ということです．個人的には <code>venv</code> にしたいんですよね．これを逆に利用して <code>venv</code> なら pip 、<code>.venv</code> なら uv で管理しているという見分けができるようにしています．</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>注記</div><div class="admonitionContent_BuS1"><p>uvは仮想環境を作成する<code>venv</code>コマンドで名前を指定できます．ですから、<code>venv</code>という名前で仮想環境を作れますが、これは <code>pip</code> コマンド用になります．uv の <code>sync</code> コマンドなどは <code>.venv</code> ディレクトリを参照します．<code>venv</code> というフォルダがあっても、仮想環境をアクティベートしている状態でも <code>.venv</code> ディレクトリがなければ作成します．環境変数 <code>VIRTUAL_ENV</code> を参照するなどの対応は議論はあるものの対応はされていないようです（<a href="https://github.com/astral-sh/uv/issues/5229" target="_blank" rel="noopener noreferrer">#5229</a>, <a href="https://github.com/astral-sh/uv/issues/6612" target="_blank" rel="noopener noreferrer">#6612</a>）．シンボリックリンクを作って対応するのもありなんですが、<code>venv</code>, <code>.venv</code> 両方存在するように見えてしまうので避けたいですね．（片方は隠しディレクトリになるのであまり気にならないかもしれませんが）</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="py">py<a class="hash-link" aria-label="py への直接リンク" title="py への直接リンク" href="https://mebiusbox.github.io/blog/2024/08/27/python-on-windows#py">​</a></h2>
<p>py はPythonランチャーのことで、公式インストーラを使うとインストールされます．py はインストールされているPythonのバイナリを実行時に指定できます．
なので、複数のバージョンをインストールして py でバージョンを切り替えて使うということになります．各バージョンについては winget を使うことで簡単にインストールできますので、py+winget でPythonのバージョン管理ができます．また、一部のWindowsアプリはPythonによるスクリプト実行ができるのですが、グローバルにインストールしていると設定が楽だったりします．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="py--winget--pip-uv">py + winget + pip (uv)<a class="hash-link" aria-label="py + winget + pip (uv) への直接リンク" title="py + winget + pip (uv) への直接リンク" href="https://mebiusbox.github.io/blog/2024/08/27/python-on-windows#py--winget--pip-uv">​</a></h2>
<p>ということで、最終的に py + winget で python のバージョン管理を、pip/uv でパッケージ管理をするようになりました．とりあえず、ローカルにある環境はほとんど Miniconda から移行できました．ちなみに基本的に pyproject.toml に依存関係をまとめて uv を使ったり、pip を使う場合は uv で pyproject.toml から requirements.txt を生成して使うという形になります．あと、パッケージの依存関係を調べるのに <code>uv pip tree</code> コマンドが使えるので便利です．また、poetry も使ってもいいかもしれません．それはもうちょっと試してみないとわからないです．</p>
<p>環境は移行したものの、Miniconda よりも良くなったというところはとくにないので、Miniconda(Anaconda)を使ってもいいと思います．py+winget の部分が Miniconda になるだけです．とりあえず、どちらでも好きな方で問題ないという認識です．</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>備考</div><div class="admonitionContent_BuS1"><p>後述するVoltaを採用することで，より柔軟性が増しました．
PythonとNodejsを別々に，そしてしっかりと管理できるようになったので，Miniconda(Anaconda) よりかは若干やりやすくなった感じがします．</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="volta-2024-09-04追記">Volta (2024-09-04追記)<a class="hash-link" aria-label="Volta (2024-09-04追記) への直接リンク" title="Volta (2024-09-04追記) への直接リンク" href="https://mebiusbox.github.io/blog/2024/08/27/python-on-windows#volta-2024-09-04%E8%BF%BD%E8%A8%98">​</a></h2>
<p>node.jsの管理に <a href="https://github.com/coreybutler/nvm-windows" target="_blank" rel="noopener noreferrer">NVM for Windows</a> を使っていましたが，最近 <a href="https://volta.sh/" target="_blank" rel="noopener noreferrer">Volta</a> に変えました．
Voltaはプロジェクトごとに使用するNodeのバージョンを自動で切り替えてくれます．NVMではグローバルで使用するNodeのバージョンを手動で切り替えなければなりません．
また、NVMはインストーラをダウンロードして実行しなければいけませんが，VoltaはWinGetでインストールできます．現時点では良いところしかありません．</p>
<hr>
<p>以上です．</p>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="windows" term="windows"/>
        <category label="python" term="python"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[zoxideのデータベースを整理する]]></title>
        <id>https://mebiusbox.github.io/blog/2024/04/03/prune-zoxide-database</id>
        <link href="https://mebiusbox.github.io/blog/2024/04/03/prune-zoxide-database"/>
        <updated>2024-04-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[zoxideのデータベースからスコアを参照して整理するPowerShellスクリプト]]></summary>
        <content type="html"><![CDATA[<p>zoxideのデータベースを参照してスコアの低いエントリを削除するpowershellスクリプトの紹介です．</p>
<p><a href="https://github.com/ajeetdsouza/zoxide" target="_blank" rel="noopener noreferrer">zoxide</a>はターミナルで使うcdコマンドの改良版です．cdコマンドで移動したディレクトリを履歴としてデータベースに保存し、あとは履歴を参照して移動したことがある場所に行き来するときに便利です．その際に、短い名前で履歴から一致した場所に移動できるので、よくディレクトリを切り替えたりするときに便利です．</p>
<p>履歴はzoxideのデータベースに格納されます．私の環境(Windows11)では以下の場所にありました．</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">C:\Users\&lt;username&gt;\AppData\Local\zoxide\db.zo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>このファイルを削除すれば、データベースは初期化されます．
しかし、データベースの初期化ではなく、低いスコアのエントリを削除するためにpowershellスクリプトを作成しました．
これは、スコアが特定の値以下であるものを削除します．また、ついでに存在しないディレクトリであれば、それも削除します．
一応、zoxideは<a href="https://github.com/ajeetdsouza/zoxide/wiki/Algorithm#pruning" target="_blank" rel="noopener noreferrer">一定期間(90日)</a>で似たようなことをしてくれるようです．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="エントリの閲覧">エントリの閲覧<a class="hash-link" aria-label="エントリの閲覧 への直接リンク" title="エントリの閲覧 への直接リンク" href="https://mebiusbox.github.io/blog/2024/04/03/prune-zoxide-database#%E3%82%A8%E3%83%B3%E3%83%88%E3%83%AA%E3%81%AE%E9%96%B2%E8%A6%A7">​</a></h2>
<p>データベースの内容を確認するには<code>zoxide query</code>コマンドを使います．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">zoxide query </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[OPTIONS]</span><span class="token plain"> </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[KEYWORDS]</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token punctuation" style="color:#f8f8f2">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>現在、有効なエントリを見るには <code>--list</code> または <code>-l</code> を指定します．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">zoxide query </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">list</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>無効なディレクトリも確認したい場合は、<code>--all</code> または <code>-a</code> を合わせて使います．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">zoxide query </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">list </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">all</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>また、スコアも表示したい場合は <code>--score</code> または <code>-s</code> を指定します．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">zoxide query </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">list </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">score</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">zoxide query </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">list </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">all </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">score</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">zoxide query </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">las</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="powershellスクリプト">powershellスクリプト<a class="hash-link" aria-label="powershellスクリプト への直接リンク" title="powershellスクリプト への直接リンク" href="https://mebiusbox.github.io/blog/2024/04/03/prune-zoxide-database#powershell%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88">​</a></h2>
<p>本題のスクリプトです．やっていることはエントリをスコア付きでリストアップし、各エントリごとにディレクトリの存在チェック、そしてスコアをチェックして、削除対象であれば、エントリをデータベースから削除します．削除するには<code>zoxide remove</code>コマンドを使います．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> Prune-ZoxideDB</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[double]</span><span class="token variable" style="color:#f8f8f2">$threshold</span><span class="token plain">=1</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">0</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[Console]</span><span class="token plain">::OutputEncoding = </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[Text.UTF8Encoding]</span><span class="token plain">::UTF8</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#e6db74">Write-Host</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">"Score threshold = {0}"</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">f </span><span class="token variable" style="color:#f8f8f2">$threshold</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$total</span><span class="token plain"> = 0</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token variable" style="color:#f8f8f2">$count</span><span class="token plain"> = 0</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    zoxide query </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">list </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">all </span><span class="token operator" style="color:#66d9ef">--</span><span class="token plain">score </span><span class="token punctuation" style="color:#f8f8f2">|</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">ForEach-Object</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token variable" style="color:#f8f8f2">$total</span><span class="token operator" style="color:#66d9ef">++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$_</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-match</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'([0-9]+\.[0-9]+)\s+(.+)'</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token variable" style="color:#f8f8f2">$score</span><span class="token plain"> = </span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[double]</span><span class="token variable" style="color:#f8f8f2">$Matches</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">1</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token variable" style="color:#f8f8f2">$path</span><span class="token plain"> = </span><span class="token variable" style="color:#f8f8f2">$Matches</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">2</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token operator" style="color:#66d9ef">-Not</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#e6db74">Test-Path</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">LiteralPath </span><span class="token variable" style="color:#f8f8f2">$path</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                zoxide remove </span><span class="token variable" style="color:#f8f8f2">$path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token function" style="color:#e6db74">Write-Host</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">"Not Exist (removed). [{0}]"</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">f </span><span class="token variable" style="color:#f8f8f2">$path</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token variable" style="color:#f8f8f2">$count</span><span class="token operator" style="color:#66d9ef">++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token keyword" style="color:#66d9ef">elseif</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token variable" style="color:#f8f8f2">$score</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-lt</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$threshold</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                zoxide remove </span><span class="token variable" style="color:#f8f8f2">$path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token function" style="color:#e6db74">Write-Host</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">"{0}, {1} (removed)"</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">f </span><span class="token variable" style="color:#f8f8f2">$score</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$path</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">                </span><span class="token variable" style="color:#f8f8f2">$count</span><span class="token operator" style="color:#66d9ef">++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">            </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#e6db74">Write-Host</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token string" style="color:#a6e22e">"total={0} removed={1}"</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">f </span><span class="token variable" style="color:#f8f8f2">$total</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token variable" style="color:#f8f8f2">$count</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>標準でスコアは 1.0 未満を削除するようにしています．</li>
<li>コンソールに詳細（日本語含む）を出力するためにUTF8エンコーディングに変更しています．</li>
</ul>
<p>次のように使います．</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">Prune-ZoxideDB</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">Prune-ZoxideDB 0</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>以上です．</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>注記</div><div class="admonitionContent_BuS1"><p>PowerShellのcdコマンド(Set-Location)では名前の先頭に<code>[]</code>があると、ディレクトリ名として正しく認識できません．その場合、<code>-LiteralPath</code> を指定する必要があります．</p><ul>
<li><a href="https://github.com/PowerShell/PowerShell/issues/16476" target="_blank" rel="noopener noreferrer">https://github.com/PowerShell/PowerShell/issues/16476</a></li>
<li><a href="https://github.com/ajeetdsouza/zoxide/issues/312" target="_blank" rel="noopener noreferrer">https://github.com/ajeetdsouza/zoxide/issues/312</a></li>
</ul><p>例えば、次のように標準の cd エイリアスを無効にして、新しいcd関数を定義することができます．</p><div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token function" style="color:#e6db74">Test-Path</span><span class="token plain"> alias:cd</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#e6db74">Remove-Alias</span><span class="token plain"> cd</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> cd </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token namespace" style="color:rgb(178, 204, 214);opacity:0.7">[string]</span><span class="token variable" style="color:#f8f8f2">$Path</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#e6db74">Set-Location</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain">LiteralPath </span><span class="token variable" style="color:#f8f8f2">$Path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>powershellのエイリアスはパラメータを指定することが出来ないため、関数として定義します．この方法でも zoxide は有効になります．</p></div></div>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="zoxide" term="zoxide"/>
        <category label="powershell" term="powershell"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[gitui で Pending Other に Other が表示される]]></title>
        <id>https://mebiusbox.github.io/blog/2024/03/11/gitui-pending-other</id>
        <link href="https://mebiusbox.github.io/blog/2024/03/11/gitui-pending-other"/>
        <updated>2024-03-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[gitui で Pending Other に Other が表示されたので対応したこと]]></summary>
        <content type="html"><![CDATA[<p>ターミナルでのgit管理に<a href="https://github.com/extrawurst/gitui" target="_blank" rel="noopener noreferrer">gitui</a>を使っています．
細かい操作をUIで操作するときに便利です．
ところで、ローカルで作業中のリポジトリでgituiを実行すると画面に「Pending Other」が表示されていることに気づきました．何かが終わっていない、途中の状態というのは何となくわかるのですが、これだけでは詳しいことがわかりません．ここでは備忘録として対応したことを書いておきます．</p>
<p>具体的には次のような画面のように、「Pending Other」のウィンドウが表示され、内容は「Other」となっています．</p>
<p><img decoding="async" loading="lazy" alt="gitui" src="https://mebiusbox.github.io/assets/images/03-11-gitui-pending-other-240311-192012-b73f26e2f5ecffdc61c2402371f541ce.png" width="939" height="444" class="img_ev3q"></p>
<p>これに関する情報がほとんど見つけられなかったので、とりあえずgituiのソースコードを確認してみることにしました．
どうやらリポジトリのステートを表しているようです．</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">src/sync/state.rs</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">pub</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">enum</span><span class="token plain"> </span><span class="token type-definition class-name" style="color:#e6db74">RepoState</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">	</span><span class="token comment" style="color:#8292a2;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">	</span><span class="token class-name" style="color:#e6db74">Clean</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">	</span><span class="token comment" style="color:#8292a2;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">	</span><span class="token class-name" style="color:#e6db74">Merge</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">	</span><span class="token comment" style="color:#8292a2;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">	</span><span class="token class-name" style="color:#e6db74">Rebase</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">	</span><span class="token comment" style="color:#8292a2;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">	</span><span class="token class-name" style="color:#e6db74">Revert</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">	</span><span class="token comment" style="color:#8292a2;font-style:italic">///</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">	</span><span class="token class-name" style="color:#e6db74">Other</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>Clean</code>以外のステートのときに画面に表示されるようになっていました．
結局、まだ詳しいことはわからないので、<code>.git</code>ディレクトリの中を他のリポジトリのものと比較してみることにしました．
そうすると、「Pending Other」が表示されるリポジトリの<code>.git</code>ディレクトリの中に<code>rebase-apply</code>というディレクトリが存在していました．中身は空です．どうやら、Rebaseが中途半端な状態だったようです．といってもRebaseをした覚えがないので、何か間違った操作をしてRebaseしようとしたのかもしれません．ということで、この<code>rebace-apply</code>ディレクトリを削除することで「Pending Other」は表示されなくなりました．</p>
<p>以上です．</p>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="gitui" term="gitui"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Espanso の force_clipboard について]]></title>
        <id>https://mebiusbox.github.io/blog/2023/12/23/espanso-force-clipboard</id>
        <link href="https://mebiusbox.github.io/blog/2023/12/23/espanso-force-clipboard"/>
        <updated>2023-12-23T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Espanso で置換文字に改行が含まれる時の問題]]></summary>
        <content type="html"><![CDATA[<p><a href="https://espanso.org/" target="_blank" rel="noopener noreferrer">Espanso</a> というテキスト入力支援ソフトで置換文字が改行を含んでいる場合に起こる問題とその対応方法についてまとめました．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="espanso-とは">Espanso とは<a class="hash-link" aria-label="Espanso とは への直接リンク" title="Espanso とは への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/23/espanso-force-clipboard#espanso-%E3%81%A8%E3%81%AF">​</a></h2>
<p><a href="https://espanso.org/" target="_blank" rel="noopener noreferrer">Espanso</a> はテキスト入力支援ソフトです．WindowsやMacOSでも使えます．あらかじめトリガー文字と置換文字を指定しておくと、トリガー文字が入力されると同時に置換文字に置き換わります．Espanso では置換文字にクリップボードの内容やスクリプトの実行結果など様々な機能が利用できます．テキスト入力支援ソフトは他にも様々なものがあります．例えば、<a href="https://www.trankynam.com/atext/" target="_blank" rel="noopener noreferrer">aText</a> があります．また、<a href="https://sites.google.com/site/craftware/keyhac-ja" target="_blank" rel="noopener noreferrer">keyhac</a> を使って同様のことも出来るでしょう．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="改行を含んでいる場合の問題となるケース">改行を含んでいる場合の問題となるケース<a class="hash-link" aria-label="改行を含んでいる場合の問題となるケース への直接リンク" title="改行を含んでいる場合の問題となるケース への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/23/espanso-force-clipboard#%E6%94%B9%E8%A1%8C%E3%82%92%E5%90%AB%E3%82%93%E3%81%A7%E3%81%84%E3%82%8B%E5%A0%B4%E5%90%88%E3%81%AE%E5%95%8F%E9%A1%8C%E3%81%A8%E3%81%AA%E3%82%8B%E3%82%B1%E3%83%BC%E3%82%B9">​</a></h2>
<p>Espanso には文字を置換するときに2つのバックエンドを使い分けて処理します．<code>Inject</code>と<code>Clipboard</code>です．</p>
<p><code>Inject</code>はキー入力をシミュレートし、<code>Clipboard</code>はクリップボードを経由して置換します．このバックエンドは設定で切り替えることが出来ます．標準で <code>Auto</code> となっており、トリガー時に自動で切り替わります．</p>
<p>問題となるのは <code>Enterキー</code> が改行ではなくショートカットなどに割り当てられている場合です．その場合 <code>Inject</code> だと適切に処理されません．
ではどうするかというとバックエンドに<code>Clipboard</code>を指定すればいいことになります．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="バックエンドに-clipboard-を使う方法">バックエンドに Clipboard を使う方法<a class="hash-link" aria-label="バックエンドに Clipboard を使う方法 への直接リンク" title="バックエンドに Clipboard を使う方法 への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/23/espanso-force-clipboard#%E3%83%90%E3%83%83%E3%82%AF%E3%82%A8%E3%83%B3%E3%83%89%E3%81%AB-clipboard-%E3%82%92%E4%BD%BF%E3%81%86%E6%96%B9%E6%B3%95">​</a></h2>
<p>3つの方法があります．</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="すべてに-clipboard-バックエンドを使う">すべてに Clipboard バックエンドを使う<a class="hash-link" aria-label="すべてに Clipboard バックエンドを使う への直接リンク" title="すべてに Clipboard バックエンドを使う への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/23/espanso-force-clipboard#%E3%81%99%E3%81%B9%E3%81%A6%E3%81%AB-clipboard-%E3%83%90%E3%83%83%E3%82%AF%E3%82%A8%E3%83%B3%E3%83%89%E3%82%92%E4%BD%BF%E3%81%86">​</a></h3>
<p>設定ファイルで次のように設定します．</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">default.yml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token key atrule">backend</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> clipboard</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="clipboard_threshold-を設定する">clipboard_threshold を設定する<a class="hash-link" aria-label="clipboard_threshold を設定する への直接リンク" title="clipboard_threshold を設定する への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/23/espanso-force-clipboard#clipboard_threshold-%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B">​</a></h3>
<p>Clipboard バックエンドを使用する閾値を設定します．標準で <code>100</code> に設定されています．この閾値を超えると Clipboard バックエンドが利用されます．
これは <code>backend</code> が <code>Auto</code> のとき（標準）に機能します．</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">default.yml</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token key atrule">clipboard_threshold</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">20</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="force_clipboard-を設定す��る">force_clipboard を設定する<a class="hash-link" aria-label="force_clipboard を設定する への直接リンク" title="force_clipboard を設定する への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/23/espanso-force-clipboard#force_clipboard-%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B">​</a></h3>
<p>上記2つの方法はすべてのトリガーに適用されるのですが、 <code>force_clipboard</code> を使ってトリガーごとに Clipboardバックエンドを使うかどうか設定することができます．
次のように指定します．</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">trigger</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Hello"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">replace</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Hello, World"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">force_clipboard</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#ae81ff">true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>この <code>force_clipboard</code> は公式ドキュメントには見当たらず、ソースコードを見るか、Issues で見つけることができます．
もしかすると将来的に無くなるかもしれません．</p>
<p>また、<code>force_mode</code> でも指定することができます．これはドキュメントにも<a href="https://espanso.org/docs/matches/basics/#injection-mechanism" target="_blank" rel="noopener noreferrer">記載</a>があるのでこちらを使った方がいいかもしれません．<code>force_mode</code> で指定する場合は <code>clipboard</code> または <code>keys</code> を指定します．</p>
<div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token punctuation" style="color:#f8f8f2">-</span><span class="token plain"> </span><span class="token key atrule">trigger</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Hello"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">replace</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"Hello, World"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token key atrule">force_mode</span><span class="token punctuation" style="color:#f8f8f2">:</span><span class="token plain"> clipboard</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="さいごに">さいごに<a class="hash-link" aria-label="さいごに への直接リンク" title="さいごに への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/23/espanso-force-clipboard#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB">​</a></h2>
<p>結局、Clipboard バックエンドを常に使うようにしておくのもありですし、環境によって適切な設定をすればいいと思います．
以上です．</p>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="Espanso" term="Espanso"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Three.jsのカラー管理]]></title>
        <id>https://mebiusbox.github.io/blog/2023/12/16/threejs-colorspace</id>
        <link href="https://mebiusbox.github.io/blog/2023/12/16/threejs-colorspace"/>
        <updated>2023-12-16T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Three.jsの最新のカラー管理について]]></summary>
        <content type="html"><![CDATA[<p>Three.js のカラー管理は r152 から ColorSpace に変わりました．レンダリングにおいて結構大事なところなので調べてみました．</p>
<p>この記事は、前回 <a href="https://mebiusbox.github.io/blog/2023/12/15/bump-threejs-from-r116-to-r159">Three.js を r116 から r159 にアップデートしたこと</a> の続きです．
Three.js のバージョンを上げたときに <code>WebGLRenderer</code> の <code>.gammaInput</code>, <code>.gammaOutput</code> が無くなっていました．これはガンマ変換を制御するパラメータなのですが、最新版では <code>.outputColorSpace</code> となっており、 カラー空間を指定するように変更されています．ちなみに、その前は <code>.outputEncoding</code> という名前でカラーエンコーディングを指定するようになっていました．Three.js のカラー管理については公式のドキュメント<sup><a id="user-content-fnref-1-0e8825" data-footnote-ref="true" aria-describedby="footnote-label" href="https://mebiusbox.github.io/blog/2023/12/16/threejs-colorspace#user-content-fn-1-0e8825">1</a></sup>にもあります（今のところ日本語訳はありません）．この記事はそのドキュメントに基づいて書いています．また、three.js のソースコードは r159 のものを参考にしています．</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>備考</div><div class="admonitionContent_BuS1"><p>Three.js のドキュメントでは、前提知識として原色、白色点、伝達関数、カラーモデル、色域について説明があります．興味がある方は読んでみてください．
ここでは詳しく触れません．</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="リニアワークフロー">リニアワークフロー<a class="hash-link" aria-label="リニアワークフロー への直接リンク" title="リニアワークフロー への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/16/threejs-colorspace#%E3%83%AA%E3%83%8B%E3%82%A2%E3%83%AF%E3%83%BC%E3%82%AF%E3%83%95%E3%83%AD%E3%83%BC">​</a></h2>
<p>カラー管理はリニアワークフローのためにあります．リニアワークフローについては以下のサイトが参考になるでしょう：</p>
<ul>
<li><a href="http://compojigoku.blog.fc2.com/blog-entry-26.html" target="_blank" rel="noopener noreferrer">分かる！リニアワークフローのコンポジット</a></li>
<li><a href="https://tech.cygames.co.jp/archives/2296/" target="_blank" rel="noopener noreferrer">物理ベースレンダリング -リニアワークフロー編</a></li>
</ul>
<p>Three.jsでは主に sRGB 空間と Linear-sRGB 空間を扱います（他には <a href="https://k-tai.watch.impress.co.jp/docs/column/keyword/1288035.html" target="_blank" rel="noopener noreferrer">Display-P3</a> があります）．基本として内部では Linear-sRGB 空間で処理し、Canvas に描画するときに sRGB 空間に変換して描画します．（Working color space と Output color space 参照<sup><a id="user-content-fnref-1-0e8825-2" data-footnote-ref="true" aria-describedby="footnote-label" href="https://mebiusbox.github.io/blog/2023/12/16/threejs-colorspace#user-content-fn-1-0e8825">1</a></sup>）．重要なのは色を扱うときにカラー空間が影響してくるということです．特に THREE.Color（マテリアルやライト、シェーダ、頂点カラー）やテクスチャを扱っている場合に問題になってくることがあります．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="threejs-のカラー管理">Three.js のカラー管理<a class="hash-link" aria-label="Three.js のカラー管理 への直接リンク" title="Three.js のカラー管理 への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/16/threejs-colorspace#threejs-%E3%81%AE%E3%82%AB%E3%83%A9%E3%83%BC%E7%AE%A1%E7%90%86">​</a></h2>
<p>Three.js のカラー管理は標準で有効になっています．</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">three/src/math/ColorManagement.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#66d9ef">export</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> </span><span class="token maybe-class-name">ColorManagement</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#f92672">enabled</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token spread operator" style="color:#66d9ef">...</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>実際、以下のようにログを出力して確認すると <code>true</code> になっています．</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token console class-name" style="color:#e6db74">console</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#e6db74">log</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> </span><span class="token constant" style="color:#e6db74">THREE</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access maybe-class-name">ColorManagement</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">enabled</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> </span><span class="token comment" style="color:#8292a2;font-style:italic">// true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>先ほど述べたように Three.js の内部では Linear-sRGB で処理しています．また、レンダリングの出力では標準で sRGB となっています．</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> renderer </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">THREE</span><span class="token class-name punctuation" style="color:#f8f8f2">.</span><span class="token class-name" style="color:#e6db74">WebGLRenderer</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token console class-name" style="color:#e6db74">console</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#e6db74">log</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">renderer</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">outputColorSpace</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"> </span><span class="token comment" style="color:#8292a2;font-style:italic">// srgb</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>次に、カラースペースの定義は次のようになっています．</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">three/src/constants.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#8292a2;font-style:italic">// Color space string identifiers, matching CSS Color Module Level 4 and WebGPU names where available.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#66d9ef">export</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> </span><span class="token maybe-class-name">NoColorSpace</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">''</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#66d9ef">export</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> </span><span class="token maybe-class-name">SRGBColorSpace</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'srgb'</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#66d9ef">export</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> </span><span class="token maybe-class-name">LinearSRGBColorSpace</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'srgb-linear'</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#66d9ef">export</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> </span><span class="token maybe-class-name">DisplayP3ColorSpace</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'display-p3'</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#66d9ef">export</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> </span><span class="token maybe-class-name">LinearDisplayP3ColorSpace</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'display-p3-linear'</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="threecolor">THREE.Color<a class="hash-link" aria-label="THREE.Color への直接リンク" title="THREE.Color への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/16/threejs-colorspace#threecolor">​</a></h2>
<p>カラー管理が何を行っているのか、THREE.Color を例に見てみましょう．
以下は <code>setHex</code> メソッドの実装です．</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">setHex</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> </span><span class="token parameter">hex</span><span class="token parameter punctuation" style="color:#f8f8f2">,</span><span class="token parameter"> colorSpace </span><span class="token parameter operator" style="color:#66d9ef">=</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">SRGBColorSpace</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    hex </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:#e6db74">Math</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#e6db74">floor</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> hex </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">r</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> hex </span><span class="token operator" style="color:#66d9ef">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">16</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">255</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">/</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">255</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">g</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> hex </span><span class="token operator" style="color:#66d9ef">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">8</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">255</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">/</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">255</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">b</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> hex </span><span class="token operator" style="color:#66d9ef">&amp;</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">255</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">/</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">255</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token maybe-class-name">ColorManagement</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#e6db74">toWorkingColorSpace</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> colorSpace </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>ColorManagement.toWorkingColorSpace</code> でカラー空間を調整しています．Working color space とは Three.js 内部でのカラー空間のことを指しています．
Three.js 内部のカラー空間は標準で Linear-sRGB 空間でした．</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">three/src/math/ColorManagemnt.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#66d9ef">export</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> </span><span class="token maybe-class-name">ColorManagement</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token spread operator" style="color:#66d9ef">...</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#f92672">_workingColorSpace</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token maybe-class-name">LinearSRGBColorSpace</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">get</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">workingColorSpace</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">_workingColorSpace</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token spread operator" style="color:#66d9ef">...</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>sexHex</code> では、入力カラー空間 <code>colorSpace</code> から Three.js 内部でのカラー空間への変換が行われていることがわかります．
実際の相互変換処理は Linear-sRGB 空間を経由して行われています．sRGB も Display P3 も Linear-sRGB 空間に変換してから、別のカラー空間に変換しています．
もちろん、カラー管理が無効になっていたり、入力と出力が同じカラー空間であれば何もしません．</p>
<p><code>setHex</code> や <code>setStyle</code>, <code>setColorName</code> は入力カラー空間が <code>sRGB</code> になっているのに対して、<code>setRGB</code> や <code>setScalar</code>, <code>setHSL</code> は Working color space になっていることに注意が必要です．</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">three/src/math/Color.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">setRGB</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> </span><span class="token parameter">r</span><span class="token parameter punctuation" style="color:#f8f8f2">,</span><span class="token parameter"> g</span><span class="token parameter punctuation" style="color:#f8f8f2">,</span><span class="token parameter"> b</span><span class="token parameter punctuation" style="color:#f8f8f2">,</span><span class="token parameter"> colorSpace </span><span class="token parameter operator" style="color:#66d9ef">=</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">ColorManagement</span><span class="token parameter punctuation" style="color:#f8f8f2">.</span><span class="token parameter property-access">workingColorSpace</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">r</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> r</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">g</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> g</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">b</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> b</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token maybe-class-name">ColorManagement</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#e6db74">toWorkingColorSpace</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> colorSpace </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>THREE.Color には sRGB 空間と Linear-sRGB 空間への変換メソッドが用意されています．</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">three/src/math/Color.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#e6db74">copySRGBToLinear</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> </span><span class="token parameter">color</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">r</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#e6db74">SRGBToLinear</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> color</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">r</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">g</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#e6db74">SRGBToLinear</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> color</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">g</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">b</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#e6db74">SRGBToLinear</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> color</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">b</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#e6db74">copyLinearToSRGB</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> </span><span class="token parameter">color</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">r</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#e6db74">LinearToSRGB</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> color</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">r</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">g</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#e6db74">LinearToSRGB</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> color</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">g</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">b</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#e6db74">LinearToSRGB</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> color</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">b</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#e6db74">convertSRGBToLinear</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#e6db74">copySRGBToLinear</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#e6db74">convertLinearToSRGB</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#e6db74">copyLinearToSRGB</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">this</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>LinearToSRGB</code> と <code>SRGBToLinear</code> は次のようになっています．</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#66d9ef">export</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#e6db74">SRGBToLinear</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> </span><span class="token parameter">c</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> c </span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0.04045</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">?</span><span class="token plain"> c </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0.0773993808</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:#e6db74">Math</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#e6db74">pow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> c </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0.9478672986</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">+</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0.0521327014</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">2.4</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#66d9ef">export</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#e6db74">LinearToSRGB</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> </span><span class="token parameter">c</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#66d9ef">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> c </span><span class="token operator" style="color:#66d9ef">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0.0031308</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">?</span><span class="token plain"> c </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">12.92</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">1.055</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:#e6db74">Math</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#e6db74">pow</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> c</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0.41666</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">-</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0.055</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>set系のメソッドを見てきましたが、get系メソッドでも同様の変換処理が行われています．
ちなみに、このカラー管理を有効にすることは推奨となっています．
これからわかるように例えば <code>#123456</code> の値を <code>setHex</code> で設定したものと、<code>#123456</code> をRGBに変換して 255 で割った値をカラー空間を適切に設定せずにそのまま setRGB で設定すると結果が異なります．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="マテリアルやライトは">マテリアルやライトは？<a class="hash-link" aria-label="マテリアルやライトは？ への直接リンク" title="マテリアルやライトは？ への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/16/threejs-colorspace#%E3%83%9E%E3%83%86%E3%83%AA%E3%82%A2%E3%83%AB%E3%82%84%E3%83%A9%E3%82%A4%E3%83%88%E3%81%AF">​</a></h2>
<p>これらは Working color space (標準では Linear-sRGB) での値と見なされます．
<code>BufferAttributes</code>での頂点カラーも同様です．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="テクスチャ">テクスチャ<a class="hash-link" aria-label="テクスチャ への直接リンク" title="テクスチャ への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/16/threejs-colorspace#%E3%83%86%E3%82%AF%E3%82%B9%E3%83%81%E3%83%A3">​</a></h2>
<p>一番注意しなければならないのがテクスチャでしょう．
テクスチャがどのカラー空間なのかは自動で判別することはできないので、データ製作者および開発者側が適切なカラー空間を設定する必要があります．</p>
<p>テクスチャのカラー空間は <code>.colorSpace</code> プロパティで設定します．標準では <code>NoColorSpace</code> となっています．つまり、何も変換しません．</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">three/src/textures/Texture.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">class</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">Texture</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">extends</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">EventDispatcher</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#e6db74">constructor</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> </span><span class="token parameter spread operator" style="color:#66d9ef">...</span><span class="token parameter punctuation" style="color:#f8f8f2">,</span><span class="token parameter"> colorSpace </span><span class="token parameter operator" style="color:#66d9ef">=</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">NoColorSpace</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token spread operator" style="color:#66d9ef">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>例えば、カラーテクスチャ (Diffuse) を読み込んでテクスチャに設定する場合、sRGB 空間のデータならばカラー空間を設定します．</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> textureLoader </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">THREE</span><span class="token class-name punctuation" style="color:#f8f8f2">.</span><span class="token class-name" style="color:#e6db74">TextureLoader</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">textureLoader</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#e6db74">load</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'textures/diffuse.jpg'</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> </span><span class="token parameter">map</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    map</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">colorSpace</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token constant" style="color:#e6db74">THREE</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access maybe-class-name">SRGBColorSpace</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>テクスチャに設定した ColorSpace はどのような処理を行っているのでしょうか．<code>three/src/renderers/webgl/WebGLTextures.js</code> を見てみると、WebGL のバージョンによって挙動が異なっているようです．WebGL1では場合によってCPU側で変換しているようです．WebGL2ではテクスチャのバッファーフォーマットで対応しているようです．</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="レンダーテクスチャ">レンダーテクスチャ<a class="hash-link" aria-label="レンダーテクスチャ への直接リンク" title="レンダーテクスチャ への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/16/threejs-colorspace#%E3%83%AC%E3%83%B3%E3%83%80%E3%83%BC%E3%83%86%E3%82%AF%E3%82%B9%E3%83%81%E3%83%A3">​</a></h3>
<p>他にテクスチャを使っているところはレンダーターゲットのフレームバッファテクスチャです．
こちらも標準で <code>NoColorSpace</code> となっています．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="出力カラー空間">出力カラー空間<a class="hash-link" aria-label="出力カラー空間 への直接リンク" title="出力カラー空間 への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/16/threejs-colorspace#%E5%87%BA%E5%8A%9B%E3%82%AB%E3%83%A9%E3%83%BC%E7%A9%BA%E9%96%93">​</a></h2>
<p><code>WebGLRenderer.outputColorSpace</code> で出力カラー空間を設定できることは述べました．
この値はどのように使われるのでしょうか？</p>
<p>マテリアルを使って描画するときに内部ではシェーダを生成していますが、そのときに使われています．
シェーダのお話になりますが、内部で <code>linearToOutputTexel</code> という関数を定義し、ピクセルシェーダの出力時に変換を行います．
MeshBasicMaterial や MeshStandardMaterial は自動で処理されますが、ShaderMaterial や RawShaderMaterial では自動で行ってくれません．
この場合、適切に処理する必要があります．</p>
<p>ShaderMaterial の場合は対応が簡単で、シェーダコードの中に <code>#include &lt;colorspace_fragment&gt;</code> を入れれば処理するようになります．
例えば次のようになります．</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">gl_FragColor = vec4( outputColor, outputAlpha );</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">#include &lt;colorspace_fragment&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>これは <code>gl_FragColor</code> に出力した後に入れます．ちなみに <code>colorspace_fragment</code> シェーダチャンクの中身は次のようになっています．</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">gl_FragColor = linearToOutputTexel( gl_FragColor );</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>RawShaderMaterial の場合は自分で実装する必要があります．
ちょっと面倒なので、 RawShaderMaterial は Working color space で処理して、最終的な出力などには ShaderMaterial などを使った方が楽な気がします．
ポストプロセスなど、WebGLRenderTarget に描画して色々やっている場合、特に何もしてなければ <code>NoColorSpace</code> なので今までと処理は変わりません．
レンダーターゲットが null のときに RawShaderMaterial を使っている場合、対応しないと <code>WebGLRenderer.outputColorSpace</code> は効果がありません．</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>備考</div><div class="admonitionContent_BuS1"><p>Working color space は自由に書き換えることができるので、何か問題が起きたときに確認した方がいいかもしれません．</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token constant" style="color:#e6db74">THREE</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access maybe-class-name">ColorManagement</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">workingColorSpace</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token constant" style="color:#e6db74">THREE</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access maybe-class-name">LinearDisplayP3ColorSpace</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="さいごに">さいごに<a class="hash-link" aria-label="さいごに への直接リンク" title="さいごに への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/16/threejs-colorspace#%E3%81%95%E3%81%84%E3%81%94%E3%81%AB">​</a></h2>
<p>Three.js のカラー管理について調べたことをまとめました．
カラー空間が関係するメソッドには引数にカラー空間があったり、GLTFLoader などローダーが適切にテクスチャなどのカラー空間を設定する場合もあります．
何か勝手にやられると困るから全部自分でやってやるという場合には ColorManagement を無効にするのもありかもしれません．
今後、大きく変更があるとは思えないですが重要な部分ですので、レンダリングしたときに色がおかしいなと思ったらカラー空間を見直してみるのもありでしょう．</p>
<p>何か抜けがあったり間違っているところがあるかもしれません．その場合は、ご連絡いただけると幸いです．
以上です．</p>
<hr>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 class="anchor anchorWithStickyNavbar_LWe7 sr-only" id="footnote-label">Footnotes<a class="hash-link" aria-label="Footnotes への直接リンク" title="Footnotes への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/16/threejs-colorspace#footnote-label">​</a></h2>
<ol>
<li id="user-content-fn-1-0e8825">
<p><a href="https://threejs.org/docs/index.html#manual/en/introduction/Color-management" target="_blank" rel="noopener noreferrer">Color Management</a> <a data-footnote-backref="" aria-label="Back to reference 1" class="data-footnote-backref" href="https://mebiusbox.github.io/blog/2023/12/16/threejs-colorspace#user-content-fnref-1-0e8825">↩</a> <a data-footnote-backref="" aria-label="Back to reference 1-2" class="data-footnote-backref" href="https://mebiusbox.github.io/blog/2023/12/16/threejs-colorspace#user-content-fnref-1-0e8825-2">↩<sup>2</sup></a></p>
</li>
</ol>
</section>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="Three.js" term="Three.js"/>
        <category label="JavaScript" term="JavaScript"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Three.js を r116 から r159 にアップデートしたこと]]></title>
        <id>https://mebiusbox.github.io/blog/2023/12/15/bump-threejs-from-r116-to-r159</id>
        <link href="https://mebiusbox.github.io/blog/2023/12/15/bump-threejs-from-r116-to-r159"/>
        <updated>2023-12-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Pixy.js で使用している Three.js のバージョンを r116 から r159 まで上げました]]></summary>
        <content type="html"><![CDATA[<p>最近、<a href="https://github.com/mebiusbox/pixy.js" target="_blank" rel="noopener noreferrer">Pixy.js</a> で使用している Three.js のバージョンを r116 から最新の r159 までアップデートしたので、それについてまとめておきます．</p>
<p><a href="http://mebiusbox.github.io/contents/EffectTextureMaker/" target="_blank" rel="noopener noreferrer">EffectTextureMaker</a>というエフェクト用のテクスチャを作成するツールを公開しているのですが、ちょくちょく要望が来たり質問されたりしていました．
機能を追加する前に、まずは最新の環境に更新することにしました．EffectTextureMakerでは自作したシェーダライブラリ Pixy.js を使用しているのですが、これは Three.js を使って実装しています．なので、Three.js を最新にアップデートする必要があります．長い間手をつけずにいたのでバージョンが r116 から最新の r159 まで2年間もの期間が空いたことになります．その間に Three.js も色々変わっていました．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="threejs-で気になった変更部分">Three.js で気になった変更部分<a class="hash-link" aria-label="Three.js で気になった変更部分 への直接リンク" title="Three.js で気になった変更部分 への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/15/bump-threejs-from-r116-to-r159#threejs-%E3%81%A7%E6%B0%97%E3%81%AB%E3%81%AA%E3%81%A3%E3%81%9F%E5%A4%89%E6%9B%B4%E9%83%A8%E5%88%86">​</a></h2>
<p>2020年5月に Three.js の r116 がリリースされ、同時に Pixy.js も更新していました．そこで r116 まで遡ってログを見直しました．以下が気になった変更点です．ほとんどが対応する必要がありました．</p>
<ul>
<li>ESM への対応 (three.module.js, three.module.min.js)</li>
<li>ライブラリが /lib から アドオン /jsm に変わった</li>
<li>インポートマップを使ってライブラリをインポートし、ESM で実装するようになった</li>
<li>dat.GUI から lil-gui に変更された</li>
<li>WebGL2 の対応 (GLSL3)</li>
<li>WebGPURenderer実装された</li>
<li>Matrix の getInverse() が廃止され、 invert() に変更された</li>
<li>PlaneBufferGeometry などがなくなり PlaneGeometry というように単純になった</li>
<li>BufferGeometryUtils にあった computeTangents が BufferGeometry に実装された</li>
<li>Geometryの頂点が .vertices ではなく BufferAttribute 経由で取得するようになった</li>
<li>WebGLMultipleRenderTargets (MRT) が実装された</li>
<li>UBO (Uniform Buffer Objects)対応</li>
<li>RGBFormat が無くなった</li>
<li>CommonJS 形式である three.js, three.min.js が deprecated．r160 で削除される予定（コンソールに警告が出力される）</li>
<li>カラー管理が colorspace になった</li>
</ul>
<p>ということで、以下対応した内容です．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="esmoduleの対応">ESModuleの対応<a class="hash-link" aria-label="ESModuleの対応 への直接リンク" title="ESModuleの対応 への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/15/bump-threejs-from-r116-to-r159#esmodule%E3%81%AE%E5%AF%BE%E5%BF%9C">​</a></h2>
<p>Pixy.js の一部のコードは ESM 形式になっていたので、他の部分も ESM に書き直しました．
また、ES6の class で再実装するようにしました．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rollupの更新">Rollupの更新<a class="hash-link" aria-label="Rollupの更新 への直接リンク" title="Rollupの更新 への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/15/bump-threejs-from-r116-to-r159#rollup%E3%81%AE%E6%9B%B4%E6%96%B0">​</a></h2>
<p>Pixy.js は Three.js と同様に rollup でまとめています．こちらも ESModule 形式で出力するようにしました．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="サンプルの修正">サンプルの修正<a class="hash-link" aria-label="サンプルの修正 への直接リンク" title="サンプルの修正 への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/15/bump-threejs-from-r116-to-r159#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%81%AE%E4%BF%AE%E6%AD%A3">​</a></h2>
<p>インポートマップを使用し、すべてを ESM に変更．また、JavaScriptファイルを外部に出してメンテナンスしやすいようにしました．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="アドオン">アドオン<a class="hash-link" aria-label="アドオン への直接リンク" title="アドオン への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/15/bump-threejs-from-r116-to-r159#%E3%82%A2%E3%83%89%E3%82%AA%E3%83%B3">​</a></h2>
<p>アドオンになってインポートするコードは次のようになります．</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#66d9ef">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">WebGL</span><span class="token plain"> </span><span class="token keyword module" style="color:#66d9ef">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'three/addons/capabilities/WebGL.js'</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#66d9ef">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Stats</span><span class="token plain"> </span><span class="token keyword module" style="color:#66d9ef">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'three/addons/libs/stats.module.js'</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#66d9ef">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#f8f8f2">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">OrbitControls</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#f8f8f2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#66d9ef">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">'three/addons/controls/OrbitControls.js'</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>使用するときに THREE をつけないので微妙に違和感を感じます．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="matrixinvert">Matrix.invert()<a class="hash-link" aria-label="Matrix.invert() への直接リンク" title="Matrix.invert() への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/15/bump-threejs-from-r116-to-r159#matrixinvert">​</a></h2>
<p>具体的には以下のようなコード：</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">projectionCamera</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">matrixWorldInverse</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#e6db74">getInverse</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">projectionCamera</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">matrixWorld</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>これが次のようになります．</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">projectionCamera</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">matrixWorldInverse</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#e6db74">copy</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> projectionCamera</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">matrixWorld</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#e6db74">invert</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>これは <code>normalize()</code> などと同じ書き方になりました．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="buffergeometryutilscomputetangents">BufferGeometryUtils.computeTangents()<a class="hash-link" aria-label="BufferGeometryUtils.computeTangents() への直接リンク" title="BufferGeometryUtils.computeTangents() への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/15/bump-threejs-from-r116-to-r159#buffergeometryutilscomputetangents">​</a></h2>
<p>BufferGeometry に移動したので楽になりました．</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> sphereGeometry </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">THREE</span><span class="token class-name punctuation" style="color:#f8f8f2">.</span><span class="token class-name" style="color:#e6db74">SphereBufferGeometry</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">2</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">64</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">64</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token constant" style="color:#e6db74">THREE</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access maybe-class-name">BufferGeometryUtils</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#e6db74">computeTangents</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">sphere</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">geometry</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>変更後．</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> sphereGeometry </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">THREE</span><span class="token class-name punctuation" style="color:#f8f8f2">.</span><span class="token class-name" style="color:#e6db74">SphereGeometry</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">2</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">64</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">64</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">sphereGeometry</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token method function property-access" style="color:#e6db74">computeTangents</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="webglmultiplerendertargets-mrt">WebGLMultipleRenderTargets (MRT)<a class="hash-link" aria-label="WebGLMultipleRenderTargets (MRT) への直接リンク" title="WebGLMultipleRenderTargets (MRT) への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/15/bump-threejs-from-r116-to-r159#webglmultiplerendertargets-mrt">​</a></h2>
<p>MRTがThree.jsにも実装されました．Pixy.js の<a href="https://mebiusbox.github.io/contents/pixyjs/samples/shader_deferred.html" target="_blank" rel="noopener noreferrer">ディファードレンダリング</a>の部分で使用しています．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="xxxbuffergeometry">XXXBufferGeometry<a class="hash-link" aria-label="XXXBufferGeometry への直接リンク" title="XXXBufferGeometry への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/15/bump-threejs-from-r116-to-r159#xxxbuffergeometry">​</a></h2>
<p>単純に Buffer を消せば問題ありませんでした．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rgbformat">RGBFormat<a class="hash-link" aria-label="RGBFormat への直接リンク" title="RGBFormat への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/15/bump-threejs-from-r116-to-r159#rgbformat">​</a></h2>
<p>レンダーターゲットの生成時に指定していたのですが、定数から消えていました．
標準で RGBAFormat であり、alpha パラメータで制御するようになったのかもしれません．詳しく調べていないです．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="カラー空間">カラー空間<a class="hash-link" aria-label="カラー空間 への直接リンク" title="カラー空間 への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/15/bump-threejs-from-r116-to-r159#%E3%82%AB%E3%83%A9%E3%83%BC%E7%A9%BA%E9%96%93">​</a></h2>
<p>r152 で ColorManagement API が ColorSpace ベースになりました．最初は gammaInput, gammaOutput、次に outputEncoding 、そして今は outputColorSpace になったようです．これについては別のエントリで書こうと思います（まだ調査中）．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="lil-gui">lil-gui<a class="hash-link" aria-label="lil-gui への直接リンク" title="lil-gui への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/15/bump-threejs-from-r116-to-r159#lil-gui">​</a></h2>
<p>GUIメニューの表示に dat.GUI が使われていましたが、lil-gui に変更されました．
ある程度互換がありますが、完全に互換があるわけではありません．lil-gui に dat.GUI からの<a href="https://lil-gui.georgealways.com/#Migrating" target="_blank" rel="noopener noreferrer">マイグレーションガイド</a>があるので参考になります．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="glsl3">GLSL3<a class="hash-link" aria-label="GLSL3 への直接リンク" title="GLSL3 への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/15/bump-threejs-from-r116-to-r159#glsl3">​</a></h2>
<p>ShaderMaterial の <code>glslVersion</code> で指定することができます．</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">shaderMaterial</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token property-access">glslVersion</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token constant" style="color:#e6db74">THREE</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token constant" style="color:#e6db74">GLSL3</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Three.js 側でマクロを使って GLSL3 でコンパイルできるようになっているので、前のバージョンで書かれたシェーダコードでもそのままコンパイルされるようです．
ですが、RawShaderMaterial を使っている場合は自分で対応しなければなりません．
GLSL3 のシェーダコードは先頭に <code>#version 300 es</code> を入れるのですが、RawShaderMaterialでも自動で入れてくれます．
ここで、<code>fwidth</code> などを使うために以下のコードを入れる必要があって、RawShaderMaterialを使う場合はこちらでシェーダコードに入れてました．</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">#extension GL_OES_standard_derivatives : enable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>どうもこの辺りの宣言順番が問題となってGLSL3にするとコンパイルエラーとなっていました．
結局 ShaderMaterial の extensions で derivatives を有効にすることで対応できました．</p>
<p>基本的に Three.js と同様に GLSL3 への対応はマクロを使って対応し、シェーダコードは以前のままになっているのですが、MRTを使った部分だけは <code>layout(location)</code> を使っています．GLSL3 では <code>gl_FlagData</code> は使えないので．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="webglrendererrender">WebGLRenderer.render()<a class="hash-link" aria-label="WebGLRenderer.render() への直接リンク" title="WebGLRenderer.render() への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/15/bump-threejs-from-r116-to-r159#webglrendererrender">​</a></h2>
<p>引数に WebGLRenderTarget を渡すことが出来たのですが、それが出来なくなっていました．なので、<code>setRenderTarget</code> で設定するようにしました．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="おわりに">おわりに<a class="hash-link" aria-label="おわりに への直接リンク" title="おわりに への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/15/bump-threejs-from-r116-to-r159#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB">​</a></h2>
<p>Three.js の対応というよりかは ESModule などの JavaScript 関連や開発環境周りの情報更新の方が大変だった気がします．
以上です．</p>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="Three.js" term="Three.js"/>
        <category label="JavaScript" term="JavaScript"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[自分用にVSCodeのアウトライン拡張を作ってみました]]></title>
        <id>https://mebiusbox.github.io/blog/2023/12/13/vscode-pixy-outline</id>
        <link href="https://mebiusbox.github.io/blog/2023/12/13/vscode-pixy-outline"/>
        <updated>2023-12-13T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[VSCodeのアウトラインに見つけやすいシンボルを表示する拡張機能を作りました]]></summary>
        <content type="html"><![CDATA[<p>標準でアウトラインに表示されるシンボルは多すぎて使いづらいので、自分好みのシンボルをアウトラインに表示させるようにするために拡張機能を作りました．ここでは開発の備忘録としていくつかまとめておきます．</p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="はじめに">はじめに<a class="hash-link" aria-label="はじめに への直接リンク" title="はじめに への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/13/vscode-pixy-outline#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB">​</a></h2>
<p>VSCode の標準機能にあるアウトラインにはシンボル情報が表示されます．設定で一部を非表示に出来たり、<code>Ctrl+F</code>キーを押すと検索で絞り込むことができます．</p>
<p><img decoding="async" loading="lazy" alt="VSCode Outline View" src="https://mebiusbox.github.io/assets/images/2023-12-13-vscode-pixy-notion-231213153911-71867db6b4734b7b457c395dd566f098.png" width="390" height="435" class="img_ev3q"></p>
<p>また、シンボル検索(<code>Ctrl+Shift+O</code>)を使うこともできます．これはコマンドパレットで <code>@</code> と入力しても同じ結果になります．</p>
<p><img decoding="async" loading="lazy" alt="Symbol Search" src="https://mebiusbox.github.io/assets/images/2023-12-13-vscode-pixy-notion-231213165821-59d53bf0df3a362885286fa15f13637a.png" width="702" height="298" class="img_ev3q"></p>
<p>ここで <code>@:</code> と入力すればカテゴリごとに分けて表示されます．</p>
<p><img decoding="async" loading="lazy" alt="Symbol Search with Category" src="https://mebiusbox.github.io/assets/images/2023-12-13-vscode-pixy-notion-231213165920-fe97421d196ffaa794593162fb1961ef.png" width="716" height="248" class="img_ev3q"></p>
<p>検索を使えば事足りそうな気がしますが、しばらく触っていなかったりするとそもそも関数名とか何があるのかを記憶していません．
もう少し自分に優しいシンボル検索がとても欲しいと感じました．</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="目印と関数">目印と関数<a class="hash-link" aria-label="目印と関数 への直接リンク" title="目印と関数 への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/13/vscode-pixy-outline#%E7%9B%AE%E5%8D%B0%E3%81%A8%E9%96%A2%E6%95%B0">​</a></h2>
<p>アウトラインとして欲しいものに「目印（マーク）」と「関数（メソッド）」の2種類があります．
関数は標準の機能でありますが、目印は拡張機能を導入する必要があります．
今回は、アウトラインに目印を表示してくれる拡張機能「<a href="https://marketplace.visualstudio.com/items?itemName=roabramov.marks-to-outline" target="_blank" rel="noopener noreferrer">Marks To Outline</a>」のソースコードを調整して自分好みのアウトライン機能を作りました．</p>
<p><a href="https://marketplace.visualstudio.com/items?itemName=roabramov.marks-to-outline" target="_blank" rel="noopener noreferrer" class="card padding--md margin-bottom--sm cardContainer_yMBB"><span class="text--truncate cardTitle_SiGl" title="Marks to outline"><i class="cardIcon_VTdI fas fa-external-link-alt"></i> <!-- -->Marks to outline</span><span class="text--truncate cardDescription_fnmI" title="Adds MARKS symbols to outline view">Adds MARKS symbols to outline view</span></a></p>
<p>次のようなアウトライン表示になります．</p>
<p><img decoding="async" loading="lazy" alt="Pixy Outline View" src="https://mebiusbox.github.io/assets/images/2023-12-13-vscode-pixy-notion-231213170838-9ed047d939c9fbe5ad32cde30be1549e.png" width="396" height="416" class="img_ev3q"></p>
<p>目印は <code>MARK: ***</code> と記述するようになっています．
また、シンボル名にはそれぞれ <code>M: </code>、 <code>F: </code> を付けています．これによってシンボル検索で、目印は <code>@M: </code>、関数は <code>@F: </code> で絞り込むことができます．</p>
<p><img decoding="async" loading="lazy" alt="Search Function Symbols" src="https://mebiusbox.github.io/assets/images/2023-12-13-vscode-pixy-notion-231213172106-6a712f09fdc9f81f0306079777b72dae.png" width="721" height="318" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="Search Mark Symbols" src="https://mebiusbox.github.io/assets/images/2023-12-13-vscode-pixy-notion-231213172155-7e4b4e5d6562a1156c3ef459288e9662.png" width="695" height="219" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="vscode拡張機能の作成">VSCode拡張機能の作成<a class="hash-link" aria-label="VSCode拡張機能の作成 への直接リンク" title="VSCode拡張機能の作成 への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/13/vscode-pixy-outline#vscode%E6%8B%A1%E5%BC%B5%E6%A9%9F%E8%83%BD%E3%81%AE%E4%BD%9C%E6%88%90">​</a></h2>
<p>Node.jsの環境で作成します．以下を参考にしました．</p>
<p><a href="https://qiita.com/HelloRusk/items/073b58c1605de224e67e" target="_blank" rel="noopener noreferrer" class="card padding--md margin-bottom--sm cardContainer_yMBB"><span class="text--truncate cardTitle_SiGl" title="VSCode Extensions(拡張機能) 自作入門 〜VSCodeにおみくじ機能を追加する〜"><i class="cardIcon_VTdI fas fa-external-link-alt"></i> <!-- -->VSCode Extensions(拡張機能) 自作入門 〜VSCodeにおみくじ機能を追加する〜</span><span class="text--truncate cardDescription_fnmI" title="VSCode Extensions(拡張機能) 自作入門 〜VSCodeにおみくじ機能を追加する〜">VSCode Extensions(拡張機能) 自作入門 〜VSCodeにおみくじ機能を追加する〜</span></a></p>
<p>まず、<code>yo</code>, <code>generator-code</code> パッケージが必要なのでインストールします．</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">npm i yo generator-code -g</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Node.jsのバージョンも条件を満たすようにアップデートしました．</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">$ node -v</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">v18.17.1</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">$ npm -v</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">10.2.5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ひな形を作成します．</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">$ yo code</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>次に Marks to Outline を参考に実装していきます．
別に Marks to Outline をクローンして編集しても問題ありません．コードが比較的少ない場合は、どのような処理をやっているかを確認するためにもよく書き写しています．</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="機能の追加">機能の追加<a class="hash-link" aria-label="機能の追加 への直接リンク" title="機能の追加 への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/13/vscode-pixy-outline#%E6%A9%9F%E8%83%BD%E3%81%AE%E8%BF%BD%E5%8A%A0">​</a></h3>
<p>Marks to Outline には目印をアウトラインに表示する機能がすでに入っています．そこに関数を追加します．
関数は目印と同様に正規表現で抽出します．ただし、1行でしか判定していないので正確な関数抽出は出来ません．これは妥協しました．</p>
<p>関数は無視パターンと一致パターンを使って、先に無視パターンで弾いてから一致パターンでチェックするようにしています．</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> funcIgnorePatterns </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#a6e22e">"^\\s*[a-zA-Z_][a-zA-Z0-9_]+\\([^;]*\\)[^;\\{]*$"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#a6e22e">"^\\s*[a-zA-Z_][a-zA-Z0-9_]+\\([^(=&gt;);]*\\{.*$"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> funcSearchPatterns </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#a6e22e">"^\\s*([a-zA-Z_][a-zA-Z0-9_]+)\\([^;]*$"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#a6e22e">"^\\s*([a-zA-Z_][a-zA-Z0-9_]+)&lt;[^\\(]+&gt;\\([^;]*$"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#a6e22e">"^\\s*function\\s*([a-zA-Z_][a-zA-Z0-9_]+)\\([^;]*$"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#a6e22e">"^\\s*function\\s*([a-zA-Z_][a-zA-Z0-9_]+)&lt;[^\\(]+&gt;\\([^;]*$"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#a6e22e">"^\\s*(?:const|let|var)\\s*([a-zA-Z_][a-zA-Z0-9_]+)[^;]*=\\s*async\\s*\\([^;]*$"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>一応、<code>async</code> やアロー関数も対応していますが、まだまだ調整は必要だと思います．
また、JavaScript(+TypeScript)にしか対応していません．これは随時更新していけばいいかなと．</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="documentsymbol">DocumentSymbol<a class="hash-link" aria-label="DocumentSymbol への直接リンク" title="DocumentSymbol への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/13/vscode-pixy-outline#documentsymbol">​</a></h3>
<p>Marks to Outline では <code>vscode.SymbolInformation</code> をシンボルプロバイダの生成物として返しているのですが、これだとアウトラインの階層表示に対応できません．
階層表示させるには <code>vscode.DocumentSymbol</code> を使います．詳しくは、以下を参考にしました．</p>
<p><a href="https://qiita.com/PrsPrsBK/items/d71b13e733f3bbacf8b5" target="_blank" rel="noopener noreferrer" class="card padding--md margin-bottom--sm cardContainer_yMBB"><span class="text--truncate cardTitle_SiGl" title="VS Code拡張API - DocumentSymbolProvider"><i class="cardIcon_VTdI fas fa-external-link-alt"></i> <!-- -->VS Code拡張API - DocumentSymbolProvider</span></a></p>
<p>具体的には <code>vscode.DocumentSymbol</code> で親子関係を構築していけばよいみたいです． <code>vscode.DocumentSymbol.children</code> に <code>vscode.DocumentSymbol</code> を追加していく感じです．</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> vscodeSymbols</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> vscode</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">DocumentSymbol</span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> markGroup</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> vscode</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">DocumentSymbol </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">vscode</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">DocumentSymbol</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#a6e22e">"MARKS"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token string" style="color:#a6e22e">""</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    vscode</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">SymbolKind</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Key</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">vscode</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Range</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">vscode</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Position</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">vscode</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Position</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">10</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">vscode</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Range</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">vscode</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Position</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">vscode</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">Position</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token number" style="color:#ae81ff">0</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> </span><span class="token number" style="color:#ae81ff">10</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">resultMarks</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">map</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">result</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> MarkTokens</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    markGroup</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">children</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">push</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    finder</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">makeDocumentSymbol</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"> </span><span class="token operator" style="color:#66d9ef">...</span><span class="token plain">result</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"> document </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        vscode</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">SymbolKind</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">Key</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token string" style="color:#a6e22e">"M: "</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">vscodeSymbols</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">push</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">markGroup</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#66d9ef">const</span><span class="token plain"> funcGroup</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> vscode</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">DocumentSymbol </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token keyword" style="color:#66d9ef">new</span><span class="token plain"> </span><span class="token class-name" style="color:#e6db74">vscode</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">DocumentSymbol</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">// (...)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#8292a2;font-style:italic">// (...)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">vscodeSymbols</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token function" style="color:#e6db74">push</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">funcGroup</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>この <code>vscodeSymbols</code> を <code>provideDocumentSymbols</code> メソッドで返すようにしています．</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="パッケージの生成とインストール">パッケージの生成とインストール<a class="hash-link" aria-label="パッケージの生成とインストール への直接リンク" title="パッケージの生成とインストール への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/13/vscode-pixy-outline#%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AE%E7%94%9F%E6%88%90%E3%81%A8%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">​</a></h3>
<p>デバッグをしていい感じになったら、パッケージングします．
この時 <code>README.md</code> を編集しないと怒られるので適当に編集します．以下のコマンドでパッケージが作成できます．</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">npx vsce package</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>拡張子が <code>.vsix</code> のファイルが生成されます．VSCode上ならこのファイルを右クリックからインストールできます．</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="役に立ったサイト">役に立ったサイト<a class="hash-link" aria-label="役に立ったサイト への直接リンク" title="役に立ったサイト への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/13/vscode-pixy-outline#%E5%BD%B9%E3%81%AB%E7%AB%8B%E3%81%A3%E3%81%9F%E3%82%B5%E3%82%A4%E3%83%88">​</a></h3>
<p>拡張機能のアクティベートの部分に関しては次のサイトを参考にしました．</p>
<p><a href="https://clickan.click/activation-events/" target="_blank" rel="noopener noreferrer" class="card padding--md margin-bottom--sm cardContainer_yMBB"><span class="text--truncate cardTitle_SiGl" title="Visual Studio Code 拡張機能のアクティベート activationEvents"><i class="cardIcon_VTdI fas fa-external-link-alt"></i> <!-- -->Visual Studio Code 拡張機能のアクティベート activationEvents</span></a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="合わせて使いたい拡張機能">合わせて使いたい拡張機能<a class="hash-link" aria-label="合わせて使いたい拡張機能 への直接リンク" title="合わせて使いたい拡張機能 への直接リンク" href="https://mebiusbox.github.io/blog/2023/12/13/vscode-pixy-outline#%E5%90%88%E3%82%8F%EF%BF%BD%E3%81%9B%E3%81%A6%E4%BD%BF%E3%81%84%E3%81%9F%E3%81%84%E6%8B%A1%E5%BC%B5%E6%A9%9F%E8%83%BD">​</a></h2>
<p>おまけで <code>TODO Highlight</code> という拡張機能を使うと、目印のコードをハイライトすることができます．</p>
<p><a href="https://marketplace.visualstudio.com/items?itemName=wayou.vscode-todo-highlight" target="_blank" rel="noopener noreferrer" class="card padding--md margin-bottom--sm cardContainer_yMBB"><span class="text--truncate cardTitle_SiGl" title="TODO Highlight"><i class="cardIcon_VTdI fas fa-external-link-alt"></i> <!-- -->TODO Highlight</span><span class="text--truncate cardDescription_fnmI" title="highlight TODOs, FIXMEs, and any keywords, annotations...">highlight TODOs, FIXMEs, and any keywords, annotations...</span></a></p>
<p>インストールしただけではダメで、カスタマイズする必要があります．</p>
<p>設定で <code>todohighlight.keywords</code> を追加します．以下は私の設定です．</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#f8f8f2;background-color:#272822"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token property" style="color:#f92672">"todohighlight.keywords"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#f8f8f2">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property" style="color:#f92672">"text"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"NOTE:"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property" style="color:#f92672">"color"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"#242424"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property" style="color:#f92672">"border"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"1px solid #66D9EF"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property" style="color:#f92672">"borderRadius"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"2px"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property" style="color:#f92672">"backgroundColor"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"#66D9EF"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property" style="color:#f92672">"overviewRulerColor"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"transparent"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property" style="color:#f92672">"text"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"//!"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property" style="color:#f92672">"color"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"#242424"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property" style="color:#f92672">"border"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"1px solid #A6E22E"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property" style="color:#f92672">"borderRadius"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"2px"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property" style="color:#f92672">"backgroundColor"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"#A6E22E"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property" style="color:#f92672">"overviewRulerColor"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"transparent"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property" style="color:#f92672">"text"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"MARK:"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property" style="color:#f92672">"color"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"#242424"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property" style="color:#f92672">"border"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"1px solid #A6E22E"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property" style="color:#f92672">"borderRadius"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"2px"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property" style="color:#f92672">"backgroundColor"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"#A6E22E"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property" style="color:#f92672">"fontWeight"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">"600"</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token property" style="color:#f92672">"isWholeLine"</span><span class="token operator" style="color:#66d9ef">:</span><span class="token plain"> </span><span class="token boolean" style="color:#ae81ff">true</span><span class="token punctuation" style="color:#f8f8f2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#f8f8f2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#f8f8f2">]</span><span class="token punctuation" style="color:#f8f8f2">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="クリップボードにコードをコピー" title="コピー" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>次のように表示されます：</p>
<p><img decoding="async" loading="lazy" alt="TODO Highlight" src="https://mebiusbox.github.io/assets/images/2023-12-13-vscode-pixy-notion-231213180211-068e3db6156f6aa7587b575857f85a76.png" width="686" height="357" class="img_ev3q"></p>
<p>これで少しは快適になった感じがします．もしかすると便利な拡張機能や標準で出来るかもしれません．
ちなみに、今のところ作成した拡張機能は公開する予定はありません．
以上です．</p>]]></content>
        <author>
            <name>mebiusbox</name>
            <uri>https://github.com/mebiusbox</uri>
        </author>
        <category label="vscode" term="vscode"/>
    </entry>
</feed>